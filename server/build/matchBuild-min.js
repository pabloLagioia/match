!function(){function t(){}t.extend=function(t,e){if(!t)throw new Error("Child is undefined and cannot be extended");if(!e)throw new Error("Parent is undefined, you cannot extend child with an undefined parent");if(!e.name)throw new Error("Parent name is undefined. Please add a field name to the parent constructor where name is the name of the function. This usually creates issues in Internet Explorer."+e);t.prototype["extends"+e.name]=e;for(var i in e.prototype)t.prototype[i]?t.prototype[e.name+i]||(t.prototype[e.name.substr(0,1).toLowerCase()+e.name.substr(1)+i.substr(0,1).toUpperCase()+i.substr(1)]=e.prototype[i]):t.prototype[i]=e.prototype[i]},window.Class=t}(),function(t){function e(){this._eventListeners={}}e.prototype.addEventListener=function(t,e){this._eventListeners[t]||(this._eventListeners[t]=[]),this._eventListeners[t].push(e)},e.prototype.on=function(){for(var t=Array.prototype.slice.call(arguments,0,arguments.length-1),e=arguments[arguments.length-1],i=0;i<t.length;i++)this.addEventListener(t[i],e)},e.prototype.off=function(){for(var t=Array.prototype.slice.call(arguments,0,arguments.length-1),e=arguments[arguments.length-1],i=0;i<t.length;i++)this.removeEventListener(t[i],e)},e.prototype.raise=function(t,e){var i=this._eventListeners[t];if(i)for(var o=0,n=i.length;n>o;o++)i[o](e)},e.prototype.raiseEvent=e.prototype.raise,e.prototype.removeEventListener=function(t,e){if(this._eventListeners[t]){var i=this._eventListeners[t];i.splice(i.indexOf(e),1)}},e.prototype.removeAllListeners=function(t){this._eventListeners={}},e.prototype.listensTo=function(t){return this._eventListeners[t]},e.name="EventHandler",t.EventHandler=e}(window),function(t){function e(){this.listeners=new Array}function i(t){this.callback=t}function o(t,e){this.callbackName=t,this.object=e}e.prototype.addEventListener=function(t,e){e?this.listeners.push(new o(t,e)):this.listeners.push(new i(t))},e.prototype.raise=function(){var t=0,e=this.listeners.length;if(0!=e)for(;e>t;t++)this.listeners[t].run(arguments)},e.prototype.removeEventListener=function(t,e){for(var i,o=0,n=this.listeners.length;n>o;o++)if(i=this.listeners[o],i.callback==t||i.callbackName==t&&e==i.object)return void this.listeners.splice(o,1)},e.prototype.removeAllEventListeners=function(){return this.listeners=new Array,listeners},e.name="EventListener",t.EventListener=e,i.prototype.run=function(t){this.callback(t[0])},o.prototype.run=function(t){this.object[this.callbackName](t[0])}}(window),function(t){function e(){this.modules={}}e.prototype.defineModule=function(){var t={requires:Array.prototype.slice.call(arguments,1,arguments.length-1),name:arguments[0],constructor:arguments[arguments.length-1]};this.modules[t.name]=t},e.prototype.getModule=function(t){var e=this.modules[t],i=[],o=!0;if(e){for(var n=0;n<e.requires.length;n++){var s=this.modules[e.requires[n]];if(!s){o=!1;break}s.cache||(s.cache=this.getModule(s.name)),i.push(s.cache)}if(o)return e.constructor.apply(e.constructor,i)}return{}},e.prototype.module=function(){return 1==arguments.length?this.getModule(arguments[0]):(this.defineModule.apply(this,arguments),this)},t.ModuleManager=e}(window),function(t){function e(){this._keys={},this._values=[],this.length=0}e.prototype.set=function(t,e){var i=this._keys[t];if(i)this._values[i]=e;else{var o=this._values.push(e)-1;this._keys[t]=o,this.length++}return e},e.prototype.clear=function(){this._keys={},this._values=[],this.length=0},e.prototype.get=function(t){return this._values[this._keys[t]]},e.prototype.remove=function(t){var e=this._keys[t];if(void 0!=e){this._values.splice(e,1),delete this._keys[t],this.length--;for(var i in this._keys)this._keys[i]>e&&this._keys[i]--}},e.prototype.eachValue=function(t){for(var e=0,i=this._values.length,o=this._values;i>e;e++)t(o[e])},e.prototype.eachKey=function(t){for(var e in this._keys)t(e)},e.prototype.each=function(t){for(var e in this._keys)t(e,this.get(e))},e.name="SimpleMap",t.SimpleMap=e}(window),function(t,e,i){function o(){this.extendsSimpleMap(),this.onSet=new i,this.onRemoved=new i}o.prototype.set=function(t,e){this.simpleMapSet(t,e),this.onSet.raise(t)},o.prototype.remove=function(t){this.simpleMapRemove(t),this.onRemoved.raise(t)},Class.extend(o,e),t.EventSimpleMap=o}(window,SimpleMap,EventListener),function(t){function e(){}e.prototype.joinArgs=function(t){var e=[];for(var i in t)e.push(t[i]);return e.join(" ")},window.console?(window.console.log?e.prototype.log=function(){window.console.log(this.joinArgs(arguments))}:e.prototype.log=function(t){alert(this.joinArgs(arguments))},window.console.warn?e.prototype.warn=function(t){window.console.warn(this.joinArgs(arguments))}:e.prototype.warn=e.prototype.log,window.console.error?e.prototype.error=function(t){window.console.error(this.joinArgs(arguments))}:e.prototype.error=e.prototype.log):(e.prototype.log=function(t){alert(this.joinArgs(arguments))},e.prototype.debug=e.prototype.log,e.prototype.warn=e.prototype.log,e.prototype.error=e.prototype.log),t.DefaultLogger=e}(window);var M=window.M||{},game=window.game||{};!function(t){function e(){var t,e,i=["Firefox","Chrome","Opera","Safari","MSIE 9.0","BlackBerry"];this.name=void 0;for(t in i)e=i[t],this["is"+e]=-1!=navigator.userAgent.indexOf(e),!this.name&&this["is"+e]&&(this.name=e);this.supportedAudioFormat=this.getBrowserPreferredAudioFormat(),this.supported=void 0!=this.name}function i(){var t,e=["Android","BlackBerry","iPhone","iPad","iPod","IEMobile"];for(t in e)deviceName=e[t],this["is"+deviceName]=-1!=navigator.userAgent.indexOf(deviceName),!this.name&&this["is"+deviceName]&&(this.name=deviceName);this.name?this.isMobile=!0:(this.isMobile=!1,this.name="PC")}function o(){this.extendsModuleManager(),this.extendsEventHandler(),this.autowire=!0,this.logger=new DefaultLogger,this._isPlaying=!1,this._gameLayers=new SimpleMap,this._gameObjects=new Array,this._triggers=new Array,this.cache=null,this.offScreenCanvas=document.createElement("canvas"),this.offScreenContext=this.offScreenCanvas.getContext("2d"),this.onLoopProperties={offScreenContext:this.offScreenContext,offScreenCanvas:this.offScreenCanvas,debug:!1,time:0,m:this},this.browser=new e,this.device=new i,this.input=new SimpleMap,this.showLogo=!0,this.LOGO_DURATION=2e3,this.DEFAULT_LAYER_NAME="world",this.DEFAULT_LAYER_BACKGROUND="#000",this.DEFAULT_UPDATES_PER_SECOND=60,this._updatesPerSecond=0,this._msPerUpdate=0,this._previousLoopTime=null,this._lag=0,this._maxLag=50,this.setUpdatesPerSecond(this.DEFAULT_UPDATES_PER_SECOND),this.version="1.6a",this.name="Match",this.company="Puzzling Ideas",this.game={behaviours:{},attributes:{},entities:{},scenes:{},displays:{}};var t=this;document.addEventListener("DOMContentLoaded",function(){if(t.gameData){t.gameData.title&&(document.title=t.gameData.title);var e=t.gameData.canvas||t.dom("canvas");t.gameData.size&&("fullScreen"==t.gameData.size?(e.width=window.innerWidth,e.height=window.innerHeight):(e.width=M.gameData.size.width,e.height=M.gameData.size.height)),t.start(e)}else{var i=t.dom("canvas");t.autowire&&i&&(console.log("Autowire enabled. Starting Match on default canvas"),t.start(i))}})}function n(){M.gameLoop(),requestAnimationFrame(n)}t.Match||(e.prototype.getBrowserPreferredAudioFormat=function(){var t=document.createElement("audio");return""!=t.canPlayType("audio/ogg")?".ogg":""!=t.canPlayType("audio/mpeg")?".mp3":""!=t.canPlayType("audio/wav")?".wav":""!=t.canPlayType("audio/mp4")?".mp4":void this.logger.warn("This browser does not support audio")},e.prototype.getBrowserAudioSupportedFormats=function(){var t=document.createElement("audio"),e=new Array;return""!=t.canPlayType("audio/ogg")&&e.push(".ogg"),""!=t.canPlayType("audio/mpeg")&&e.push(".mp3"),""!=t.canPlayType("audio/wav")&&e.push(".wav"),""!=t.canPlayType("audio/mp4")&&e.push(".mp4"),e.join("|")},o.prototype.createGame=function(t){this.gameData=t},o.prototype.getCamera=function(){return this.renderer.camera},o.prototype.setUpdatesPerSecond=function(t){this._updatesPerSecond=t,this._msPerUpdate=Math.floor(1e3/t)},o.prototype.getUpdatesPerSecond=function(){return this._updatesPerSecond},o.prototype.getLayer=function(t){return this._gameLayers.get(t)},o.prototype.layer=o.prototype.getLayer,o.prototype.setUpGameLoop=function(){this.gameLoopAlreadySetup=!0,this._previousLoopTime=this.getTime(),this._lag=0,this.createGameLayer(this.DEFAULT_LAYER_NAME).background=this.DEFAULT_LAYER_BACKGROUND,n()},o.prototype._showLogo=function(){this.setScene("matchLogo",function(){setTimeout(function(){M.removeScene(),M._regularStart()},M.LOGO_DURATION)})},o.prototype.restart=function(){this.gameLoopAlreadySetup=!1,this.start()},o.prototype.setKeyboard=function(t){this.onLoopProperties.keyboard=t,this.input.set("keyboard",t)},o.prototype.setMouse=function(t){this.onLoopProperties.mouse=t,this.input.set("mouse",t)},o.prototype.setTouch=function(t){this.onLoopProperties.touch=t,this.input.set("touch",t)},o.prototype.setAccelerometer=function(t){this.onLoopProperties.accelerometer=t,this.input.set("accelerometer",t)},o.prototype.setOrientation=function(t){this.onLoopProperties.orientation=t,this.input.set("orientation",t)},o.prototype.registerClass=function(){for(var t,e=arguments[0].split("."),i=arguments[arguments.length-1],o=window,n=e.length-1,s=[],r=0;n>r;r++)t=e[r],o[t]||(o[t]=new Object),o=o[t];if(!o[e[n]]){for(var r=1;r<arguments.length-1;r++)s.push(arguments[r]);o[e[n]]=i.apply(i,s),o[e[n]].namespace=arguments[0]}},o.prototype.loadBehaviour=function(){script=document.createElement("script"),script.src="http://69.164.192.103:8082/behaviour/js?q="+Array.prototype.slice.call(arguments,0).join(","),document.head.appendChild(script)},o.prototype.loadAttribute=function(){script=document.createElement("script"),script.src="http://69.164.192.103:8081/attribute/js?q="+Array.prototype.slice.call(arguments,0).join(","),document.head.appendChild(script)},o.prototype.registerBehaviour=function(t,e){this.game.behaviours[t]&&this.logger.warn("There is already a behaviour named ",t,"current will be overriden"),this.game.behaviours[t]=e,this.raise("behaviourRegistered",t)},o.prototype.behaviour=function(){return 2!=arguments.length?new this.game.behaviours[arguments[0]]:void this.registerBehaviour(arguments[0],arguments[1])},o.prototype.capitalize=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},o.prototype.display=function(t,e){if(2!=arguments.length){var i=this.game.displays[t];if(i){var o=new(this.renderizables[this.capitalize(i.type)]);return o.set(i),o}throw new Error("When trying to instantiate a display, no display by the name '"+t+"' could be found")}var n=this.capitalize(e.type);if(!this.renderizables[n])throw new Error("When trying to register a display, no display by the type '"+n+"' could be found. Try rectangle, circle, text or sprite");this.game.displays[t]=e},o.prototype.registerAttribute=function(t,e){this.game.attributes[t]&&this.logger.warn("There is already an attribute named ",t,"current will be overriden"),this.game.attributes[t]=e,this.raise("attributeRegistered",t)},o.prototype.attribute=function(){return 2!=arguments.length?new this.game.attributes[arguments[0]]:void this.registerAttribute(arguments[0],arguments[1])},o.prototype.registerEntity=function(t,e){void 0==this.game.entities[t]?(this.game.entities[t]=e,this.raise("entityRegistered",t)):this.logger.warn("There is already an entity named ",t)},o.prototype.createEntity=function(t,e,i){var o=this.game.entities[t];if("function"==typeof o){var n=o(e,i);return n.name=t,this.raise("entityCreated",t),n}if(void 0!==o){var n=new this.Entity(e,i);if(o.has)for(var s=0;s<o.has.length;s++)n.has(o.has[s]);if(o.does)for(var s=0;s<o.does.length;s++)n.does(o.does[s]);if(o.displays)for(var s=0;s<o.displays.length;s++){var r=o.displays[s];if("object"==typeof r){var a,h,u=Object.keys(r)[0],e=r[u];a=e.text?"Text":e.radius?"Circle":e.image?"Sprite":"Rectangle",h=new M.renderizables[a],h.set(e),n.views.set(u,h)}else{var p=this.display(o.displays[s]);n.views.set(o.displays[s],p)}}return n.name=t,this.raise("entityCreated",t),n}throw new Error("Unable to instantiate entity by name '"+t+"' as it could not be found. Did you register it?")},o.prototype.entity=function(){return 2!=arguments.length?this.createEntity(arguments[0]):void this.registerEntity(arguments[0],arguments[1])},o.prototype.spawn=function(t,e){var i=this.entity(t);e&&e(i);for(var o=M.add(i),n=0;n<i.views._values.length;n++)if(i.views._values[n].layer)return o.to(i.views._values[n].layer),i;return o.to("world"),i},o.prototype.registerScene=function(t,e){void 0==this.game.scenes[t]?this.game.scenes[t]=e:this.logger.warn("There is already a scene named ",t)},o.prototype.scene=function(t,e){return 2!=arguments.length?this.getScene(t):void this.registerScene(t,e)},o.prototype.unregisterScene=function(t){this.game.scenes[t]=null},o.prototype.getScene=function(t){return this.game.scenes[t]},o.prototype.createMap=function(t){if(!t)throw new Error("There is no map registered with name "+name);t.cameraBoundingArea&&this.getCamera().setBoundingArea(t.cameraBoundingArea.left,t.cameraBoundingArea.top,t.cameraBoundingArea.right,t.cameraBoundingArea.bottom);for(var e=0;e<t.definition.length;e++)for(var i=0;i<t.definition[e].length;i++){var o=t.definition[e][i],n=t.entities[o],s={row:e,column:i,width:t.tile.width,height:t.tile.height,center:{x:i*t.tile.width+t.tile.width/2,y:e*t.tile.height+t.tile.height/2},type:o};this._createMapTile(n,s)}},o.prototype._createMapTile=function(t,e){if("function"==typeof t)this._createMapTile(t(e),e);else if(t instanceof Array)t.forEach(function(t){M._createMapTile(t,e)});else if("string"==typeof t){var i,o=t.indexOf(":");-1!=o&&(i=t.substr(o+1,t.length),t=t.substr(0,o)),M.add(M.createEntity(t,e,i))}else M.add(t)},o.prototype.updateGameObjects=function(t,e){for(var i=0;i<t.length;i++){var o=t[i];this._applyInput(o),o.onLoop(e)}},o.prototype._applyInput=function(t){for(var e=0,i=this.input._values,o=i.length;o>e;e++)i[e].applyToObject(t)},o.prototype._updateInput=function(){for(var t=0,e=this.input._values,i=e.length;i>t;t++)e[t].update()},o.prototype.gameLoop=function(){if(this._isPlaying){this.raise("beforeLoop");var t=this.onLoopProperties,e=this.getTime();this.renderer;t.time=this.FpsCounter.timeInMillis,this._previousLoopTime=e,e=(new Date).getTime(),this.updateGameObjects(this._gameObjects,t),this.updateTriggers(this._triggers,t),this._updateInput(t),this.updateTime=(new Date).getTime()-e,e=(new Date).getTime(),this.renderer.renderLayers(this._gameLayers),this.renderTime=(new Date).getTime()-e,this.FpsCounter.count(),this.raise("afterLoop")}},o.prototype.updateTriggers=function(t,e){for(var i=0,o=t.length;o>i;i++)t[i].onLoop(e)},o.prototype.getAsBase64Image=function(){return this.renderer.getAsBase64Image()},o.prototype.getAsImage=function(){var t=new Image;return t.src=this.getAsBase64Image(),t},o.prototype.getFirst=function(){return this.getIndex(0)},o.prototype.getIndex=function(t){try{return this._gameObjects[t]}catch(e){return null}},o.prototype.get=function(t){if(this.cache&&this.cache.key==t)return this.cache;for(var e,i=this._gameObjects.length;i--;)if(e=this._gameObjects[i],t==e.key)return this.cache=e,e;return null},o.prototype.getEntitiesByName=function(t){for(var e,i=[],o=this._gameObjects.length;o--;)e=this._gameObjects[o],e.name===t&&i.push(e);return i},o.prototype.getLast=function(){return this.getIndex(this._gameObjects.length-1)},o.prototype.isInOnLoopList=function(t){return-1!=this._gameObjects.indexOf(t)},o.prototype.add=function(){for(var t=0;t<arguments.length;t++)"string"==typeof arguments[t]&&(arguments[t]=M.createEntity(arguments[t])),this.pushGameObject(arguments[t]);return{objects:arguments,to:function(t){if(t)for(var e=0;e<this.objects.length;e++)M.addToLayer(t,this.objects[e])}}},o.prototype.remove=function(){for(var t=0;t<arguments.length;t++)this.removeGameObject(arguments[t]);return{objects:arguments,from:function(t){var e=M.layer(t);if(e)for(var i=0;i<this.objects.length;i++)e.remove(this.objects[i])}}},o.prototype.addToLayer=function(t,e){if(t&&e){var i=this.layer(t)||this.createGameLayer(t);i.add(e)}},o.prototype.push=o.prototype.add,o.prototype.pushGameObject=function(t){if(!t.onLoop)throw new Error("Cannot add object "+t.constructor.name+", it doesn't have an onLoop method");if(t instanceof this.Entity){this._gameObjects.push(t);var e=t.attribute("layer");e&&this.addToLayer(e,t)}else this._triggers.push(t);this.raise("gameObjectPushed")},o.prototype.pushObject=o.prototype.pushGameObject,o.prototype.removeGameObject=function(t){if(void 0!=t)if("string"==typeof t)this.removeGameObject(this.get(t));else if(isNaN(t)){var e=this._gameObjects.indexOf(t);-1!=e&&(this._gameObjects.splice(e,1),this.raise("gameObjectRemoved"))}else this._gameObjects.splice(t,1),this.raise("gameObjectRemoved")},o.prototype.removeAllGameObjects=function(){this._gameObjects=new Array},o.prototype.createGameLayer=function(t,e){if(void 0===t)throw new Error("Cannot create layer. You must name it.");var i=new this.GameLayer(t,e||M._gameLayers.length);return this.pushGameLayer(t,i),i},o.prototype.createLayer=o.prototype.createGameLayer,o.prototype.pushGameLayer=function(t,e){if(void 0===e)throw new Error("Cannot add null game layer");this._gameLayers.set(t,e),this.raise("gameLayerPushed",t)},o.prototype.pushLayer=o.prototype.pushGameLayer,o.prototype.setScene=function(t,e){var i=this.getScene(t);if(!i)return void this.logger.error("Unable to load scene by name",t,"It could not be found");if(this.logger.log("Loading scene by name",t),this.removeScene(),i.fullScreen&&this.setFullScreen(),i.loadingScene){var o=this;this.setScene(i.loadingScene,function(){var t=!1,e=!1,n=o.getScene(i.loadingScene),s=!1,r=function(){if(!s&&t&&e){o.sprites.removeAllEventListeners(),o.sounds.removeAllEventListeners(),o.removeAllGameLayers();for(var r in n.sprites)void 0==i.sprites[r]&&o.sprites.remove(r);for(var r in n.sounds)void 0==i.sounds[r]&&o.sounds.remove(r);i.map&&M.createMap(i.map),i.onLoad&&(i.onLoad(),M.renderer.redrawAllLayers()),s=!0}};i.sounds?o.sounds.load(i.sounds,function(){t=!0,r()}):t=!0,i.sprites?o.sprites.load(i.sprites,function(){e=!0,r()}):e=!0,r()})}else{var n=!1,s=!1,r=!1,a=function(){!r&&n&&s&&(r=!0,i.map&&M.createMap(i.map),i.onLoad&&(i.onLoad(),M.renderer.redrawAllLayers()),e&&e())};i.sounds?this.sounds.load(i.sounds,function(){n=!0,a()}):n=!0,i.sprites?this.sprites.load(i.sprites,function(){s=!0,a()}):s=!0,a()}},o.prototype.removeScene=function(){this.removeAllGameObjects(),this.removeAllGameLayers(),this.sprites.removeAllEventListeners(),this.sounds.removeAllEventListeners(),this.createGameLayer(this.DEFAULT_LAYER_NAME).background=this.DEFAULT_LAYER_BACKGROUND,this.raise("sceneRemoved")},o.prototype.pushScene=function(t){for(var e=0,i=t.length;i>e;e++)this.pushGameLayer(t[e]);this.raise("scenePushed")},o.prototype.swapScenes=function(t){var t=this.removeScene();return this.pushScene(t),t},o.prototype.removeGameLayer=function(t){var e=this._gameLayers.get(t);if(e){for(var i=0;i<e.onRenderList.length;i++)this.removeGameObject(e.onRenderList[i]);return this._gameLayers.remove(t),this.renderer._reRenderAllLayers=!0,this.raise("gameLayerRemoved",t),e}this.logger.error("could not remove layer by name",t)},o.prototype.removeLayer=o.prototype.removeGameLayer,o.prototype.removeAllGameLayers=function(){var t=this;this._gameLayers.eachKey(function(e){t.removeGameLayer(e)})},o.prototype.getSpeed=function(t){return t/this.getAverageFps()},o.prototype.getSpeedFixedAt=function(t,e){var i=this.getAverageFps();return t/i*(e/i)},o.prototype.getFps=function(){return this.FpsCounter.fps},o.prototype.getAverageFps=function(){return this.FpsCounter.getAverageFps()},o.prototype.getGameTime=function(){return this.FpsCounter.gameTime},o.prototype.getTime=function(){return this.FpsCounter.timeInMillis},o.prototype.clearFrontBuffer=function(){this.frontBuffer&&this.frontBuffer.clearRect(0,0,this.frontBuffer.canvas.width,this.frontBuffer.canvas.height)},o.prototype.sortLayers=function(){this._gameLayers._values.sort(function(t,e){return t._zIndex-e._zIndex}),this._gameLayers._keys={};for(var t=0;t<this._gameLayers._values.length;t++)this._gameLayers._keys[this._gameLayers._values[t].name]=t},o.prototype.pause=function(){this._isPlaying?this.raise("pause"):this.raise("unpause"),this._isPlaying=!this._isPlaying},o.prototype.start=function(t,e){if(t||(t=M.dom("canvas")),!(t instanceof HTMLCanvasElement))throw new Error("M.start is expecting an HTMLCanvasElement as argument. If there's no canvas in the site, please add one and then call start. If M.autowire is true and there's no canvas on document load please set it to false.");t.onselectstart=function(){return!1},t.requestFullScreen=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen,t.setAttribute("data-engine",this.name),t.setAttribute("data-version",this.version),this.renderer=this.renderingProvider.getRenderer(t,e),this._isPlaying=!0,this.gameLoopAlreadySetup||(this.setUpGameLoop(),this.showLogo?this._showLogo():this._regularStart())},o.prototype._regularStart=function(){this.gameData&&this.gameData.main?"string"==typeof this.gameData.main?this.setScene(this.gameData.main):this.gameData.main():"function"==typeof window.main&&window.main()},o.prototype.removeIndexFromArray=function(t,e){e.splice(t,1)},o.prototype.removeElementFromArray=function(t,e){var i=e.indexOf(t);-1!=i&&this.removeIndexFromArray(i,e)},o.prototype.dom=function(t){return document.querySelector(t)},o.prototype.applyProperties=function(t,e,i){if(t&&e){if(i){if(!e)throw new Error("Cannot apply null properties to "+t.constructor.name);for(var o=i.length;o--;)if(!e[i[o]])throw new Error("Unable to apply properties to ["+t.constructor.name+"] You must specify ["+i[o]+"]")}var n="";for(var o in e)n="set"+o.charAt(0).toUpperCase()+o.substr(1),t[n]?t[n](e[o]):t[o]=e[o];return t}},o.prototype.apply=function(){for(var t=arguments[0],e=1;e<arguments.length;e++){var i=arguments[e];if(i)if(i instanceof Function){var o=new i;for(var n in o)i.prototype[n]||t[n]||(t[n]=o[n])}else for(var n in i)t[n]||(t[n]=i[n])}},o.prototype.put=function(t,e){for(var i in e)t[i]=e[i]},o.prototype.clone=function(t){var e={};for(var i in t)c[i]=t[i];return e},o.prototype.each=function(t,e,i){var o=t.length;if(i)for(;o--;)e.call(i,t[o]);else for(;o--;)e.call(t[o])},o.prototype.extend=Class.extend,o.prototype.round=function(t,e){for(var i="1";e--;)i+="0";return e=parseInt(i),Math.round(t*e)/e},o.prototype.fastRoundTo=function(t,e){return this.fastRound(t*e)/e},o.prototype.fastRound=function(t){return.5+t<<0},o.prototype.getPercentage=function(t,e){return t*e/100},o.prototype.elapsedTimeFrom=function(t,e){return M.getTime()-t>=e},o.prototype.isPaused=function(){return!this._isPlaying},o.prototype.getStyleBySelector=function(t){var e,i,o,n=document.styleSheets;for(i=n.length-1;i>=0;i--)for(e=n[i].cssRules,o=0;o<e.length;o++)if(e[o].type==CSSRule.STYLE_RULE&&e[o].selectorText==t)return e[o].style;return null},o.prototype.setFullScreen=function(){if(!this.renderer)throw new Error("Cannot set fullScreen. You must call M.start() to set the canvas");this.renderer.setFullScreen()},o.prototype.getCenter=function(){return this.renderer.getCenter()},o.prototype.getSize=function(){return this.renderer.getViewportSize()},o.prototype.getObjectName=function(t){if(!t||!t.constructor)return t;var e=t.constructor.name;return e||(e=t.constructor.toString().match(/function ([a-zA-Z_$][a-zA-Z_$0-9]*)/)[1]),e},o.prototype.getLayerNames=function(){return Object.keys(this._gameLayers._keys)},Class.extend(o,ModuleManager),Class.extend(o,EventHandler),window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)}),t.M=t.Match=new o)}(window),function(t){function e(){}e.prototype._request=function(t,e,i,o){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&(o?i.call(o,this.responseText):i(this.responseText))},n.open(t,e,!0),n.send()},e.prototype.post=function(t,e){this._request("POST",t,e)},e.prototype.get=function(t,e){this._request("GET",t,e)},t.Ajax=new e}(window.Match),function(t){function e(){this.lastTime=(new Date).getTime(),this._currentFps=0,this.fps="",this.gameTime=1,this.timeInMillis=0,this.totalFps=0}e.prototype.reset=function(){this.fps="",this.totalFps=0,this._currentFps=0,this.timeInMillis=0,this.gameTime=1},e.prototype.count=function(){this.timeInMillis=(new Date).getTime(),this.timeInMillis-this.lastTime>=1e3?(this.lastTime=this.timeInMillis,this.fps=this._currentFps,this.gameTime++,this.totalFps+=this.fps,this._currentFps=0):this._currentFps++},e.prototype.getAverageFps=function(){return 0==this.totalFps?60:Math.floor(this.totalFps/this.gameTime)},t.FpsCounter=new e}(window.Match),function(t){function e(){this.hasFocus=!1}e.prototype.onLoop=function(){throw new Error("Method GameObject.onLoop is abstract and must be overriden")},t.GameObject=e,e.name="GameObject"}(window.M),function(t){function e(){this.math=Math}function i(t,e){this.x=t||0,this.y=e||0,this.prevX=0,this.prevY=0}e.prototype.valueInBetween=function(t,e,i){return t>=e&&i>=t},e.prototype.getXFromCircle=function(t,e,i){return t+e*this.math.cos(i)},e.prototype.getYFromCircle=function(t,e,i){return t+e*this.math.sin(i)},e.prototype.getPointFromCircle=function(t,e,i,o){return this.getPointFromElipsis(t,e,i,i,o)},e.prototype.getPointFromElipsis=function(t,e,o,n,s){return new i(this.getXFromCircle(t,o,s),this.getYFromCircle(e,n,s))},e.prototype.getVector2d=function(t,e){return new i(e.x-t.x,e.y-t.y)},e.prototype.getVector=function(t,e){return this.getVector2d(t,e)},e.prototype.getRotatedVertex=function(t,e){return this.getRotatedVertexCoords(t.x,t.y,e)},e.prototype.getRotatedVertexCoordsX=function(t,e,i){return t*this.math.cos(i)-e*this.math.sin(i)},e.prototype.getRotatedVertexCoordsY=function(t,e,i){return e*this.math.cos(i)+t*this.math.sin(i)},e.prototype.getRotatedVertexCoords=function(t,e,o){return new i(this.getRotatedVertexCoordsX(t,e,o),this.getRotatedVertexCoordsY(t,e,o))},e.prototype.getMagnitude=function(t){return this.math.sqrt(t.x*t.x+t.y*t.y)},e.prototype.getSquareDistance=function(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o},e.prototype.getAngleBetweenVectors=function(t,e){var i=this.getMagnitude(t)*this.getMagnitude(e);return this.math.acos((t.x*e.x+t.y*e.y)/i)},e.prototype.getCosBetweenVectors=function(t,e){var i=this.getMagnitude(t)*this.getMagnitude(e);return(t.x*e.x+t.y*e.y)/i},e.prototype.getDistance=function(t,e){return this.math.sqrt(this.getSquareDistance(t,e))},e.prototype.haveTheSameDirection=function(t,e){return t.x>0&&e.x<0?!1:t.x<0&&e.x>0?!1:t.y>0&&e.y<0?!1:t.y<0&&e.y>0?!1:!0},e.prototype.areParallelVectors=function(t,e){t=this.getNormalized(t),e=this.getNormalized(e);var i=t.x/e.x,o=t.y/e.y;return i>=o-.1&&o+.1>=i},e.prototype.getNormalized=function(t){var e=this.getMagnitude(t);return new i(t.x/e,t.y/e)},e.prototype.substract=function(t,e){return new i(t.x-e.x,t.y-e.y)},e.prototype.add=function(t,e){return new i(t.x+e.x,t.y+e.y)},e.prototype.scalarProduct=function(t,e){return new i(t.x*e,t.y*e)},e.prototype.rotateIfNeeded=function(t,e,i){if(!this.areParallelVectors(t,e)||!this.haveTheSameDirection(t,e)){var o=this.getSquareDistance(t,e),n=this.getRotatedVertex(t,i),s=this.getSquareDistance(n,e);if(o>s)return t.x=n.x,t.y=n.y,i;var r=this.getRotatedVertex(t,-i);return t.x=r.x,t.y=r.y,-i}return 0},e.prototype.gauss=function(t){for(var e=t.length,i=0;e>i;i++){for(var o=Math.abs(t[i][i]),n=i,s=i+1;e>s;s++)Math.abs(t[s][i])>o&&(o=Math.abs(t[s][i]),n=s);for(var s=i;e+1>s;s++){var r=t[n][s];t[n][s]=t[i][s],t[i][s]=r}for(s=i+1;e>s;s++)for(var a=-t[s][i]/t[i][i],h=i;e+1>h;h++)i==h?t[s][h]=0:t[s][h]+=a*t[i][h]}for(var u=new Array(e),i=e-1;i>-1;i--){u[i]=t[i][e]/t[i][i];for(var s=i-1;s>-1;s--)t[s][e]-=t[s][i]*u[i]}return u},e.prototype.quadDerivative=function(t,e,i){return[2*t,e]},i.prototype.offset=function(t,e){return this.set(this.x+t,this.y+e),this},i.prototype.set=function(t,e){return this.setX(t),this.setY(e),this},i.prototype.reset=function(){return this.set(0,0)},i.prototype.setX=function(t){return this.prevX=this.x,this.x=t,this},i.prototype.setY=function(t){return this.prevY=this.y,this.y=t,this},i.prototype.rotate=function(t){return this.setX(o.getRotatedVertexCoordsX(this.x,this.y,t)),this.setY(o.getRotatedVertexCoordsY(this.x,this.y,t)),this},t.Vector2d=i;var o=new e;t.math2d=t.Math2d=o,t.math2d.Vector2d=i}(window.Match),function(t,e){function i(){this.extendsEventHandler(),this._x=0,this._y=0,this._prevX=0,this._prevY=0,this.viewportWidth=0,this.viewportHeight=0,this._halfViewportHeight=0,this._halfViewportWidth=0,this._boundingArea=null}i.prototype.setBoundingArea=function(t,e,i,o){this._boundingArea={minX:t,minY:e,maxX:i,maxY:o}},i.prototype.setViewport=function(t,e){this.viewportWidth=t,this.viewportHeight=e,this._halfViewportWidth=t/2,this._halfViewportHeight=e/2},i.prototype.centerAtRenderizable=function(t){this.centerAt(t._x,t._y)},i.prototype.centerAt=function(t,e){t-=this._halfViewportWidth,e-=this._halfViewportHeight,this._boundingArea&&(t<this._boundingArea.minX&&(t=this._boundingArea.minX),e<this._boundingArea.minY&&(e=this._boundingArea.minY),t>this._boundingArea.maxX&&(t=this._boundingArea.maxX),e>this._boundingArea.maxY&&(e=this._boundingArea.maxY)),this.setX(t),this.setY(e)},i.prototype.setX=function(t){this._prevX=this._x,this._x=t,this.raiseEvent("locationChanged")},i.prototype.setY=function(t){this._prevY=this._y,this._y=t,this.raiseEvent("locationChanged")},i.prototype.reset=function(){this.setX(0),this.setY(0)},i.prototype.getX=function(){return this._x},i.prototype.getY=function(){return this._y},i.prototype.offsetX=function(t){this.setX(this._x+t)},i.prototype.offsetY=function(t){this.setY(this._y+t)},i.prototype.offset=function(t,e){this.offsetX(t),this.offsetY(e)},i.prototype.getLeftFromLayer=function(t){return this._x*t.parrallaxFactor.x},i.prototype.getTopFromLayer=function(t){return this._y*t.parrallaxFactor.y},i.prototype.getBottomFromLayer=function(t){return this.getTopFromLayer(t)+this.viewportHeight},i.prototype.getRightFromLayer=function(t){return this.getLeftFromLayer(t)+this.viewportWidth},i.prototype.canSee=function(t,e,i){if(0==t._alpha||!t._visible)return!1;var o=0;return o=t._halfWidth>t._halfHeight?t._halfWidth:t._halfHeight,this._y+this.viewportHeight<t.getTop()*i?!1:this._y-this.viewportHeight>t.getBottom()*i?!1:this._x+this.viewportWidth<t.getLeft()*e?!1:this._x-this.viewportWidth>t.getRight()*e?!1:!0},t.extend(i,e),t.Camera=i}(Match,EventHandler),function(t,e){function i(t,e,i,o,n){this.angle=0,this._rotationSpeed=.1,this.speed=.05,this.vanishRate=.005,this.alpha=1,this.setPath(t,e),this.setWidth(i),this.setHeight(o)}function o(t,o,n,s,r,a,h,u,p,c,l,d){for(var f=e.Math2d,g=[],y=0;t>y;y++){var m=new i(o,{x:o.x+5*n.x,y:o.y+5*n.y});if(m.setWidth(f.randomInt(s,a)),m.setHeight(f.randomInt(r,h)),c)m.color=c[f.randomInt(0,c.length-1)];else switch(f.randomInt(0,2)){case 0:m.color="rgb(255, 128, 0)";break;case 1:m.color="rgb(255, 180, 0)";break;case 2:m.color="rgb(255, 80, 0)"}d?m.vanishRate=f.randomFloat(l,d):l&&(m.vanishRate=l),m.speed=f.randomFloat(u,p),g.push(m)}return g}function n(t,e,i,o,n,s,r,a,h){this.minAngle||(this.minAngle=0),this.maxAngle||(this.maxAngle=6.28),this.amount=t,this.color=e,this.minWidth=i||1,this.minHeight=o||1,this.maxWidth=n||3,this.maxHeight=s||3,this.minSpeed=r||.01,this.maxSpeed=a||.1,this.vanishRate=h}function s(t,i,n,s,r,a,h,u,p){this.origin=origin,this.direction=direction,this.particles=o(particleAmount,origin,direction,n||4,s||4,r||8,a||8,h||.01,u||.4,i,p||e.Math2d.randomFloat(.01,.03)),this.visibleParticles=this.particles.length}function r(t){this.operation="source-atop",this.startTime=0,e.applyProperties(this,t,["fillStyle"])}function a(t,i,o){
void 0==i&&(i=1),this.rate=1/(i*e.getAverageFps()),this.object=t,this.onFinished=o}function h(t,i,o){void 0==i&&(i=1),this.rate=1/(i*e.getAverageFps()),this.object=t,this.onFinished=o}function u(t,e,i){void 0==e&&(e=1),this.seconds=e,this.object=t,this.timer=0,this.onFinished=i}function p(t,i,o,n,s){void 0==i&&(i=1),this.rate=1/(i*e.getAverageFps()),this.object=t,this.min=n||0,this.max=s||1,t.setAlpha(1),this.onFinished=this.changeFade,o?this.onLoop=this.fadeOut:this.onLoop=this.fadeIn}function c(t,i,o,n,s){this.object=t,this._x=i,this._y=o,void 0==n&&(n=1),this.onFinished=s;var r=e.Math2d,a=n*e.getAverageFps(),h=new r.Vector2d(t._x,t._y),u=new r.Vector2d(i,o);this.speed=r.getDistance(h,u)/a,this.direction=e.Math2d.getNormalized(e.Math2d.getVector2d(h,u))}function l(t,i,o,n,s){var r=n*e.getAverageFps();t._scale||(t._scale={x:1,y:1}),this.speedX=Math.abs(t._scale.x-i)/r,this.speedY=Math.abs(t._scale.y-o)/r,this.object=t,this._x=i,this._y=o,this.onFinished=s}function d(t,i,o,n,s){var r=n*e.getAverageFps();t._scale||(t._scale={x:1,y:1}),this.speedX=Math.abs(t._scale.x-i)/r,this.speedY=Math.abs(t._scale.y-o)/r,this.object=t,this._x=i,this._y=o,this.onFinished=s}function f(t,e,i,o){this.object=t,void 0==e?this.times=6:this.times=2*e,void 0==i?this.duration=250:this.duration=i,this.lastTime=0,this.onFinished=o}function g(t,i,o,n){o||(o=1),this.frames=o*e.getAverageFps(),t._rotation||(t._rotation=0),this.object=t,this.angle=i,this.onFinished=n,this._rotation=(this.angle-t._rotation)/this.frames}i.prototype.setWidth=function(t){this._halfWidth=t/2},i.prototype.setHeight=function(t){this._halfHeight=t/2},i.prototype.setPath=function(t,i){this._x=t.x,this._y=t.y,this.direction=e.math2d.getVector2d(t,i)},i.prototype.onLoop=function(){this.alpha-=this.vanishRate,this.angle+=this._rotationSpeed,this._x+=this.speed*this.direction.x,this._y+=this.speed*this.direction.y},i.prototype.onRender=function(t,e,i,o){this.alpha>=0&&(t.save(),t.globalAlpha=this.alpha,t.translate(this._x-i,this._y-o),t.rotate(this.angle),t.fillStyle=this.fillStyle,t.fillRect(-this._halfWidth,-this._halfHeight,this._halfWidth,this._halfHeight),t.restore())},i.prototype.setZIndex=function(t){this._zIndex=t},i.prototype.isVisible=function(t,i,o,n){if(this.alpha<=0)return!1;e.camera;return this._y+this._halfHeight<i?!1:this._y-this._halfHeight>n?!1:this._x+this._halfWidth<t?!1:this._x-this._halfWidth>o?!1:!0},n.prototype.onLoop=function(){if(this.children){for(var t,e=0,i=this.children.length,o=0;i>e;e++)t=this.children[e],t.alpha<=0?o++:t.onLoop();o==i&&(this.children=null)}},n.prototype.onRender=function(){},n.prototype.isVisible=function(){return!0},n.prototype.setZIndex=function(t){this._zIndex=t},n.prototype.create=function(t,o){var n=e.random;this.children=new Array;for(var s=0;s<this.amount;s++){var r,a=n.decimal(this.minAngle,this.maxAngle),h=50,u=new Object,p=new Object;if(u.x=t,u.y=o,p.x=t+h*Math.cos(a),p.y=o+h*Math.sin(a),r=new i(u,p),r.setWidth(n.integer(this.minWidth,this.maxWidth)),r.setHeight(n.integer(this.minHeight,this.maxHeight)),this.color)r.fillStyle=this.color[n.integer(0,color.length-1)];else switch(n.integer(0,2)){case 0:r.fillStyle="rgb(255, 128, 0)";break;case 1:r.fillStyle="rgb(255, 180, 0)";break;default:r.fillStyle="rgb(255, 80, 0)"}this.vanishRate&&(r.vanishRate=this.vanishRate),r.speed=n.decimal(this.minSpeed,this.maxSpeed),this.children.push(r)}},s.prototype.create=function(t,e){},s.prototype.onLoop=function(t){if(this.visible){for(var i,o=0;o<this.particles.length;o++)i=this.particles[o],i.onLoop(t),i.isVisible()||(this.loop?(i.setPath(this.origin,{x:this.origin.x+5*this.direction.x,y:this.origin.y+5*this.direction.y}),i.rotation=0,i.alpha=1,i.angle=0,i.vanishRate=e.Math2d.randomFloat(.05,.2),i.speed=e.Math2d.randomFloat(.005,.5)):this.visibleParticles--);this.visibleParticles<1&&e.remove(this)}},r.prototype.render=function(t,e,i){this.isVisible()&&(t.globalCompositeOperation=this.operation,t.fillStyle=this.fillStyle,t.fillRect(0,0,e,i))},r.prototype.show=function(){this.startTime=e.getTimeInMillis()},r.prototype.isVisible=function(){return this.showAlways||e.getTimeInMillis()-this.startTime<this.duration},a.prototype.initialize=function(){return this.object.setAlpha(0),this.onLoop=this.run,!0},a.prototype.run=function(){var t=this.object.getAlpha()+this.rate;return 1>t?(this.object.setAlpha(t),!0):(this.object.setAlpha(1),this.onFinished&&this.onFinished.apply(this.object),!1)},a.prototype.onLoop=a.prototype.initialize,h.prototype.initialize=function(){return this.object.setAlpha(1),this.onLoop=this.run,!0},h.prototype.run=function(){var t=this.object.getAlpha()-this.rate;return t>0?(this.object.setAlpha(t),!0):(this.object.setAlpha(0),this.onFinished&&this.onFinished.apply(this.object),!1)},h.prototype.onLoop=h.prototype.initialize,u.prototype.initialize=function(t){this.timer=new e.TimeCounter(1e3*this.seconds),this.onLoop=this.run},u.prototype.run=function(){return this.timer.elapsed()?(this.onFinished&&this.onFinished.apply(this.object),!1):!0},u.prototype.onLoop=u.prototype.initialize,p.prototype.fadeIn=function(t){var e=this.object._alpha+this.rate;return e<this.max?this.object.setAlpha(e):(this.object.setAlpha(this.max),this.onLoop=this.fadeOut),!0},p.prototype.fadeOut=function(){var t=this.object._alpha-this.rate;return t>this.min?this.object.setAlpha(t):(this.object.setAlpha(this.min),this.onLoop=this.fadeIn),!0},c.prototype.onLoop=function(t){var e=Math.abs(this._x-this.object._x)>this.speed,i=Math.abs(this._y-this.object._y)>this.speed;return e&&this.object.offsetX(this.direction.x*this.speed),i&&this.object.offsetY(this.direction.y*this.speed),e||i?!0:(this.object.setLocation(this._x,this._y),this.onFinished&&this.onFinished.apply(this.object),!1)},l.prototype.onLoop=function(t){return this.object._scale.x<this._x&&(this.object._scale.x+=this.speedX),this.object._scale.y<this._y&&(this.object._scale.y+=this.speedY),this.object._scale.x>=this._x&&this.object._scale.y>=this._y?(this.onFinished&&this.onFinished.apply(this.object),!1):!0},d.prototype.onLoop=function(t){return this.object._scale.x>this._x&&(this.object._scale.x-=this.speedX),this.object._scale.y>this._y&&(this.object._scale.y-=this.speedY),this.object._scale.x<=this._x&&this.object._scale.y<=this._y?(this.onFinished&&this.onFinished.apply(this.object),!1):!0},f.prototype.onLoop=function(t){if(e.getTimeInMillis()-this.lastTime>=this.duration){if(!this.times--)return this.object.setAlpha(void 0),this.onFinished&&this.onFinished.apply(this.object),!1;1==this.object._alpha?this.object.setAlpha(0):this.object.setAlpha(1),this.lastTime=e.getTimeInMillis()}return!0},g.prototype.onLoop=function(t){return this.frames--?(this.object.offsetRotation(this._rotation),!0):(this.onFinished&&this.onFinished.apply(this.object),!1)},t.visual={Particle:i,LinearParticleEmitter:s,RadialParticleEmitter:n,Tint:r,Move:c,FadeIn:a,FadeOut:h,ContinousFade:p,ScaleUp:l,ScaleDown:d,Rotate:g,Twinkle:f,Wait:u}}(M.effects||(M.effects={}),M),function(t,e){function i(t,e,i,o,n,s,r,a){this.object=t,this.endValueX=e,this.endValueY=i,this.startValueX=0,this.startValueY=0,this.easingMethodX=this[n]||this.linearTween,this.easingMethodY=this[s]||this.easingMethodX,this.currentFrame=1,this.durationSeconds=o,this.mathCached=Math,this.totalFrames=0,this.loop=r,this._needsStartValue=!0,this.onFinished=a}i.prototype._init=function(){var t=this.durationSeconds;if("string"==typeof t&&-1!=t.indexOf("px")){t=parseInt(t);var i=this.endValueX-this.object.getX(),o=this.endValueY-this.object.getY(),n=t,s=i/n,r=o/n;t=Math.max(s,r)}return this.totalFrames=t*e.getAverageFps(),this.currentFrame=0,(this._needsStartValue||!this.loop)&&(this.startValueX=this.object.getX(),this.startValueY=this.object.getY(),this.endValueX=this.endValueX-this.startValueX,this.endValueY=this.endValueY-this.startValueY,this._needsStartValue=!1),this.onLoop=this._ease,!0},i.prototype._ease=function(){return this.object.setLocation(this.easingMethodX(this.currentFrame,this.startValueX,this.endValueX,this.totalFrames),this.easingMethodY(this.currentFrame,this.startValueY,this.endValueY,this.totalFrames)),this.currentFrame++,this.currentFrame<=this.totalFrames?!0:(this.onFinished&&this.onFinished.apply(this.object),this.loop?(this.onLoop=this._init,!0):!1)},i.prototype.onLoop=i.prototype._init,i.prototype.linearTween=function(t,e,i,o){return i*t/o+e},i.prototype.easeInQuad=function(t,e,i,o){return t/=o,i*t*t+e},i.prototype.easeOutQuad=function(t,e,i,o){return t/=o,-i*t*(t-2)+e},i.prototype.easeInOutQuad=function(t,e,i,o){return t/=o/2,1>t?i/2*t*t+e:(t--,-i/2*(t*(t-2)-1)+e)},i.prototype.easeInCubic=function(t,e,i,o){return t/=o,i*t*t*t+e},i.prototype.easeOutCubic=function(t,e,i,o){return t/=o,t--,i*(t*t*t+1)+e},i.prototype.easeInOutCubic=function(t,e,i,o){return t/=o/2,1>t?i/2*t*t*t+e:(t-=2,i/2*(t*t*t+2)+e)},i.prototype.easeInQuart=function(t,e,i,o){return t/=o,i*t*t*t*t+e},i.prototype.easeOutQuart=function(t,e,i,o){return t/=o,t--,-i*(t*t*t*t-1)+e},i.prototype.easeInOutQuart=function(t,e,i,o){return t/=o/2,1>t?i/2*t*t*t*t+e:(t-=2,-i/2*(t*t*t*t-2)+e)},i.prototype.easeInQuint=function(t,e,i,o){return t/=o,i*t*t*t*t*t+e},i.prototype.easeOutQuint=function(t,e,i,o){return t/=o,t--,i*(t*t*t*t*t+1)+e},i.prototype.easeInOutQuint=function(t,e,i,o){return t/=o/2,1>t?i/2*t*t*t*t*t+e:(t-=2,i/2*(t*t*t*t*t+2)+e)},i.prototype.easeInSine=function(t,e,i,o){return-i*this.mathCached.cos(t/o*(this.mathCached.PI/2))+i+e},i.prototype.easeOutSine=function(t,e,i,o){return i*this.mathCached.sin(t/o*(this.mathCached.PI/2))+e},i.prototype.easeInOutSine=function(t,e,i,o){return-i/2*(this.mathCached.cos(this.mathCached.PI*t/o)-1)+e},i.prototype.easeInExpo=function(t,e,i,o){return i*this.mathCached.pow(2,10*(t/o-1))+e},i.prototype.easeOutExpo=function(t,e,i,o){return i*(-this.mathCached.pow(2,-10*t/o)+1)+e},i.prototype.easeInOutExpo=function(t,e,i,o){return t/=o/2,1>t?i/2*this.mathCached.pow(2,10*(t-1))+e:(t--,i/2*(-this.mathCached.pow(2,-10*t)+2)+e)},i.prototype.easeInCirc=function(t,e,i,o){return t/=o,-i*(this.mathCached.sqrt(1-t*t)-1)+e},i.prototype.easeOutCirc=function(t,e,i,o){return t/=o,t--,i*this.mathCached.sqrt(1-t*t)+e},i.prototype.easeInOutCirc=function(t,e,i,o){return t/=o/2,1>t?-i/2*(this.mathCached.sqrt(1-t*t)-1)+e:(t-=2,i/2*(this.mathCached.sqrt(1-t*t)+1)+e)},t.Easing=i}(M.effects.visual,M),function(t,e){function i(t,e){e?(this.min=e,this.pauseAfterFade=!1):(this.min=.1,this.pauseAfterFade=!0),this.sound=t}function o(t,e){e||(this.max=.9),this.sound=t}function n(t,e,i){this.soundFrom=t,this.soundTo=e,this.max=i,this.currentStep=this.fadeOut}function s(t,e){this.max=t.volume,this.soundFrom=t,this.soundTo=e,this.currentStep=this.fadeOut}function r(t){this.sounds=t,this.currentSoundIndex=0,this.sounds[0].play()}function a(t,o){e.push(new i(t,o))}function h(t,i){e.push(new o(t,i))}function u(t,i,o){e.push(new n(t,i,o))}function p(t){e.push(new r(t))}i.prototype={onLoop:function(){this.sound.volume>this.min?this.sound.volume-=.004:(this.pauseAfterFade&&this.sound.pause(),e.remove(this))}},o.prototype={onLoop:function(){this.sound.volume<this.max?this.sound.volume+=.004:e.remove(this)}},n.prototype={fadeOut:function(){this.soundFrom.volume>.05?this.soundFrom.volume-=.004:(this.soundFrom.pause(),this.soundTo.volume=0,this.soundTo.play(),this.currentStep=this.fadeIn)},fadeIn:function(){this.soundTo.volume<this.max?this.soundTo.volume+=.004:e.remove(this)},onLoop:function(){this.currentStep()}},s.prototype={fadeOut:function(){this.soundFrom.volume>.25?this.soundFrom.volume-=.01:(this.soundTo.play(),this.currentStep=this.fadeIn)},fadeIn:function(){this.soundTo.ended&&this.soundFrom.volume<this.max?this.soundTo.volume+=.01:e.remove(this)},onLoop:function(){this.currentStep()}},r.prototype={onLoop:function(){this.sounds[this.currentSoundIndex].ended&&(this.currentSoundIndex++,this.currentSoundIndex<this.sounds.length?this.sounds[this.currentSoundIndex].play():e.remove(this))}},t.sound={fadeOut:a,fadeIn:h,transition:u,soundOver:u,soundQueue:p}}(M.effects||(M.effects={}),M),function(t,e){function i(t){this.objects=[],this.mode=null,this.setMode(t||"Polygon")}i.prototype={reset:function(){this.objects=[]},onLoop:function(){for(var e=0,i=1;e<this.objects.length;){for(;i<this.objects.length;)this.checkCollisions(this.objects[e],this.objects[i]),i++;e++,i=e+1}for(e=this.objects.length;e--;)this.objects[e]._visible||t.removeIndexFromArray(e,this.objects)},canCollide:function(t,e){if(t.cantCollideType)for(var i=t.cantCollideType.length;i--;)if(e instanceof t.cantCollideType[i])return!1;if(t.cantCollide)for(var i=t.cantCollide.length;i--;)if(t.cantCollide[i]==e)return!1;return!0},checkCollisions:function(t,e){this.canCollide(t,e)&&this.canCollide(e,t)&&this.mode.haveCollided(t,e)&&(t.onCollision&&t.onCollision(e),e.onCollision&&e.onCollision(t))},setMode:function(e,i){"string"==typeof e?this.mode=t.collisions[e]:this.mode=e},push:function(t){this.objects.push(t)},removeType:function(t){for(var e=this.objects.length;e--;)this.objects[e]instanceof t&&this.remove(this.objects[e])}},e.AllvsAllCollisionHandler=i}(window.Match,window.Match.collisions||(window.Match.collisions={})),function(t,e){function i(t){this.colliders=[],this.collidables=[],this.setMode(t||"Polygon"),this.colliderCallback="onCollision",this.collidableCallback="onCollision"}i.prototype={onLoop:function(){for(var t=this.colliders.length;t--;)this.checkCollisions(this.colliders[t],this.collidables)},checkCollisions:function(t,e){if(t)for(var i=e.length,o=null;i--;){if(o=e[i],!o)return;o instanceof Array?this.checkCollisions(t,o):this.mode.haveCollided(t,o)&&(t[this.colliderCallback]&&t[this.colliderCallback](o),o[this.collidableCallback]&&o[this.collidableCallback](t))}},setMode:function(e){"string"==typeof e?this.mode=t.collisions[e]:this.mode=e}},e.CollisionHandler=i}(window.Match,window.Match.collisions||(window.Match.collisions={})),function(t,e){function i(){this.math2d=e}i.prototype={getCollisionArea:function(t){var e=[],i=t.getWidth()/2,o=t.getHeight()/2;return e.push({x:-i,y:-o}),e.push({x:i,y:-o}),e.push({x:i,y:o}),e.push({x:-i,y:o}),this.rotate(e,t._rotation),this.translate(e,t._x,t._y),e},translate:function(t,e,i){for(var o=0;o<t.length;o++)t[o].x+=e,t[o].y+=i},rotate:function(t,e){if(e)for(var i=0;i<t.length;i++)t[i]=this.math2d.getRotatedVertex(t[i],e)},haveCollided:function(t,e){for(var i=this.getCollisionArea(e),o=this.getCollisionArea(t),n=0;n<o.length;n++){if(this.pointInPolygon(o[n].x,o[n].y,i))return!0;if(this.pointInPolygon(i[n].x,i[n].y,o))return!0}return!1},pointInPolygon:function(t,e,i){var o,n,s,r,a=!1,h=i.length;for(o=0,n=h-1;h>o;n=o++)s=i[o],r=i[n],s.y>e!=r.y>e&&t<(r.x-s.x)*(e-s.y)/(r.y-s.y)+s.x&&(a=!a);return a}},t.Polygon=new i}(window.Match.collisions||(window.Match.collisions={}),window.Match.math2d),function(t){function e(){}e.prototype={haveCollided:function(t,e){var i=0,o=0;return i=t._halfWidth>t._halfHeight?t._halfWidth:t._halfHeight,o=e._halfWidth>e._halfHeight?e._halfWidth:e._halfHeight,t._y+i<e._y-o?!1:t._y-i>e._y+o?!1:t._x+i<e._x-o?!1:t._x-i>e._x+o?!1:!0}},t.Square=new e}(window.Match.collisions||(window.Match.collisions={})),function(t,e){function i(t){this.math2d=e}i.prototype={haveCollided:function(t,e){var i=t.getWidth()*t.getHeight()/2,o=e.getWidth()*e.getHeight()/2,n=o>i?i:o;return this.math2d.getSquareDistance(t.getLocation(),e.getLocation())<=n*n}},t.Radial=new i}(window.Match.collisions||(window.Match.collisions={}),window.Match.math2d),function(t){function e(){}e.prototype={haveCollided:function(t,e){return t.getBottom()<e.getTop()?!1:t.getTop()>e.getBottom()?!1:t.getRight()<e.getLeft()?!1:t.getLeft()>e.getRight()?!1:!0}},t.Simple=new e}(window.Match.collisions||(window.Match.collisions={})),function(t,e){function i(){this.testContext=document.createElement("canvas").getContext("2d")}i.prototype.haveCollided=function(e,i){var o,n=(t.frontBuffer.canvas,window.Math),s=n.min(e.getLeft(),i.getLeft()),r=n.min(e.getTop(),i.getTop()),a=n.max(e.getRight(),i.getRight())-s,h=n.max(e.getBottom(),i.getBottom())-r,u=this.testContext,p=0,c=0;for(u.clearRect(s,r,a,h),u.save(),e.onRender(u,u.canvas,0,0),u.globalCompositeOperation="source-in",i.onRender(u,u.canvas,0,0),u.restore(),o=u.getImageData(s,r,a,h);p<o.width;){for(;c<o.height;){var l=4*(c*o.width+p);if(0!=o.data[l+3])return!0;c++}p++,c=0}return!1},e.PixelPerfect=new i}(window.Match,window.Match.collisions||(window.Match.collisions={})),function(t){function e(t){u.mousedown(t)}function i(t){u.mouseup(t)}function o(t){u.click(t)}function n(t){u.mousemove(t)}function s(t){u.mousewheel(t)}function r(t){u.DOMMouseScroll(t)}function a(t){t.preventDefault()}function h(){this.events={0:{},1:{},2:{}},this.x=null,this.y=null,this.isDragging=!1}var u;h.prototype.LEFT=0,h.prototype.MIDDLE=1,h.prototype.RIGHT=2,h.prototype.select=function(t,e){this.isDragging||(t.selectedView=e,this.selectedObject=t)},h.prototype.preventContexMenu=function(t){t?document.addEventListener("contextmenu",a,!1):document.removeEventListener("contextmenu",a,!1)},h.prototype.fireEventOnLastSelectedObject=function(){var t=this.selectedObject,e=this.prevSelectedObject;t?(!t._mouseInRaised&&t.listensTo("mouseIn")&&(t._mouseInRaised=!0,t.raiseEvent("mouseIn",this)),e&&e!=t&&(e._mouseInRaised=!1,e.listensTo("mouseOut")&&e.raiseEvent("mouseOut",this)),this.up()&&t.listensTo("mouseUp")&&t.raiseEvent("mouseUp",this),this.clicked()&&t.listensTo("click")&&t.raiseEvent("click",this),this.down()&&(t.listensTo("mouseDown")&&t.raiseEvent("mouseDown",this),this.isDragging=!0,t.listensTo("mouseDrag")&&t.raiseEvent("mouseDrag",this)),t.listensTo("mouseOver")&&t.raiseEvent("mouseOver",this),this.moved()&&t.listensTo("mouseMove")&&t.raiseEvent("mouseMove",this),this.wheel()&&t.listensTo("mouseWheel")&&t.raiseEvent("mouseWheel",this)):e&&e.listensTo("mouseOut")&&(e._mouseInRaised=!1,e.raiseEvent("mouseOut",this)),this.prevSelectedObject=t,this.isDragging||this.deselectObject()},h.prototype.deselectObject=function(){this.selectedObject&&(this.selectedObject.selectedView=null,this.selectedObject=null)},h.prototype.clicked=function(t){return null!=t?this.events[t].click:this.events[0].click},h.prototype.down=function(t){return null!=t?this.events[t].down:this.events[0].down||this.events[1].down||this.events[2].down},h.prototype.up=function(t){return null!=t?this.events[t].up:this.events[0].up||this.events[1].up||this.events[2].up},h.prototype.moved=function(){return this.eventMouseMove},h.prototype.wheel=function(){return this.wheelDeltaY=0,this.eventMouseWheel&&(this.wheelDeltaY=this.eventMouseWheel.wheelDeltaY),this.wheelDeltaY},h.prototype.clear=function(){for(var t=0;3>t;t++)this.events[t].up=null,this.events[t].click=null;this.eventMouseWheel=null,this.eventMouseMove=null},h.prototype.click=function(t){this.events[t.button].click=t,this.x=t.offsetX,this.y=t.offsetY},h.prototype.mousedown=function(t){this.events[t.button].down=t},h.prototype.mouseup=function(t){this.events[t.button].down=null,this.events[t.button].up=t,this.isDragging=!1},h.prototype.mousewheel=function(t){this.eventMouseWheel=t},h.prototype.DOMMouseScroll=function(t){this.mousewheel({wheelDeltaY:-40*t.detail})},h.prototype.isOverPixelPerfect=function(e){if(e._visible){var i=t.offScreenContext,o=t.offScreenCanvas,n=t.getCamera();o.width=t.renderer.frontBuffer.canvas.width,o.height=t.renderer.frontBuffer.canvas.height,i.save(),i.clearRect(0,0,o.width,o.height),t.renderer.render(e,i,n._x,n._y),i.restore();var s=i.getImageData(this.x,this.y,1,1);return s.data[3]?s.data[0]?!0:s.data[1]?!0:s.data[2]?!0:!1:!1}},h.prototype.isOverPolygon=function(e){var i=t.getCamera(),o=this.x+i._x,n=this.y+i._y;return e._rotation?(this._x=o,this._y=n,t.collisions.Polygon.haveCollided(e,this)):e.getBottom()<n?!1:e.getTop()>n?!1:e.getRight()<o?!1:e.getLeft()>o?!1:!0},h.prototype.getHeight=function(){return 2},h.prototype.getWidth=function(){return 2},h.prototype.update=function(){this.fireEventOnLastSelectedObject(),this.clear()},h.prototype.applyToObject=function(t){var e,i=t.views._values,o=0,n=i.length;if(t.listensTo("mouseOver")||t.listensTo("mouseIn")||t.listensTo("mouseOut")||t.listensTo("onMouseWheel")||t.listensTo("mouseDown")&&this.down()||t.listensTo("mouseUp")&&this.up()||t.listensTo("click")&&this.clicked())for(;n>o;o++)e=i[o],this.isOverPolygon(e)&&this.isOverPixelPerfect(e)&&this.select(t,e)},t.browser.isFirefox?(h.prototype.mousemove=function(t){this.eventMouseMove=t,this.prevX=this.x,this.prevY=this.y,this.x=t.layerX-t.target.offsetLeft,this.y=t.layerY-t.target.offsetTop},h.prototype.click=function(t){this.events[t.button].click=t,this.prevX=this.x,this.prevY=this.y,this.x=t.layerX-t.target.offsetLeft,this.y=t.layerY-t.target.offsetTop}):h.prototype.mousemove=function(t){this.eventMouseMove=t,this.prevX=this.x,this.prevY=this.y,this.x=t.offsetX,this.y=t.offsetY},h.prototype.bind=function(){t.browser.isFirefox?document.addEventListener("DOMMouseScroll",r,!1):"MSIE 9.0"==t.browser.name?document.addEventListener("onwheel",s,!1):document.addEventListener("mousewheel",s,!1),document.addEventListener("mousedown",e,!1),document.addEventListener("mouseup",i,!1),document.addEventListener("mousemove",n,!1),document.addEventListener("click",o,!1),t.setMouse(this)},h.prototype.unbind=function(){t.browser.isFirefox?document.removeEventListener("DOMMouseScroll",r):"MSIE 9.0"==t.browser.name?document.removeEventListener("onwheel",s):document.removeEventListener("mousewheel",s),document.removeEventListener("mousedown",e),document.removeEventListener("mouseup",i),document.removeEventListener("mousemove",n),document.removeEventListener("click",o),t.setMouse(null)},u=new h,u.bind()}(window.Match),function(t){function e(t){o.accelerate(t)}function i(){}var o;i.prototype.accelerate=function(t){this._hasEvent=!0,this.accelerationIncludingGravity=t.accelerationIncludingGravity,this.acceleration=t.acceleration,this.rotationRate=t.rotationRate},i.prototype.update=function(){this._hasEvent=!1},i.prototype.right=function(){return this._hasEvent&&(this.acceleration.x>0||this.accelerationIncludingGravity.x>0)},i.prototype.left=function(){return this._hasEvent&&(this.acceleration.x<0||this.accelerationIncludingGravity.y<0)},i.prototype.up=function(){return this._hasEvent&&this.acceleration.y>0},i.prototype.down=function(){return this._hasEvent&&this.acceleration.y<0},i.prototype.applyToObject=function(t){this._hasEvent&&(t.onDeviceAccelerationIncludingGravity&&t.onDeviceAccelerationIncludingGravity(this.accelerationIncludingGravity.x,this.accelerationIncludingGravity.y,this.accelerationIncludingGravity.z,this.rotationRate),t.onDeviceAcceleration&&t.onDeviceAcceleration(this.acceleration.x,this.acceleration.y,this.acceleration.z,this.rotationRate),t.onDeviceRotation&&t.onDeviceRotation(this.rotationRate.alpha,this.rotationRate.beta,this.rotationRate.gamma))},i.prototype.bind=function(){window.addEventListener("devicemotion",e,!1),t.setAccelerometer(this)},i.prototype.unbind=function(){window.removeEventListener("devicemotion",e),t.setAccelerometer(null)},o=new i,o.bind()}(window.Match),function(t){function e(t){n.fireDown(t)}function i(t){n.fireUp(t)}function o(){this.keysDown={length:0},this.keysUp=null,this.keysPressed={}}var n;o.prototype.bind=function(){document.addEventListener("keydown",e,!1),document.addEventListener("keyup",i,!1),t.setKeyboard(this)},o.prototype.unbind=function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",i),t.setKeyboard(null)},o.prototype[8]="backspace",o.prototype[9]="tab",o.prototype[13]="enter",o.prototype[16]="shift",o.prototype[17]="ctrl",o.prototype[18]="alt",o.prototype[19]="pause",o.prototype[20]="capslock",o.prototype[27]="escape",o.prototype[32]="space",o.prototype[33]="pageup",o.prototype[34]="pagedown",o.prototype[35]="end",o.prototype[36]="home",o.prototype[37]="left",o.prototype[38]="up",o.prototype[39]="right",o.prototype[40]="down",o.prototype[45]="insert",o.prototype[46]="delete",o.prototype[112]="f1",o.prototype[113]="f2",o.prototype[114]="f3",o.prototype[115]="f4",o.prototype[116]="f5",o.prototype[117]="f6",o.prototype[118]="f7",o.prototype[119]="f8",o.prototype[120]="f9",o.prototype[121]="f10",o.prototype[122]="f11",o.prototype[123]="f12",o.prototype[145]="numlock",o.prototype[220]="pipe",o.prototype.fireDown=function(t){var e=this[t.which]||String.fromCharCode(t.which).toLowerCase();this.keysDown[e]=!0,void 0==this.keysPressed[e]&&(this.keysPressed[e]=!0),this.keysDown.length++},o.prototype.fireUp=function(t){var e=this[t.which]||String.fromCharCode(t.which).toLowerCase();this.keysUp||(this.keysUp={}),this.keysDown[e]=!1,this.keysPressed[e]=void 0,this.keysUp[e]=!0,this.keysDown.length>0&&this.keysDown.length--},o.prototype.update=function(){this.keysUp=null;for(var t in this.keysPressed)this.keysPressed[t]&&(this.keysPressed[t]=!1)},o.prototype.applyToObject=function(t){t.listensTo("keyDown")&&t.raiseEvent("keyDown",this.keysDown),t.listensTo("keyUp")&&t.raiseEvent("keyUp",this.keysUp)},o.prototype.getKeyCode=function(t){return t.charCodeAt(0)};var n=new o;n.bind()}(window.Match),function(t){function e(t){s.start(t)}function i(t){s.end(t)}function o(t){s.move(t)}function n(){this.x=0,this.y=0,this.isDragging=!1,this.events={start:null,end:null,move:null}}var s;n.prototype.clear=function(){this.events.end&&(this.events.start=null,this.x=0,this.y=0),this.events.end=null,this.events.move=null,this.force=null,this.isDragging||(this.selectedObject=null)},n.prototype.update=function(){this.fireEventOnLastSelectedObject(this),this.clear()},n.prototype.getHeight=function(){return 2},n.prototype.getWidth=function(){return 2},n.prototype.applyToObject=function(t){this.isDragging||(t.onTouch||t.onTouchEnd||t.onTouchMove||t.onDrag)&&this.isOverPolygon(t)&&this.isOverPixelPerfect(t)&&(this.selectedObject=t)},n.prototype._setTouch=function(t){this.x=t.pageX-t.target.offsetLeft,this.y=t.pageY-t.target.offsetTop,this.force=t.force},n.prototype.start=function(t){var e=t.changedTouches;if(e.length){var i=e[0];this._setTouch(i),this.events.start=i}},n.prototype.end=function(t){var e=t.changedTouches;if(e.length){var i=e[0];this.events.end=i,this.isDragging=!1,this.selectedObject=null}},n.prototype.move=function(t){var e=t.changedTouches;if(e.length){var i=e[0];this._setTouch(i),this.events.move=i}},n.prototype.started=function(){return this.events.start},n.prototype.moved=function(){return this.events.move},n.prototype.ended=function(){return this.events.end},n.prototype.any=function(){return this.started()||this.moved()||this.ended()},n.prototype.fireEventOnLastSelectedObject=function(){this.selectedObject&&(this.events.start&&(this.selectedObject.onTouch&&this.selectedObject.onTouch(this),this.selectedObject.onDrag&&(this.isDragging=!0)),this.events.end&&this.selectedObject.onTouchEnd&&this.selectedObject.onTouchEnd(this),this.events.move&&(this.selectedObject.onTouchMove&&this.selectedObject.onTouchMove(this),this.isDragging&&this.selectedObject.onDrag(this)))},n.prototype.isOverPixelPerfect=function(e){if(e.onRender&&e._visible){var i=t.offScreenContext,o=t.offScreenCanvas,n=t.camera;i.save(),i.clearRect(0,0,o.width,o.height),e.onRender(i,o,n.x,n.y);var s=i.getImageData(this.x,this.y,1,1);return s.data[3]?s.data[0]?!0:s.data[1]?!0:s.data[2]?!0:!1:!1}},n.prototype.isOverPolygon=function(e){var i=t.camera,o=this.x+i.x,n=this.y+i.y;return e._rotation?(this._x=o,this._y=n,t.collisions.Polygon.haveCollided(e,this)):e.getBottom()<n?!1:e.getTop()>n?!1:e.getRight()<o?!1:e.getLeft()>o?!1:!0},n.prototype.bind=function(){document.addEventListener("touchstart",e,!1),document.addEventListener("touchend",i,!1),document.addEventListener("touchmove",o,!1),t.setTouch(this)},n.prototype.unbind=function(){document.removeEventListener("touchstart",e),document.removeEventListener("touchend",i),document.removeEventListener("touchmove",o),t.setTouch(null)},s=new n,s.bind()}(window.Match),function(t){function e(){}e.prototype.rgb=function(t,e,i){return"rgb("+[t,e,i].join(",")+")"},e.prototype.rgba=function(t,e,i,o){return"rgba("+[t,e,i,o].join(",")+")"},e.prototype.rgbToHex=function(t,e,i){return"#"+this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(i)},e.prototype.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},e.prototype.hexToRgb=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return this.rgb(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16))},e.prototype.alpha=function(){return this.rgba(0,0,0,0)},e.prototype.random=function(){var t=window.Math;return this.rgb(t.round(255*t.random()),t.round(255*t.random()),t.round(255*t.random()))},e.prototype.rgbStringToObject=function(t){var e=new Object;if(t){var i=t.match(/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/);i&&(e.r=parseInt(i[1]),e.g=parseInt(i[2]),e.b=parseInt(i[3]))}return e},t.color=new e}(window.Match),function(t){function e(){this.math=window.Math}e.prototype.integer=function(t,e){return this.math.floor(this.math.random()*(e-t+1))+t},e.prototype.decimal=function(t,e){return this.math.random()*(e-t)+t},e.prototype.bool=function(){return this.math.random()<.5},e.prototype.sign=function(){return this.bool()?1:-1},e.prototype.booleanFromChance=function(t){return this.integer(0,100)<=t},e.prototype.color=function(){return t.color.random()},e.prototype.area=function(e,i,o,n){return{x:t.random.integer(e,o),y:t.random.integer(i,n)}},e.prototype.string=function(t){t=t||16;for(var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i="",o=t;o>0;--o)i+=e[Math.round(Math.random()*(e.length-1))];return i},t.random=new e}(window.Match),function(t){function e(){}t.postProcess||(t.postProcess={}),e.prototype.run=function(t){return t.canvas},t.postProcess.NoPostProcess=e}(window.M),function(t){function e(){}t.postProcess||(t.postProcess={}),e.prototype.run=function(t){var e,i,o,n,s,r=t.getImageData(0,0,t.canvas.width,t.canvas.height),a=r.data,h=a.length;for(e=0;h>e;e+=4)i=a[e],o=a[e+1],n=a[e+2],s=.2126*i+.7152*o+.0722*n,a[e]=a[e+1]=a[e+2]=s;return t.putImageData(r,0,0),t.canvas},t.postProcess.GrayScale=e}(window.M),function(t){function e(t){if(void 0==t)throw new Error("Brightness has no constructor that takes no arguments. You must specify the brightness value");this.value=t}t.postProcess||(t.postProcess={}),e.prototype.run=function(t){for(var e=t.getImageData(0,0,t.canvas.width,t.canvas.height),i=e.data,o=0;o<i.length;o+=4)i[o]+=this.value,i[o+1]+=this.value,i[o+2]+=this.value;return t.putImageData(e,0,0),t.canvas},t.postProcess.Brightness=e}(window.M),function(t){function e(t,e){this.matrix=t,this.opaque=e}t.postProcess||(t.postProcess={}),e.prototype.setSharpen=function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]},e.prototype.setBlur=function(){this.matrix=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]},e.prototype.setContour=function(){this.matrix=[1,1,1,1,.7,-1,-1,-1,-1]},e.prototype.run=function(t){if(this.matrix){var e=Math.round(Math.sqrt(this.matrix.length)),i=Math.floor(e/2),o=t.getImageData(0,0,t.canvas.width,t.canvas.height),n=o.data,s=o.width,r=o.height,a=s,h=r,u=document.createElement("canvas").getContext("2d");u.canvas.width=o.width,u.canvas.height=o.height;for(var p=u.getImageData(0,0,o.width,o.height),c=p.data,l=this.opaque?1:0,d=0;h>d;d++)for(var f=0;a>f;f++){for(var g=d,y=f,m=4*(d*a+f),v=0,_=0,w=0,A=0,x=0;e>x;x++)for(var b=0;e>b;b++){var L=g+x-i,E=y+b-i;if(L>=0&&r>L&&E>=0&&s>E){var S=4*(L*s+E),T=this.matrix[x*e+b];v+=n[S]*T,_+=n[S+1]*T,w+=n[S+2]*T,A+=n[S+3]*T}}c[m]=v,c[m+1]=_,c[m+2]=w,c[m+3]=A+l*(255-A)}return t.putImageData(p,0,0),t.canvas}},t.postProcess.Convolute=e}(window.M),function(t){function e(e,i){this.onRenderList=[],this.needsRedraw=!0,this.needsSorting=!1,this.rotation=null,this.scale=null,this.operation=null,this._alpha,this._visible=!0,this.parrallaxFactor={x:1,y:1},this._onLoopAnimations=[],this.name=e||"layer"+t._gameLayers.length,this._zIndex=i||0,this.background=null,this.TYPE=t.renderizables.TYPES.LAYER}e.prototype._loopThroughAnimations=function(){
for(var t=0,e=this._onLoopAnimations.length;e>t;t++)this._onLoopAnimations[t].onLoop()||this._onLoopAnimations.splice(t,1)},e.prototype.setAlpha=function(t){this._alpha=t},e.prototype.getAlpha=function(){return this._alpha},e.prototype.fadeIn=function(e,i){return this._onLoopAnimations.push(new t.effects.visual.FadeIn(this,e,i)),this},e.prototype.fadeOut=function(e,i){return this._onLoopAnimations.push(new t.effects.visual.FadeOut(this,e,i)),this},e.prototype.continousFade=function(e,i,o,n){return this._onLoopAnimations.push(new t.effects.visual.ContinousFade(this,e,i,o,n)),this},e.prototype.onLoop=function(t){},e.prototype.addToGame=function(){t.pushGameLayer(this)},e.prototype.renderizableChanged=function(){this.needsRedraw=!0},e.prototype.zIndexChanged=function(){this.needsSorting=!0},e.prototype.setZIndex=function(e){this._zIndex=e,t.sortLayers()},e.prototype.getZIndex=function(){return this._zIndex},e.prototype.add=function(e,i,o){if(!e)throw new Error("Cannot push null entity to game layer");!e.setZIndex,!e.getZIndex,e._zIndex||(e._zIndex=this.onRenderList.length),e.onLoad&&e.onLoad();var n=this,s=function(){n.needsRedraw=!0};e.views.eachValue(function(t){t.addEventListener("attributeChanged",s)}),this.needsSorting=!0,this.onRenderList.push(e),this.needsRedraw=!0,t.raise("gameObjectPushedToLayer",e)},e.prototype.push=e.prototype.add,e.prototype.sort=function(){this.onRenderList.sort(this._sortFunction)},e.prototype._sortFunction=function(t,e){return t._zIndex-e._zIndex},e.prototype.getFirst=function(){return this.getIndex(0)},e.prototype.getIndex=function(t){try{return this.onRenderList[t]}catch(e){return null}},e.prototype.get=function(t){if(this.cache&&this.cache.key==t)return this.cache;for(var e,i=this.onRenderList.length;i--;)if(e=this.onRenderList[i],t==e.key)return this.cache=e,e;return null},e.prototype.getLast=function(){return this.getIndex(this.onRenderList.length-1)},e.prototype.isOnRenderList=function(t){return-1!=this.onRenderList.indexOf(t)},e.prototype.remove=function(e){if(e){if("string"==typeof e)this.remove(this.get(e));else{var i=this.onRenderList.indexOf(e);i>-1&&(this.onRenderList.splice(i,1),t.raise("gameObjectRemovedFromLayer",e))}e.onLoop&&t.removeGameObject(e),e.ownerLayer=null,this.needsRedraw=!0}},e.prototype.removeAll=function(){this.onRenderList=[]},t.GameLayer=t.Layer=e}(window.Match),function(t,e){function i(){this.path="",this.toLoad=0,this.total=0,this.onImageLoaded=new e,this.onAllImagesLoaded=new e,this.onImageError=new e,this.assets={}}function o(){t.sprites._imageError(this)}function n(){t.sprites._imageLoaded(this)}i.prototype.get=function(t){return this.assets[t]},i.prototype._imageLoaded=function(t){if(this.toLoad--,void 0==t.frames)t.frames=[{x:0,y:0,width:t.width,height:t.height,halfWidth:t.width/2,halfHeight:t.height/2}];else if(t.tiles){var e,i,o=new Array,n=t.tiles.width,s=t.tiles.height,r=t.tiles.padding||0,a=Math.floor(t.width/(n+r)),h=Math.floor(t.height/(s+r));for(i=0;h>i;i++)for(e=0;a>e;e++){var u=(r+n)*e+r,p=(r+s)*i+r;o.push({x:u,y:p,width:n,height:s,halfWidth:n/2,halfHeight:s/2})}t.frames=o}else for(var c in t.frames)t.frames[c].halfWidth=t.frames[c].width/2,t.frames[c].halfHeight=t.frames[c].height/2;this.onImageLoaded.raise({image:t,name:t.getAttribute("data-name"),remaining:this.toLoad,total:this.total}),this.toLoad<=0&&this.onAllImagesLoaded.raise()},i.prototype._imageError=function(t){this.toLoad--,this.onImageError.raise(t),console.error("Could not load",t.src)},i.prototype.load=function(e,i,s){var r,a,h;if(i&&this.onAllImagesLoaded.addEventListener(i),s&&this.onImageLoaded.addEventListener(s),e instanceof Array){var u={},p=0,c=this,l=function(t){var i=JSON.parse(t);u[i.name]=i,p++,p>=e.length&&c.load(u)};for(h=0;h<e.length;h++)t.Ajax.post(e[h],l)}else{var d=0,f=0;for(h in e)f++,this.assets[h]?d++:(r=e[h],a=new Image,a.setAttribute("data-name",h),a.onload=n,a.onerror=o,this.total=++this.toLoad,"string"==typeof r?a.src=this.path+r:(a.src=this.path+r.source,a.frames=r.frames,a.animations=r.animations),this.assets[h]=a);d==f&&this.onAllImagesLoaded.raise()}},i.prototype.remove=function(t){this.assets[t]&&(delete this.assets[t],this.total-1>=0&&this.total--,this.toLoad-1>=0&&this.toLoad--)},i.prototype.removeAll=function(){this.assets={},this.total=0,this.toLoad=0},i.prototype.removeAllEventListeners=function(){this.onImageLoaded=new e,this.onAllImagesLoaded=new e,this.onImageError=new e},t.SpriteManager=new i,t.sprites=t.SpriteManager}(M,EventListener),function(t,e){function i(t,e){this.audioBuffer=[],this.src=e,this.name=t,this.increaseBuffer()}function o(){t.sounds.assets[this.name].setReady(),t.sounds.toLoad--,t.sounds.toLoad<=0&&t.sounds.onAllSoundsLoaded.raise()}function n(){console.warn("Unable to load "+this.src),t.sounds.error=!0,t.sounds.assets[this.name].setNotReady(),t.sounds.toLoad--,t.sounds.toLoad<=0&&t.sounds.onAllSoundsLoaded.raise()}function s(){this.path="",this.toLoad=0,this.total=0,this.onSoundLoaded=new e,this.onAllSoundsLoaded=new e,this.onSoundError=new e,this.error=!1,this.assets={}}i.prototype.MAX_BUFFER=3,i.prototype.setReady=function(){this.canPlay=this.checkOk,1==this.audioBuffer.length&&t.sounds.onSoundLoaded.raise({sound:this,remaining:t.sounds.toLoad,total:t.sounds.total})},i.prototype.setNotReady=function(){this.canPlay=this.checkOk,t.sounds.onSoundError.raise({sound:this,remaining:t.sounds.toLoad,total:t.sounds.total})},i.prototype.play=function(t){if(this.canPlay()){for(var e,i=0;i<this.audioBuffer.length;){if(e=this.audioBuffer[i],e.ended||0==e.currentTime)return e.loop=t,void e.play();i++}e=this.audioBuffer[0],e.pause(),e.currentTime=0,e.loop=t,e.play(),this.audioBuffer.length<this.MAX_BUFFER&&this.increaseBuffer()}},i.prototype.stop=function(){this.canPlay()&&this.each(function(t){t.duration>0&&(t.pause(),t.currentTime=0)})},i.prototype.pause=function(){this.canPlay()&&(this.onNextPauseResume?(this.play(),this.onNextPauseResume=!1):(this.onNextPauseResume=this.isPlaying(),this.each(function(t){t.pause()})))},i.prototype.checkFail=function(){return!1},i.prototype.checkOk=function(){return!0},i.prototype.canPlay=function(){return this.increaseBuffer(),!1},i.prototype.setPlaybackRate=function(t){this.each(function(e){e.playbackRate=t})},i.prototype.resetPlaybackRate=function(){this.each(function(t){t.playbackRate=1})},i.prototype.getPlaybackRate=function(){return this.audioBuffer[0].playbackRate},i.prototype.isPaused=function(){var t=0;for(l=this.audioBuffer.length;t<l;t++)if(this.audioBuffer[t].paused)return!0;return!1},i.prototype.setVolume=function(t){this.each(function(e){e.volume=t})},i.prototype.isPlaying=function(){var t=0;for(l=this.audioBuffer.length;t<l;t++)if(!this.audioBuffer[t].paused)return!0;return!1},i.prototype.each=function(t){for(var e=this.audioBuffer.length;e--;)t(this.audioBuffer[e])},i.prototype.increaseBuffer=function(){var t=new Audio(this.src),e=this.audioBuffer[0];t.addEventListener("loadeddata",o),t.addEventListener("error",n),t.name=this.name,e&&(t.muted=e.muted,t.volume=e.volume),this.audioBuffer.push(t)},i.prototype.isMuted=function(){return this.audioBuffer.length>0?this.audioBuffer[0].muted:!1},i.prototype.toggle=function(){this.isMuted()?this.unmute():this.mute()},i.prototype.mute=function(){this.each(function(t){t.muted=!0})},i.prototype.unmute=function(){this.each(function(t){t.muted=!1})},i.prototype.setLoop=function(t){this.audioBuffer[0].loop=t};var r=function(){};fakeSound={name:""};for(var a in i.prototype)"function"==typeof i.prototype[a]&&(fakeSound[a]=r);s.prototype.load=function(e,i,o){if(o&&this.onSoundLoaded.addEventListener(o),i&&this.onAllSoundsLoaded.addEventListener(i),e instanceof Array)for(var n={},s=0,r=this,a=function(t){s++;var i=JSON.parse(t);n[i.name]=i.source,s>=e.length&&r.load(n)},h=0;h<e.length;h++)t.Ajax.post(e[h],a);else for(var h in e)this.loadOne(h,e[h])},s.prototype.loadOne=function(e,o){this.total=++this.toLoad,void 0==t.browser.supportedAudioFormat?(this.assets[e]=fakeSound,fakeSound.name=e,this.onSoundLoaded.raise({sound:fakeSound,remaining:t.sounds.toLoad--,total:t.sounds.total}),this.toLoad<=0&&this.onAllSoundsLoaded.raise()):"data"==o.substr(0,4)?this.assets[e]=new i(e,o):(-1==o.lastIndexOf(".")&&(o+=t.browser.supportedAudioFormat),this.assets[e]=new i(e,this.path+o)),this.assets[e].name=e},s.prototype.pause=function(){for(var t in this.assets)this.assets[t].pause()},s.prototype.setVolume=function(t){for(var e in this.assets)this.assets[e].setVolume(t)},s.prototype.mute=function(){for(var t in this.assets)this.assets[t].mute()},s.prototype.unmute=function(){for(var t in this.assets)this.assets[t].unmute()},s.prototype.toggle=function(){for(var t in this.assets)this.assets[t].toggle()},s.prototype.stop=function(){for(var t in this.assets)this.assets[t].stop()},s.prototype.remove=function(t){this.assets[t]&&(delete this.assets[t],this.total-1>=0&&this.total--,this.toLoad-1>=0&&this.toLoad--)},s.prototype.removeAll=function(){this.assets={},this.toLoad=0,this.total=0},s.prototype.removeAllEventListeners=function(){this.onSoundLoaded=new e,this.onAllSoundsLoaded=new e,this.onSoundError=new e},s.prototype.play=function(t,e){var i=this.assets[t];i&&i.play(e)},s.prototype.stop=function(t){var e=this.assets[t];e&&e.stop()},s.prototype.pause=function(t){var e=this.assets[t];e&&e.pause()},s.prototype.getSound=function(t){return this.assets[t]},t.SoundManager=t.sounds=new s}(Match,EventListener),function(t){function e(t){this.canvas=t,this.frontBuffer=null}e.prototype.render=function(){throw new Error("Abstract method")},e.prototype.getCenter=function(){return{x:this.canvas.width/2,y:this.canvas.height/2}},e.prototype.setSize=function(t,e){this.canvas.width=t,this.canvas.height=e},e.prototype.getWidth=function(){return this.canvas.width},e.prototype.getHeight=function(){return this.canvas.height},e.prototype.adjustTo=function(t,e){this.canvas.style.setProperty("width",t+"px",null),this.canvas.style.setProperty("height",e+"px",null)},e.prototype.adjustToAvailSize=function(){this.canvas.adjustTo(window.screen.availWidth+"px",window.screen.availHeight+"px")},e.prototype.resizeKeepingAspect=function(t){this.canvas.adjustTo(this.canvas.width*t,this.canvas.height*t)},e.prototype.getRight=function(){return this.canvas.offsetLeft+this.canvas.offsetWidth},e.prototype.getBottom=function(){return this.canvas.offsetTop+this.canvas.offsetHeight},e.prototype.getAvailWidth=function(){return this.canvas.getRight()<window.screen.availWidth?this.canvas.offsetWidth:window.screen.availWidth-this.canvas.offsetLeft},e.prototype.getAvailHeight=function(){return this.canvas.getBottom()<window.screen.availHeight?this.canvas.offsetHeight:window.screen.availHeight-this.canvas.offsetTop},e.prototype.getViewport=function(){var t={};return this.canvas.offsetLeft<0?t.left=-this.canvas.offsetLeft:t.left=0,this.canvas.offsetTop<0?t.top=-this.canvas.offsetTop:t.top=0,this.canvas.offsetLeft+this.canvas.offsetWidth>window.screen.availWidth?t.right=window.screen.availWidth-this.canvas.offsetLeft:t.right=this.canvas.offsetWidth,this.canvas.offsetTop+this.canvas.offsetHeight>window.screen.availHeight?t.bottom=window.screen.availHeight-this.canvas.offsetTop:t.bottom=this.canvas.offsetHeight,t},e.prototype.getAspect=function(){var t={x:1,y:1};return this.canvas.style.width&&this.canvas.width!=parseInt(this.canvas.style.width)&&(t.x=this.canvas.width/parseInt(this.canvas.style.width)),this.canvas.style.height&&this.canvas.height!=parseInt(this.canvas.style.height)&&(t.y=this.canvas.height/parseInt(this.canvas.style.height)),t},e.prototype.setCanvasStretch=function(t){t?this.setCanvasStretchTo(document.documentElement.clientWidth,document.documentElement.clientHeight):this.setCanvasStretchTo("auto","auto")},e.prototype.setCanvasStretchTo=function(t,e){this.frontBuffer&&(t&&(("number"==typeof t||"auto"!=t&&"-1"==t.indexOf("px")&&"-1"==t.indexOf("%"))&&(t+="px"),this.frontBuffer.canvas.style.width=t),e&&(("number"==typeof e||"auto"!=e&&"-1"==e.indexOf("px")&&"-1"==e.indexOf("%"))&&(e+="px"),this.frontBuffer.canvas.style.height=e))},e.name="Renderer",M.renderers=M.renderers||{},t.renderers.Renderer=e}(M),function(t){function e(t){this.extendsRenderer(t),this.frontBuffer=this.canvas.getContext("2d"),this.backBuffer=document.createElement("canvas").getContext("2d"),this.compositeOperations=["source-over","source-atop","source-in","source-out","destination-atop","destination-in","destination-out","destination-over","lighter","xor","copy"],this.DEFAULT_COMPOSITE_OPERATION=0,this.DEFAULT_ALPHA=1,this.DEFAULT_SHADOW_OFFSET_X=this.frontBuffer.shadowOffsetX,this.DEFAULT_SHADOW_OFFSET_Y=this.frontBuffer.shadowOffsetY,this.DEFAULT_SHADOW_COLOR=this.frontBuffer.shadowColor,this.DEFAULT_SHADOW_BLUR=this.frontBuffer.shadowBlur,this.shadowBlur=this.DEFAULT_SHADOW_BLUR,this.shadowOffsetX=this.DEFAULT_SHADOW_OFFSET_X,this.shadowOffsetY=this.DEFAULT_SHADOW_OFFSET_Y,this.shadowChanged=!1,this.compositeOperation=this.DEFAULT_COMPOSITE_OPERATION,this._reRenderAllLayers=!1,this._buffers={};var e=this;this.camera=new M.Camera,this.camera.addEventListener("locationChanged",function(){e._reRenderAllLayers=!0}),this.updateBufferSize(),this.updateViewport()}e.prototype.setFullScreen=function(){this.frontBuffer.canvas.width=window.innerWidth,this.frontBuffer.canvas.height=window.innerHeight,this.updateBufferSize()},e.prototype.getContext=function(){return this.frontBuffer},e.prototype.getCanvas=function(){return this.frontBuffer.canvas},e.prototype._applyOperation=function(t,e){t._compositeOperation?(e.globalCompositeOperation=this.compositeOperations[t._compositeOperation],this.compositeOperation=t._compositeOperation):this.compositeOperation!=this.DEFAULT_COMPOSITE_OPERATION&&this.resetOperation(e)},e.prototype.resetOperation=function(t){t.globalCompositeOperation=this.compositeOperations[this.DEFAULT_COMPOSITE_OPERATION],this.compositeOperation=this.DEFAULT_COMPOSITE_OPERATION},e.prototype._applyAlpha=function(t,e){void 0!=t._alpha&&t._alpha>=0&&t._alpha<=1?this.alpha!=t._alpha&&(e.globalAlpha=this.alpha=t._alpha):this.alpha!=this.DEFAULT_ALPHA&&this.resetAlpha(e)},e.prototype.resetAlpha=function(t){t.globalAlpha=this.alpha=this.DEFAULT_ALPHA},e.prototype._applyShadow=function(t,e){if(e.shadowBlur=this.DEFAULT_SHADOW_BLUR,e.shadowOffsetX=this.DEFAULT_SHADOW_OFFSET_X,e.shadowOffsetY=this.DEFAULT_SHADOW_OFFSET_Y,e.shadowColor=this.DEFAULT_SHADOW_COLOR,t._shadow){var i=t._shadow;e.shadowOffsetX=i.x,e.shadowOffsetY=i.y,e.shadowBlur=i.blur,e.shadowColor=i.color}},e.prototype.resetShadow=function(t){t.shadowBlur=this.DEFAULT_SHADOW_BLUR,t.shadowOffsetX=this.DEFAULT_SHADOW_OFFSET_X,t.shadowOffsetY=this.DEFAULT_SHADOW_OFFSET_Y,t.shadowColor=this.DEFAULT_SHADOW_COLOR},e.prototype.setRenderingAlphaTime=function(t){this._alphaTime=t,this._alphaTimeDif=1-t},e.prototype.interpolate=function(t,e){return e*this._alphaTime+t*this._alphaTimeDif},e.prototype._interpolateX=function(t){return this.interpolate(t._x,t._prevX)},e.prototype._interpolateY=function(t){return this.interpolate(t._y,t._prevY)},e.prototype._applyTranslation=function(t,e,i,o){e.translate(t._x-i,t._y-o)},e.prototype._applyRotation=function(t,e){t._rotation&&e.rotate(t._rotation)},e.prototype._applyScale=function(t,e){t._scale&&e.scale(t._scale.x,t._scale.y)},e.prototype.clear=function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)},e.prototype.renderSingleBuffer=function(t,e,i){var o=t.length,n=0,s=this.frontBuffer;for(s.clearRect(0,0,e.width,e.height);o>n;n++)s.drawImage(t[n].onLoop(i),0,0)},e.prototype.renderDoubleBuffer=function(t,e,i){var o,n=t.length,s=0,r=this.backBuffer;for(r.clearRect(0,0,e.width,e.height);n>s;s++){o=t[s];var a=o.onLoop(i);r.save(),o.composite&&(r.globalCompositeOperation=o.composite),null!=o._alpha&&o._alpha>=0&&o._alpha<=1&&(r.globalAlpha=o._alpha);var h=this.backBufferHalfWidth,u=this.backBufferHalfHeight;r.translate(h,u),o.rotation&&r.rotate(o.rotation),o.scale&&r.scale(o.scale.x,o.scale.y),r.drawImage(a,h,u),r.restore()}this.frontBuffer.clearRect(0,0,e.width,e.height),this.frontBuffer.drawImage(r.canvas,0,0)},e.prototype.updateBufferSize=function(){this.backBuffer&&this.frontBuffer&&(this.backBuffer.canvas.width=this.frontBuffer.canvas.width,this.backBuffer.canvas.height=this.frontBuffer.canvas.height,this.backBufferHalfWidth=this.backBuffer.canvas.width/2,this.backBufferHalfHeight=this.backBuffer.canvas.height/2),M.collisions.PixelPerfect&&(M.collisions.PixelPerfect.testContext.canvas.width=this.backBuffer.canvas.width,M.collisions.PixelPerfect.testContext.canvas.height=this.backBuffer.canvas.height),M.offScreenCanvas&&(M.offScreenCanvas.width=this.frontBuffer.canvas.width,M.offScreenCanvas.height=this.frontBuffer.canvas.height),this.updateViewport()},e.prototype.updateViewport=function(){this.camera.setViewport(this.frontBuffer.canvas.width,this.frontBuffer.canvas.height)},e.prototype.getViewportSize=function(){return{width:this.camera.viewportWidth,height:this.camera.viewportHeight}},e.prototype.renderRectangle=function(t,e,i,o){this._applyOperation(t,e),this._applyAlpha(t,e),t._rotation||t._scale?(e.save(),this._applyTranslation(t,e,i,o),this._applyRotation(t,e),this._applyScale(t,e),t._fillStyle&&(e.fillStyle=t._fillStyle,e.fillRect(-t._halfWidth,-t._halfHeight,t._width,t._height)),t._strokeStyle&&(t._lineWidth&&(e.lineWidth=t._lineWidth),e.strokeStyle=t._strokeStyle,e.strokeRect(-t._halfWidth,-t._halfHeight,t._width,t._height)),e.restore()):(t._fillStyle&&(e.fillStyle=t._fillStyle,e.fillRect(M.fastRound(t._x-t._halfWidth-i),M.fastRound(t._y-t._halfHeight-o),t._width,t._height)),t._strokeStyle&&(t._lineWidth&&(e.lineWidth=t._lineWidth),e.strokeStyle=t._strokeStyle,e.strokeRect(t._x-t._halfWidth-i,t._y-t._halfHeight-o,t._width,t._height))),this._applyShadow(t,e)},e.prototype.renderText=function(t,e,i,o){this._applyOperation(t,e),this._applyAlpha(t,e),e.font=t._style+t._variant+t._weight+t._size+t._family,e.textAlign=t._textAlign,e.textBaseline=t._textBaseline,this._applyShadow(t,e),0==t._halfWidth&&t.getWidth(),0==t._halfHeight&&t.getHeight(),t._rotation||t._scale?(e.save(),this._applyTranslation(t,e,i,o),this._applyRotation(t,e),this._applyScale(t,e),this.fillText(t,e,-t._halfWidth,-t._halfHeight),e.restore()):this.fillText(t,e,t._x-t._halfWidth,t._y-t._halfHeight)},e.prototype.fillText=function(t,e,i,o){if(e.fillStyle=t._fillStyle,t.multiLine)for(var n=0;n<t.multiLine.length;n++)e.fillText(t.multiLine[n],i,o+n*t.getHeight());else e.fillText(t._text,i,o);t._strokeStyle&&(e.strokeStyle=t._strokeStyle,e.lineWidth=t._lineWidth||1,e.strokeText(t._text,i,o))},e.prototype.renderCircle=function(t,e,i,o){this._applyOperation(t,e),this._applyAlpha(t,e),t._scale?(e.save(),this._applyTranslation(t,e,i,o),this._applyScale(t,e),e.beginPath(),e.arc(0,0,t._radius,t._startAngle,t._endAngle,!1),e.closePath(),t._fillStyle&&(e.fillStyle=t._fillStyle,e.fill()),e.restore()):(e.beginPath(),e.arc(t._x-i,t._y-o,t._radius,t._startAngle,t._endAngle,!1),e.closePath(),t._fillStyle&&(e.fillStyle=t._fillStyle,e.fill())),this._applyShadow(t,e),t._strokeStyle&&(t._lineWidth&&(e.lineWidth=t._lineWidth),e.strokeStyle=t._strokeStyle,e.stroke())},e.prototype.renderSprite=function(t,e,i,o){if(t._image){t._animate(),this._applyOperation(t,e),this._applyAlpha(t,e);var n=t.currentFrame.x,s=t.currentFrame.y;t._rotation||t._scale?(e.save(),this._applyTranslation(t,e,i,o),this._applyRotation(t,e),this._applyScale(t,e),e.drawImage(t._image,n,s,t._width,t._height,-t._halfWidth,-t._halfHeight,t._width,t._height),e.restore()):e.drawImage(t._image,n,s,t._width,t._height,t._x-t._halfWidth-i,t._y-t._halfHeight-o,t._width,t._height)}},e.prototype.renderBitmapText=function(t,e,i,o){if(t._sprite){this._applyOperation(t,e),this._applyAlpha(t,e);var n,s,r=t._text,a=r.length,h=0,u=t._sprite.frames;if(t._rotation||t._scale){e.save(),this._applyTranslation(t,e,i,o),this._applyRotation(t,e),this._applyScale(t,e),n=-t._halfWidth,s=-t._halfHeight;for(var p=0;a>p;p++){var c=u[r[p]];e.drawImage(t._sprite,c.x,c.y,c.width,c.height,n+h,s,c.width,c.height),h+=c.width}e.restore()}else{n=t._x-i-t._halfWidth,s=t._y-o-t._halfHeight;for(var p=0;a>p;p++){var c=u[r[p]];e.drawImage(t._sprite,c.x,c.y,c.width,c.height,n+h,s,c.width,c.height),h+=c.width}}}},e.prototype.renderLayer=function(t,e,i,o,n){if(t._visible){var s,r,a,h=this.backBuffer.canvas;t.background?t.background.src?this.backBuffer.drawImage(t.background,0,0,h.width,h.height):M.sprites.get(t.background)?this.backBuffer.drawImage(M.sprites.get(t.background),0,0,h.width,h.height):(this.backBuffer.fillStyle=t.background,this.backBuffer.fillRect(0,0,h.width,h.height)):this.backBuffer.clearRect(0,0,h.width,h.height);for(var u=0,p=t.onRenderList.length;p>u;u++){s=t.onRenderList[u],a=s.views._values;for(var c=0,l=a.length;l>c;c++){r=a[c];var d=t.parrallaxFactor.x,f=t.parrallaxFactor.y;this.camera.canSee(r,d,f)&&this.render(r,this.backBuffer,e*d,i*f)}}t.postProcessing&&t.postProcessing(this.backBuffer,this.frontBuffer,e,i),t.needsRedraw=!1,this._applyOperation(t,this.frontBuffer),this._applyAlpha(t,this.frontBuffer),this.frontBuffer.drawImage(this.backBuffer.canvas,0,0);var g=this._getBuffer(t.name);g||(g=this._createBuffer(t.name),g.canvas.width=this.frontBuffer.canvas.width,g.canvas.height=this.frontBuffer.canvas.height),g.drawImage(this.backBuffer.canvas,0,0)}},e.prototype._createBuffer=function(t){var e=document.createElement("canvas").getContext("2d");return this._buffers[t]=e,e},e.prototype._getBuffer=function(t){return this._buffers[t]},e.prototype.renderLayers=function(t){this.frontBuffer.clearRect(0,0,this.backBuffer.canvas.width,this.backBuffer.canvas.height);for(var e=0,i=t._values.length;i>e;e++)this.renderLayer(t._values[e],this.camera._x,this.camera._y,this.camera.viewportWidth,this.camera.viewportHeight);this._reRenderAllLayers=!1},e.prototype.redrawAllLayers=function(){this._reRenderAllLayers=!0},e.prototype.render=function(t,e,i,o){var n=M.renderizables.TYPES;switch(t.TYPE){case n.SPRITE:this.renderSprite(t,e,i,o);break;case n.BITMAP_TEXT:this.renderBitmapText(t,e,i,o);break;case n.TEXT:this.renderText(t,e,i,o);break;case n.RECTANGLE:this.renderRectangle(t,e,i,o);break;case n.CIRCLE:this.renderCircle(t,e,i,o);break;default:throw new Error("Unable to render object of type "+t.TYPE)}},e.prototype.setAntialiasing=function(t){this.frontBuffer.mozImageSmoothingEnabled=t,this.frontBuffer.webkitImageSmoothingEnabled=t,this.frontBuffer.imageSmoothingEnabled=t,this.backBuffer.mozImageSmoothingEnabled=t,this.backBuffer.webkitImageSmoothingEnabled=t,this.backBuffer.imageSmoothingEnabled=t},e.prototype._getImageRenderingStyle=function(){var t=document.getElementById("match-image-quality");return void 0==t&&(t=document.createElement("style"),t.setAttribute("id","match-image-quality"),t.type="text/css",document.head.appendChild(t)),t},e.prototype.prioritizeQuality=function(){this.setAntialiasing(!0),this._getImageRenderingStyle().innerHTML="canvas { -ms-interpolation-mode: bicubic; image-rendering: optimizeQuality; }"},e.prototype.prioritizeSpeed=function(){this.setAntialiasing(!1),this._getImageRenderingStyle().innerHTML="canvas { -ms-interpolation-mode: nearest-neighbor; image-rendering: optimizeSpeed; }"},e.prototype.getSceneCenter=function(){return new M.math2d.Vector2d(this.frontBuffer.canvas.width/2,this.frontBuffer.canvas.height/2)},e.prototype.getAsBase64Image=function(){return this.frontBuffer.canvas.toDataURL()},e.prototype.getAsImage=function(){var t=new Image;return t.src=this.getAsBase64Image(),t},M.extend(e,t),M.renderers.StandardEntityRenderer=e}(M.renderers.Renderer),function(t){function e(){}e.prototype.isWebGLSupported=function(){return void 0!==WebGLRenderingContext},e.prototype.getRenderer=function(t,e){return e&&"webgl"==e.toLowerCase()&&this.isWebGLSupported()?this.getWebGLRenderer(t):this.getStandardEntityRenderer(t)},e.prototype.getStandardRenderer=function(t){return new M.renderers.StandardRenderer(t)},e.prototype.getStandardEntityRenderer=function(t){return new M.renderers.StandardEntityRenderer(t)},e.prototype.getWebGLRenderer=function(t){return new M.renderers.WebGLRenderer(t)},t.renderingProvider=new e}(M),function(t){t.renderizables={TYPES:{SPRITE:0,LAYER:1,BITMAP_TEXT:2,TEXT:3,RECTANGLE:4,CIRCLE:5}}}(M),function(t,e){function i(e){this.extendsGameObject(),this.extendsEventHandler(),this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._width=0,this._height=0,this._halfWidth=0,this._halfHeight=0,this._rotation=null,this._scale=null,this._visible=!0,this.operation=null,this._alpha=null,this._math=Math,this._math2d=t.math2d,this._cachedRotationForBoundingHalfWidth=0,this._cachedRotationForBoundingHalfHeight=0,this._cachedBoundingHalfWidth=null,this._cachedBoundingHalfHeight=null,this.set(e)}i.prototype._zIndex=0,i.prototype.set=function(t){if(t){var e="";for(var i in t)e="set"+i.charAt(0).toUpperCase()+i.substr(1),this[e]?this[e](t[i]):this[i]=t[i];return this}},i.prototype.setAlpha=function(t){return t>=0&&1>=t&&this._alpha!=t?(this._alpha=t,this.raiseEvent("alphaChanged",t),this.raiseEvent("attributeChanged","alpha")):this._alpha=null,this},i.prototype.getAlpha=function(){return this._alpha},i.prototype._loopThroughAnimations=function(){function t(t,e,i){t&&!t.onLoop()&&i.quickRemove(e)}this.animations.each(t),this.chainedAnimations.size&&(this.chainedAnimations._list[this._currentChainedBehaviour].onLoop()||this._currentChainedBehaviour++,this._currentChainedBehaviour==this.chainedAnimations.size&&(this.chainedAnimations.removeAll(),this._currentChainedBehaviour=0))},i.prototype.clearAnimations=function(){return this.animations=new Array,this},i.prototype.fadeIn=function(t,i){return this.animations.push(new e.FadeIn(this,t,i)),this},i.prototype.fadeOut=function(t,i){return this.animations.push(new e.FadeOut(this,t,i)),this},i.prototype.continousFade=function(t,i,o,n){return this.animations.push(new e.ContinousFade(this,t,i,o,n)),this},i.prototype.move=function(t,i,o,n,s,r,a){return this.animations.push(new e.Easing(this,t,i,o,n,s,r,a)),this},i.prototype.scaleUp=function(t,i,o,n){return this.animations.push(new e.ScaleUp(this,t,i,o,n)),this},i.prototype.scaleDown=function(t,i,o,n){return this.animations.push(new e.ScaleDown(this,t,i,o,n)),this},i.prototype.twinkle=function(t,i,o){return this.animations.push(new e.Twinkle(this,t,i,o)),this},i.prototype.rotate=function(t,i,o){return this.animations.push(new e.Rotate(this,t,i,o)),this},i.prototype.chainWait=function(t,i){return this.chainedAnimations.push(new e.Wait(this,t,i)),this},i.prototype.chainFadeIn=function(t,i){return this.chainedAnimations.push(new e.FadeIn(this,t,i)),this},i.prototype.chainFadeOut=function(t,i){return this.chainedAnimations.push(new e.FadeOut(this,t,i)),this},i.prototype.chainContinousFade=function(t,i,o,n){return this.chainedAnimations.push(new e.ContinousFade(this,t,i,o,n)),this},i.prototype.chainMove=function(t,i,o,n,s){return this.chainedAnimations.push(new e.Easing(this,t,i,o,n,s)),this},i.prototype.chainScaleUp=function(t,i,o,n){return this.chainedAnimations.push(new e.ScaleUp(this,t,i,o,n)),this},i.prototype.chainScaleDown=function(t,i,o,n){return this.chainedAnimations.push(new e.ScaleDown(this,t,i,o,n)),this},i.prototype.chainTwinkle=function(t,i,o){return this.chainedAnimations.push(new e.Twinkle(this,t,i,o)),this},i.prototype.chainRotate=function(t,i,o){return this.chainedAnimations.push(new e.Rotate(this,t,i,o)),this},i.prototype._loopThroughTimers=function(){for(var t=0,e=this._onLoopTimers.length;e>t;t++)this._onLoopTimers[t].onLoop()},i.prototype.addTimer=function(e,i){var o=new t.Timer(e,i,this);return this._onLoopTimers.push(o),o},i.prototype.removeTimer=function(t){return this._onLoopTimers.splice(this._onLoopTimers.indexOf(this._getTimer(t)),1),this},i.prototype._getTimer=function(t){for(var e=0,i=this._onLoopTimers.length;i>e;e++)if(this._onLoopTimers[e].callback==t)return this._onLoopTimers[e]},i.prototype.setZIndex=function(t){return this._zIndex!=t&&(this._zIndex=t,this.raiseEvent("zIndexChanged",t),this.raiseEvent("attributeChanged","zIndex")),this},i.prototype.getZIndex=function(){return this._zIndex},i.prototype.setVisible=function(t){return this._visible!=t&&(this._visible=t,this.raiseEvent("visibilityChanged",t),this.raiseEvent("attributeChanged","visibility")),this},i.prototype.getVisible=function(){return this._visible},i.prototype.setWidth=function(t){return this._width!=t&&(this._width=t,this._halfWidth=t/2,this.raiseEvent("widthChanged",t),this.raiseEvent("attributeChanged","width")),this},i.prototype.setHeight=function(t){return this._height!=t&&(this._height=t,this._halfHeight=t/2,this.raiseEvent("heightChanged",t),this.raiseEvent("attributeChanged","height")),this},i.prototype.getWidth=function(){return this._scale?this._width*this._scale.x:this._width},i.prototype.getBoundingHalfWidth=function(){if(!this._rotation)return this._halfWidth;if(this._cachedRotationForBoundingHalfWidth==this._rotation)return this._cachedBoundingHalfWidth;var t=this._halfWidth,e=this._halfHeight,i=this._math2d.getRotatedVertexCoordsX(-t,-e,this._rotation),o=this._math2d.getRotatedVertexCoordsX(t,-e,this._rotation),n=this._math2d.getRotatedVertexCoordsX(t,e,this._rotation),s=this._math2d.getRotatedVertexCoordsX(-t,e,this._rotation),r=this._math.max(i,o,n,s);return this._cachedBoundingHalfWidth=this._math.abs(r),this._cachedRotationForBoundingHalfWidth=this._rotation,this._cachedBoundingHalfWidth},i.prototype.getBoundingWidth=function(){return 2*this.getBoundingHalfWidth()},i.prototype.getBoundingHalfHeight=function(){if(!this._rotation)return this._halfHeight;if(this._cachedRotationForBoundingHalfHeight==this._rotation)return this._cachedBoundingHalfHeight;var t=this._halfWidth,e=this._halfHeight,i=this._math2d.getRotatedVertexCoordsY(-t,-e,this._rotation),o=this._math2d.getRotatedVertexCoordsY(t,-e,this._rotation),n=this._math2d.getRotatedVertexCoordsY(t,e,this._rotation),s=this._math2d.getRotatedVertexCoordsY(-t,e,this._rotation),r=this._math.max(i,o,n,s);return this._cachedBoundingHalfHeight=this._math.abs(r),this._cachedRotationForBoundingHalfHeight=this._rotation,this._cachedBoundingHalfHeight},i.prototype.getBoundingHeight=function(){return 2*this.getBoundingHalfHeight()},i.prototype.getHeight=function(){return this._scale?this._height*this._scale.y:this._height},i.prototype.setSize=function(t,e){return this.setWidth(t),void 0==e?this.setHeight(t):this.setHeight(e),this},i.prototype.getSize=function(){return{width:this.getWidth(),height:this.getHeight()}},i.prototype.setScale=function(t,e){return t||e?(t||(t=1),e||(e=1),this.setScaleX(t),this.setScaleY(e),this):void 0},i.prototype.setScaleX=function(t){return this._scale||(this._scale=new Object,this._scale.y=1),this._scale.x!=t&&(this._scale.x=t,this.raiseEvent("scaleXChanged",t),this.raiseEvent("attributeChanged","scaleX")),this},i.prototype.setScaleY=function(t){return this._scale||(this._scale=new Object,this._scale.x=1),this._scale.y!=t&&(this._scale.y=t,this.raiseEvent("scaleYChanged",t),this.raiseEvent("attributeChanged","scaleY")),this},i.prototype.offsetScale=function(t,e){return this.offsetScaleX(t),this.offsetScaleY(e),this},i.prototype.offsetScaleX=function(t){return this.setScaleX(this.getScaleX()+t)},i.prototype.offsetScaleY=function(t){return this.setScaleY(this.getScaleY()+t)},i.prototype.getScaleX=function(){return this._scale?this._scale.x:1},i.prototype.getScaleY=function(){return this._scale?this._scale.y:1},i.prototype.mirror=function(){return this.invertX(),this},i.prototype.invertX=function(){return this._scale?this.setScaleX(-1*this._scale.x):(this._scale=new Object,this._scale.x=-1),this},i.prototype.invertY=function(){return this._scale?this.setScaleY(-1*this._scale.y):(this._scale=new Object,this._scale.y=-1),this},i.prototype.getLeft=function(){return this._scale?this._x-this.getBoundingHalfWidth()*this._scale.x:this._x-this.getBoundingHalfWidth()},i.prototype.getRight=function(){return this._scale?this._x+this.getBoundingHalfWidth()*this._scale.x:this._x+this.getBoundingHalfWidth();
},i.prototype.getTop=function(){return this._scale?this._y-this.getBoundingHalfHeight()*this._scale.y:this._y-this.getBoundingHalfHeight()},i.prototype.getBottom=function(){return this._scale?this._y+this.getBoundingHalfHeight()*this._scale.y:this._y+this.getBoundingHalfHeight()},i.prototype.setLeft=function(t){return this._scale?this.setX(t+this.getBoundingHalfWidth()*this._scale.x):this.setX(t+this.getBoundingHalfWidth()),this},i.prototype.setRight=function(t){return this._scale?this.setX(t-this.getBoundingHalfWidth()*this._scale.x):this.setX(t-this.getBoundingHalfWidth()),this},i.prototype.setTop=function(t){return this._scale?this.setY(this._y=t+this.getBoundingHalfHeight()*this._scale.y):this.setY(this._y=t+this.getBoundingHalfHeight()),this},i.prototype.setBottom=function(t){return this._scale?this.setY(t-this.getBoundingHalfHeight()*this._scale.y):this.setY(t-this.getBoundingHalfHeight()),this},i.prototype.getLocation=function(){return{x:this._x,y:this._y}},i.prototype.setLocation=function(t,e){return this.setX(t),this.setY(e),this},i.prototype.offsetAlpha=function(t){return this.setAlpha(this._alpha+t),this},i.prototype.offsetRotation=function(e,i,o){if(this.setRotation(this._rotation+e),void 0!=i||void 0!=o){var n,s,r=this._x-i,a=this._y-o;(0!=r||0!=a)&&(n=t.math2d.getRotatedVertexCoordsX(r,a,e),s=t.math2d.getRotatedVertexCoordsY(r,a,e),this.setLocation(n+i,s+o))}return this},i.prototype.setRotation=function(t){return t!=this._rotation&&(this._rotation=t,this.raiseEvent("rotationChanged",t),this.raiseEvent("attributeChanged","rotation")),this},i.prototype.getRotation=function(){return this._rotation},i.prototype.setX=function(t){return t!=this._x&&(this._prevX=this._x,this._x=t,this.raiseEvent("xChanged",t),this.raiseEvent("attributeChanged","x")),this},i.prototype.setY=function(t){return t!=this._y&&(this._prevY=this._y,this._y=t,this.raiseEvent("yChanged",t),this.raiseEvent("attributeChanged","y")),this},i.prototype.remove=function(){return this.ownerLayer.remove(this),this},i.prototype.offset=function(t,e){return this.offsetX(t),this.offsetY(e),this},i.prototype.offsetX=function(t){return 0!=t&&this.setX(this._x+t),this},i.prototype.offsetY=function(t){return 0!=t&&this.setY(this._y+t),this},i.prototype.centerAt=function(t){return this.setLocation(t.x,t.y),this},i.prototype.getX=function(){return this._x},i.prototype.getY=function(){return this._y},i.prototype.getPrevX=function(){return this._prevX},i.prototype.getPrevY=function(){return this._prevY},i.prototype.getMaxSize=function(){return Math.max(this.getWidth(),this.getHeight())},i.prototype.toString=function(){return this.constructor.name},i.name="Renderizable",t.extend(i,t.GameObject),t.extend(i,EventHandler),t.renderizables.Renderizable=i}(Match,Match.effects.visual),function(t,e,i){function o(t){this.extendsRenderizable(t),this._fillStyle="rgb(0,0,0)",this._strokeStyle=null,this._lineWidth=1}o.prototype.setStrokeStyle=function(t){return this._strokeStyle!=t&&(this._strokeStyle=t,this.raiseEvent("attributeChanged","strokeStyle")),this},o.prototype.getStrokeStyle=function(){return this._strokeStyle},o.prototype.setFillStyle=function(t){return this._fillStyle!=t&&(this._fillStyle=t,this.raiseEvent("attributeChanged","fillStyle")),this},o.prototype.getFillStyle=function(){return this._fillStyle},o.prototype.setFill=o.prototype.setFillStyle,o.prototype.getFill=o.prototype.setFillStyle,o.prototype.setColor=o.prototype.setFillStyle,o.prototype.getColor=o.prototype.getFillStyle,o.prototype.getStrokeWidth=function(){return this._lineWidth},o.prototype.setBorder=o.prototype.setStrokeStyle,o.prototype.setStrokeWidth=function(t){return this._lineWidth!=t&&(this._lineWidth=t,this.raiseEvent("strokeWidthChanged",t)),this},o.prototype.setBorderWidth=o.prototype.setStrokeWidth,o.prototype.getBorder=o.prototype.getStrokeStyle,o.prototype.getStrokeWidth=function(){return this._lineWidth},o.prototype.getBorderWidth=o.prototype.getStrokeWidth,o.prototype.setShadow=function(t,e,i,o){this._shadow={x:t,y:e,color:i||"#000000",blur:o||1},this.raiseEvent("shadowChanged",this._shadow)},o.prototype.getShadow=function(){return this._shadow},o.prototype.setBlur=function(t,e){this.setShadow(0,0,e||this._fillStyle,t)},o.prototype.getBlur=function(){return this._shadow.blur},o.name="Shape",e.extend(o,i),t.Shape=o}(Match.renderizables,Match,Match.renderizables.Renderizable),function(t,e,i,o){function n(t,i,o){this.extendsRenderizable(),this.animationName=null,this._animation=null,this._frameIndex=0,this.isPlaying=!1,t&&this.setImage(t),this.setLocation(i||0,o||0),this.TYPE=e.renderizables.TYPES.SPRITE}n.prototype.setImage=function(t,e){if(!t)throw new Error("Image cannot be null");if(t instanceof Image)t.frames||(t.frames=[{x:0,y:0,width:t.width,height:t.height,halfWidth:t.width/2,halfHeight:t.height/2}]),this._image=t;else{var i=o[t];if(!i)throw new Error("Image by id "+t+" not loaded");this._image=i}return this.setFrameIndex(e),this.animationName=null,this._animation=null,this.isPlaying=!1,this},n.prototype.getImage=function(){return this._image},n.prototype.setFillStyle=n.prototype.setImage,n.prototype.getFillStyle=n.prototype.getImage,n.prototype.setFill=n.prototype.setImage,n.prototype.getFill=n.prototype.getImage,n.prototype.setSprite=n.prototype.setImage,n.prototype.getSprite=n.prototype.getImage,n.prototype.play=function(t,e){if(!this._animation||this.animationName!=t||!this.isPlaying){if(!t&&this._animation)this.isPlaying=!0;else{if(!this._image)throw new Error("No image selected");if(!this._image.animations)throw new Error("Image has no animations");if(!this._image.animations[t])throw new Error("Image has no animation by name "+t);this._animation=this._image.animations[t],this.animationName=t,this._frameIndex=0,this.isPlaying=!0}this.loop=e||this._animation.loop,this.raiseEvent("animationPlaying")}},n.prototype.stop=function(){this.isPlaying=!1},n.prototype._animate=function(){if(this.isPlaying){var t=e.getTime();this.currentFrameStartInMillis||(this.currentFrameStartInMillis=t),t-this.currentFrameStartInMillis>this._animation.duration&&(this.currentFrame=this._image.frames[this._animation.frames[this._frameIndex]],this._frameIndex<this._animation.frames.length-1?this.setFrameIndex(this._frameIndex+1):this.loop?0==this._frameIndex?this.setFrameIndex(1):this.setFrameIndex(0):this._animation.next?this.play(this._animation.next):this.isPlaying=!1,this.currentFrameStartInMillis=t)}},n.prototype.isLastAnimationFrame=function(){return this._animation?this._frameIndex==this._animation.frames.length-1:!1},n.prototype.isFirstAnimationFrame=function(){return this._animation?1==this._frameIndex:!1},n.prototype.setFrameIndex=function(t){t=t||0,this._frameIndex=t,this.currentFrame=this._image.frames[t],this._width=this.currentFrame.width,this._height=this.currentFrame.height,this._halfWidth=this.currentFrame.halfWidth,this._halfHeight=this.currentFrame.halfHeight,this.raiseEvent("attributeChanged","frame")},n.prototype.toString=function(){return"Sprite"},n.name="Sprite",e.extend(n,i),t.Sprite=n}(Match.renderizables,Match,Match.renderizables.Renderizable,Match.sprites.assets),function(t,e,i){function o(t){this.extendsShape(),this.TYPE=e.renderizables.TYPES.RECTANGLE,this.set(t)}o.prototype.toString=function(){return"Rectangle"},o.name="Rectangle",e.extend(o,i),t.Rectangle=o}(Match.renderizables,Match,Match.renderizables.Shape),function(t,e,i){function o(t){this.extendsShape(),this._radius=1,this._startAngle=0,this._endAngle=6.28,this.TYPE=e.renderizables.TYPES.CIRCLE,this.set(t)}o.prototype.setSize=function(t){return this.setRadius(t/2)},o.prototype.getSize=function(){return 2*this._radius},o.prototype.setRadius=function(t){this._radius=t,this.raiseEvent("attributeChanged")},o.prototype.getRadius=function(){return this._radius},o.prototype.isMouseOver=function(t){return t||(t=e.onLoopProperties),e.Math2d.getDistance({x:this._x,y:this._y},t.mouse)<=this._radius},o.prototype.getWidth=function(){return this._scale?2*this._radius*this._scale.x:2*this._radius},o.prototype.getHeight=function(){return this._scale?2*this._radius*this._scale.y:2*this._radius},o.prototype.getLeft=function(){return this._scale?this._x-this._radius*this._scale.x:this._x-this._radius},o.prototype.getRight=function(){return this._scale?this._x+this._radius*this._scale.x:this._x+this._radius},o.prototype.getTop=function(){return this._scale?this._y-this._radius*this._scale.y:this._y-this._radius},o.prototype.getBottom=function(){return this._scale?this._y+this._radius*this._scale.y:this._y+this._radius},o.prototype.setLeft=function(t){this._scale?this.setX(t+this._radius*this._scale.x):this.setX(t+this._radius)},o.prototype.setRight=function(t){this._scale?this.setX(t-this._radius*this._scale.x):this.setX(t-this._radius)},o.prototype.setTop=function(t){this._scale?this.setY(this._y=t+this._radius*this._scale.y):this.setY(t+this._radius)},o.prototype.setBottom=function(t){this._scale?this.setY(t-this._radius*this._scale.y):this.setY(t-this._radius)},o.prototype.toString=function(){return"Circle"},o.name="Circle",e.extend(o,i),t.Circle=o}(Match.renderizables,Match,Match.renderizables.Shape),function(t,e,i){function o(t){this.extendsShape(),this._style="",this._variant="",this._weight="",this._size="14px",this._family="Calibri, Verdana, Arial, Monospace",this._textAlign="left",this._textBaseline="top",this._text="",this._changed=!1,this.TYPE=e.renderizables.TYPES.TEXT,this.set(t)}var n=document.createElement("div");n.setAttribute("id","match-text-measuring"),n.style.setProperty("visibility","hidden"),n.style.setProperty("display","inline-block"),n.style.setProperty("position","absolute"),document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(n)}),o.prototype.getBoundingHalfWidth=function(){return this.getWidth(),this.getHeight(),this.shapeGetBoundingHalfWidth()},o.prototype.getBoundingHalfHeigth=function(){return this.getWidth(),this.getHeight(),this.shapeGetBoundingHalfHeight()},o.prototype.getHeight=function(){return this._changed&&(n.style.setProperty("font-size",this._size),n.style.setProperty("font-family",this._family),n.style.setProperty("font-variant",this._variant),n.style.setProperty("font-weight",this._weight),n.style.setProperty("font-style",this._style),n.innerHTML=this._text,this._width=n.offsetWidth,this._height=n.offsetHeight,this._halfWidth=this._width/2,this._halfHeight=this._height/2,this._changed=!1),this._height},o.prototype.setAlignment=function(t,e){this.setHorizontalAlign(t),this.setVerticalAlign(e),this._changed=!0},o.prototype.setHorizontalAlign=function(t){this._textAlign=t,this._changed=!0,this.raiseEvent("horizontalAlignChanged",t)},o.prototype.setVerticalAlign=function(t){this._textBaseline=t,this._changed=!0,this.raiseEvent("verticalAlignChanged",t)},o.prototype.getWidth=function(){return this._changed&&(n.style.setProperty("font-size",this._size),n.style.setProperty("font-family",this._family),n.style.setProperty("font-variant",this._variant),n.style.setProperty("font-weight",this._weight),n.style.setProperty("font-style",this._style),n.innerHTML=this._text,this._width=n.offsetWidth,this._height=n.offsetHeight,this._halfWidth=this._width/2,this._halfHeight=this._height/2,this._changed=!1),this._width},o.prototype.setFamily=function(t){this._family=t,this._changed=!0,this.raiseEvent("familyChanged",t)},o.prototype.setFont=o.prototype.setFamily,o.prototype.getFont=o.prototype.getFamily,o.prototype.setSize=function(t){this._size=parseInt(t)+"px ",this._changed=!0,this.raiseEvent("sizeChanged",t)},o.prototype.setWeight=function(t){this._weight=t+" ",this._changed=!0,this.raiseEvent("weightChanged",t)},o.prototype.setBold=function(t){t?this.setWeight("bold"):this.setWeight(""),this._changed=!0},o.prototype.setVariant=function(t){this._variant=t+" ",this._changed=!0,this.raiseEvent("variantChanged",t)},o.prototype.setStyle=function(t){this._style=t+" ",this._changed=!0,this.raiseEvent("styleChanged",t)},o.prototype.getSize=function(t){return this._size},o.prototype.getWeight=function(t){return this._weight},o.prototype.getVariant=function(t){return this._variant},o.prototype.getStyle=function(t){return this._style},o.prototype.setText=function(t,e){e&&(this.multiLine=t.split("\n")),this._text=t,this._changed=!0,this.raiseEvent("textChanged",t)},o.prototype.getFamily=function(t){return this._family},o.prototype.getText=function(){return this._text},o.prototype.toString=function(){return"Text"},o.name="Text",e.extend(o,i),t.Text=o}(Match.renderizables,Match,Match.renderizables.Shape),function(t,e,i,o){function n(t,i,o){this.extendsRenderizable(),this._sprite=null,t&&this.setSprite(t),this.setLocation(i||0,o||0),this.TYPE=e.renderizables.TYPES.BITMAP_TEXT}n.prototype.setSprite=function(t,e){if(!t)throw new Error("Image cannot be null");if(t instanceof Image){if(!t.frames)throw new Error("A bitmap font requires each font to be specified as a frame");this._sprite=t}else{var i=o[t];if(!i)throw new Error("Image by id "+t+" not loaded");this._sprite=i}return this.raiseEvent("attributeChanged","sprite"),this},n.prototype.getSprite=function(){return this._sprite},n.prototype.setFillStyle=n.prototype.setSprite,n.prototype.getFillStyle=n.prototype.getSprite,n.prototype.setFill=n.prototype.setSprite,n.prototype.getFill=n.prototype.getSprite,n.prototype.setText=function(t){if(t!=this._text){this._text=t,this._width=0,this._height=0;for(var e,i=0,o=t.length,i=0,o=t.length;o>i;i++){if(e=this._sprite.frames[t[i]],void 0==e)throw new Error("Character '"+t[i]+"' has not been defined for this BitmapText");this._width+=this._sprite.frames[t[i]].width,this._height=Math.max(this._height,this._sprite.frames[t[i]].height)}this._halfWidth=this._width/2,this._halfHeight=this._height/2,this.raiseEvent("attributeChanged","text")}return this},n.prototype.getText=function(){return this._text},n.prototype.toString=function(){return"BitmapText"},n.DEFAULT_FONT={source:"data:image/png;base64,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",frames:{A:{x:0,y:0,width:76,height:73},B:{x:84,y:0,width:76,height:73},C:{x:166,y:0,width:76,height:73},D:{x:248,y:0,width:76,height:73},E:{x:328,y:0,width:76,height:73},F:{x:0,y:84,width:76,height:73},G:{x:84,y:84,width:76,height:73},H:{x:164,y:84,width:76,height:73},I:{x:246,y:84,width:46,height:73},J:{x:294,y:84,width:76,height:73},K:{x:374,y:84,width:76,height:73},L:{x:0,y:168,width:76,height:73},M:{x:82,y:168,width:118,height:73},N:{x:200,y:168,width:76,height:73},O:{x:284,y:168,width:76,height:73},P:{x:364,y:168,width:76,height:73}," ":{x:436,y:168,width:24,height:73},Q:{x:0,y:252,width:76,height:73},R:{x:82,y:252,width:76,height:73},S:{x:164,y:252,width:76,height:73},T:{x:246,y:252,width:76,height:73},U:{x:330,y:252,width:76,height:73},V:{x:0,y:336,width:76,height:73},W:{x:84,y:336,width:113,height:73},X:{x:200,y:336,width:81,height:73},Y:{x:284,y:336,width:80,height:73},Z:{x:364,y:336,width:81,height:73},0:{x:0,y:421,width:81,height:73},1:{x:81,y:421,width:81,height:73},2:{x:128,y:421,width:82,height:73},3:{x:210,y:421,width:83,height:73},4:{x:293,y:421,width:82,height:73},5:{x:374,y:421,width:82,height:73},6:{x:0,y:505,width:82,height:73},7:{x:82,y:505,width:82,height:73},8:{x:164,y:505,width:82,height:73},9:{x:246,y:505,width:82,height:73},":":{x:327,y:505,width:37,height:73},".":{x:364,y:505,width:36,height:73},"-":{x:400,y:505,width:47,height:73}}},n.name="BitmapText",e.extend(n,i),t.BitmapText=n}(Match.renderizables,Match,Match.renderizables.Renderizable,Match.sprites.assets),function(t){function e(e,i,o){this.interval=e,this._lastTime=t.getTime(),o?(this.owner=o,this.callback=i):this.tick=i,this.enabled=!0}e.prototype.onLoop=function(e){this.enabled&&t.elapsedTimeFrom(this._lastTime,this.interval)&&(this.tick(),this._lastTime=t.getTime())},e.prototype.tick=function(){this.callback.call(this.owner)},t.Timer=e}(window.Match),function(t){function e(t){this._lastTime=0,this.time=t}e.prototype.initialize=function(){return this._lastTime=t.getTime(),this.elapsed=this._run,!1},e.prototype.setInterval=function(t){return this.elapsed=this.initialize,this.time=t,!1},e.prototype._run=function(){var e=t.getTime();return e-this.time>=this._lastTime?(this._lastTime=e,!0):!1},e.prototype.reset=function(){this.elapsed=this.initialize},e.prototype.elapsed=e.prototype.initialize,t.TimeCounter=e}(window.Match),function(t,e,i){function o(t,e){this.name=t,this.attributes=e}function n(t,e){this.name=t,this.views=e}function s(t,o){if(this.extendsEventHandler(),"string"!=typeof t&&(o=t,t=void 0),this.name=t||"Unnamed Entity"+i._gameObjects.length,this.attributes=new e,this.behaviours=new e,this.customBehaviours=new Object,this.customViews=new Object,this.views=new e,o){var n=this;o.attributes&&o.attributes.forEach(function(t){n.has(t)}),o.behaviours&&o.behaviours.forEach(function(t){n.does(t)})}}o.prototype.as=function(t){var e=i.game.attributes[t];return"function"==typeof e&&(e=new e),this.attributes.set(this.name,e),e},n.prototype.as=function(t){var e=i.renderizables[t.charAt(0).toUpperCase()+t.substr(1)];return"function"==typeof e&&(e=new e),this.views.set(this.name,e),e},s.prototype.onLoop=function(t){for(var e=0,i=this.attributes,o=this.views,n=this.behaviours._values,s=n.length;s>e;e++)n[e]&&n[e](this,i,o,t)},s.prototype.getAttribute=function(t){return this.attributes.get(t)},s.prototype.hasAttribute=function(t){return!!this.attributes.get(t)},s.prototype.attribute=function(t,e){return 2!=arguments.length?this.attributes.get(t):void this.attributes.set(t,e)},s.prototype.behaviour=function(t,e){return 2!=arguments.length?this.behaviours.get(t):void this.behaviours.set(t,e)},s.prototype.hasBehaviour=function(t){return!!this.behaviours.get(t)},s.prototype.getBehaviour=function(t){return this.behaviours.get(t)},s.prototype.behaviour=s.prototype.getBehaviour,s.prototype.getView=function(t){return this.views.get(t)},s.prototype.view=s.prototype.getView,s.prototype.has=function(t,e){return void 0==e&&(e=i.game.attributes[t],"function"==typeof e&&(e=new e),void 0==e)?new o(t,this.attributes):(this.attributes.set(t,e),e)},s.prototype.hasnt=function(t){return this.attributes.remove(t)},s.prototype.does=function(t,e){return e&&!i.game.behaviours[t]&&this.registerBehaviour(t,e),void 0==e&&(e=i.game.behaviours[t]||this.customBehaviours[t]),void 0==e?i.logger.error("Cannot add undefined behaviour "+t+" to entity"):this.behaviours.set(t,e),this},s.prototype.registerBehaviour=function(t,e){this.customBehaviours[t]=e},s.prototype["do"]=function(t){var e=this.behaviour.get(t);e&&e(this,this.attributes,this.views,i.onLoopProperties)},s.prototype.can=function(t){return!!this.behaviours.get(t)},s.prototype.doesnt=function(t){return this.behaviours.remove(t)},s.prototype.shows=function(t,e){var o=t;return o||(o=i.random.string()),void 0==e?new n(o,this.views):void this.views.set(o,e)},s.prototype.doesntShow=function(t){return this.views.remove(t)},s.prototype.registerView=function(t,e){this.customViews[t]=e},s.prototype.addView=function(t){return this.views.set(t,this.customViews[t])},s.prototype.removeView=function(t){this.views.remove(t)},s.name="Entity",i.extend(s,EventHandler),t.Entity=s}(M,SimpleMap,M),function(t,e,i){function o(t){e.call(this,t),this.does("fixViewsToEntity")}o.name="ViewableEntity",i.extend(o,e),t.ViewableEntity=o}(Match,M.Entity,M),function(t){function e(){this.disabled=!1}e.prototype.enable=function(){this.disabled=!1},e.prototype.disable=function(){this.disabled=!0},e.prototype.onLoop=function(){this.disabled||this.update()},e.name="Trigger",t.Trigger=e}(Match),function(t,e){function i(){this.extendsTrigger(),this.entitiesAndCallbacks=[]}i.prototype.update=function(){var t,e,i=0,o=this.entitiesAndCallbacks.length;for(i=0;o>i;i++)t=this.entitiesAndCallbacks[i],e=t.entity.attribute("manifold"),e&&t.callback(e,this)},i.prototype.onCollision=function(t,e){this.entitiesAndCallbacks.push({entity:t,callback:e})},t.extend(i,t.Trigger),t.CollisionTrigger=i}(Match),function(t,e){function i(t,e,i,o){this.extendsTrigger(),this.left=t,this.top=e,this.width=i,this.height=o,this.entitiesAndCallbacks=[]}i.prototype.getLeft=function(){return this.left},i.prototype.getTop=function(){return this.top},i.prototype.getRight=function(){return this.left+this.width},i.prototype.getBottom=function(){return this.top+this.height},i.prototype.update=function(){var t,i=0,o=this.entitiesAndCallbacks.length,n=this;for(i=0;o>i;i++)t=this.entitiesAndCallbacks[i],t.entity.views.eachValue(function(i){return e.haveCollided(i,n)?void t.callback(t.entity,n):void 0})},i.prototype.onObjectInArea=function(t,e){this.entitiesAndCallbacks.push({entity:t,callback:e})},t.extend(i,t.Trigger),t.AreaTrigger=i}(Match,Match.collisions.Simple),M.registerScene("matchLogo",{sprites:{fonts:M.renderizables.BitmapText.DEFAULT_FONT},onLoad:function(){var t=new M.Entity,e=M.getCenter();t.shows("poweredBy").as("bitmapText").set({fill:"fonts",x:e.x,y:e.y-40,text:"POWERED BY",scaleX:.15,scaleY:.15}),t.shows("match").as("bitmapText").set({fill:"fonts",x:e.x,y:e.y,text:"MATCH",scaleX:.5,scaleY:.5}),M.push(t).to("logo"),M.getLayer("logo").background="#000"}}),M.registerScene("loading",{sprites:{fonts:M.renderizables.BitmapText.DEFAULT_FONT},onLoad:function(){var t,e,i=new M.Entity,o=new M.Entity,n=M.getCenter();i.shows("loading").as("bitmapText").set({fill:"fonts",x:n.x,y:n.y,text:"LOADING...",scaleX:.25,scaleY:.25}),o.shows("background").as("rectangle").set({fill:"#fa0",x:i.getView("loading").getX(),y:n.y+30,width:0,height:20}),o.shows("border").as("rectangle").set({fill:"rgba(0,0,0,0)",x:n.x,y:n.y+30,width:150,height:20,border:"#a50",borderWidth:2}),M.push(i).to("loading"),M.push(o).to("loading"),M.getLayer("loading").background="#000",t=o.getView("background"),e=o.getView("border").getWidth(),M.sprites.onImageLoaded.addEventListener(function(o){t.setWidth(e-o.remaining*e/o.total),t.setLeft(i.getView("loading").getLeft()),console.debug("loaded sprite: "+o.name)})}}),M.registerAttribute("location",M.math2d.Vector2d),M.registerAttribute("direction",M.math2d.Vector2d),M.registerAttribute("areaToStayIn",function(t,e,i,o){this.left=o,this.top=t,this.right=e,this.bottom=i}),M.registerAttribute("collisionGroup",0),M.registerBehaviour("accelerate",function(t,e){if(e.get("isAccelerating")){var i=e.get("speed")+e.get("acceleration"),o=e.get("maxSpeed");i>o&&(i=o),e.set("speed",i)}}),M.registerBehaviour("bounce",function(t,e,i,o){var n=e.get("direction"),s=o.m.renderer.getWidth(),r=o.m.renderer.getHeight();i.eachValue(function(t){t.offset(n.x,n.y),(t.getRight()>s||t.getLeft()<0)&&(n.x*=-1),(t.getBottom()>r||t.getTop()<0)&&(n.y*=-1)})}),function(t){function e(t,e,i,o,n,s){this.entity=t,this.collidedWith=e,this.viewFromSelf=i,this.viewFromOther=o,this.collisionInX=n,this.collisionInY=s}t.registerBehaviour("collide",function(i,o){for(var n,s,r,a,h,u,p,c=(o.get("location"),t._gameObjects),l=0,d=c.length,f=o.get("collisionGroup"),g=t.collisions.Polygon,y=!1,m=!1;d>l;l++)if(n=c[l],n!=i&&n.attribute("collisionGroup")==f)for(h=0;h<n.views._values.length;h++)for(r=n.views._values[h],a=0;a<i.views._values.length;a++)if(s=i.views._values[a],g.haveCollided(s,r)){u=s._y,p=s._prevY,s._y=p,g.haveCollided(s,r)?y=!0:m=!0,s._y=u;var v=new e(i,n,s,r,y,m);return o.set("manifold",v),void i.raiseEvent("onCollision",v)}o.set("manifold",!1)})}(Match),M.registerBehaviour("decelerate",function(t,e){if(e.get("isDecelerating")){var i=e.get("speed")-e.get("deceleration"),o=e.get("minSpeed");!e.get("canGoReverse")&&0>i&&(i=0),o>i&&(i=o),e.set("speed",i)}}),M.registerBehaviour("fixViewsToEntity",function(t,e,i){var o=e.get("rotation"),n=e.get("location"),s=0,r=0,a=0;void 0==this.rotation&&(this.rotation=0),void 0==this.location&&(this.location=new Object,this.location.x=0,this.location.y=0),o&&o!=this.rotation&&(s=o-this.rotation,this.rotation=o),n.x!=this.location.x&&(r=n.x-this.location.x,this.location.x=n.x),n.y!=this.location.y&&(a=n.y-this.location.y,this.location.y=n.y),i.eachValue(function(t){(0!=r||0!=a)&&t.offset(r,a),0!=s&&t.offsetRotation(s,n.x,n.y)})}),M.registerBehaviour("followCamera",function(t,e,i,o){var n=e.get("location");o.m.renderer.camera.centerAt(n.x,n.y)}),function(t){t.registerBehaviour("monitorAttributes",function(t,e){var i=e.get("location"),o=e.get("rotation");this._cachedValues&&this._cachedValues.x==i.x&&this._cachedValues.y==i.y&&this._cachedValues.rotation==o?this.alreadyUpdated||(e.push("attributeChanged",!1),this.alreadyUpdated=!0):(this._cachedValues={x:e.get("location").x,y:e.get("location").y,rotation:e.get("rotation")},e.push("attributeChanged",!0),this.alreadyUpdated=!1)})}(M),M.registerBehaviour("rotateViews",function(t,e,i){var o=e.get("rotation"),n=0;if(void 0==this.rotation&&(this.rotation=0),o!=this.rotation&&(n=o-this.rotation,this.rotation=o),0!=n){var s=e.get("location");i.eachValue(function(t){t.offsetRotation(n);var e=t._x-s.x,i=t._y-s.y,o=M.math2d.getRotatedVertexCoordsX(e,i,n),r=M.math2d.getRotatedVertexCoordsY(e,i,n);t.setLocation(o+s.x,r+s.y)})}}),M.registerBehaviour("stayInArea",function(t,e,i,o){var n=e.get("areaToStayIn");i.eachValue(function(t){t.getLeft()<n.left&&t.setLeft(n.left),
t.getRight()>n.right&&t.setRight(n.right),t.getTop()<n.top&&t.setTop(n.top),t.getBottom()>n.bottom&&t.setBottom(n.bottom)})}),M.registerBehaviour("stickToCanvas",function(t,e,i,o){var n=o.m.renderer.getWidth(),s=o.m.renderer.getHeight();i.eachValue(function(t){t.getLeft()<0&&t.setLeft(0),t.getRight()>n&&t.setRight(n),t.getTop()<0&&t.setTop(0),t.getBottom()>s&&t.setBottom(s)})}),M.registerBehaviour("translateViews",function(t,e,i){var o=e.get("location"),n=0,s=0;void 0==this.location&&(this.location=new Object,this.location.x=0,this.location.y=0),o.x!=this.location.x&&(n=o.x-this.location.x,this.location.x=o.x),o.y!=this.location.y&&(s=o.y-this.location.y,this.location.y=o.y),(0!=n||0!=s)&&i.eachValue(function(t){t.offset(n,s)})});