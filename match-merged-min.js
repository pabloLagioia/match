(function(namespace){function EventListener(){this.listeners=new Array}EventListener.prototype.addEventListener=function(listener,owner){if(owner)listener=listener.bind(owner);this.listeners.push(listener)};EventListener.prototype.raise=function(){var i=0,l=this.listeners.length;if(l==0)return;for(var i=0;i<l;i++)this.listeners[i](arguments)};EventListener.prototype.removeEventListener=function(listener){var l=this.listeners.indexOf(listener);if(l>-1)this.listeners.splice(l,1)};EventListener.prototype.removeAllEventListeners=
function(){var listeners=this.listeners;this.listeners=new Array;return listeners};namespace.EventListener=EventListener})(window);var M=window.M||{},game=window.game||{};
(function(namespace){if(namespace.Match)return;function Browser(){var browsers=["Firefox","Chrome","Opera","Safari","MSIE 9.0","BlackBerry"],i,browserName;this.name=undefined;for(i in browsers){browserName=browsers[i];this["is"+browserName]=navigator.userAgent.indexOf(browserName)!=-1;if(!this.name&&this["is"+browserName])this.name=browserName}this.supportedAudioFormat=this.getBrowserPreferredAudioFormat();this.supported=this.name!=undefined}Browser.prototype.getBrowserPreferredAudioFormat=function(){var a=
document.createElement("audio");if(a.canPlayType("audio/ogg")!="")return".ogg";if(a.canPlayType("audio/mpeg")!="")return".mp3";if(a.canPlayType("audio/wav")!="")return".wav";if(a.canPlayType("audio/mp4")!="")return".mp4";console.warn("This browser does not support audio")};Browser.prototype.getBrowserAudioSupportedFormats=function(){var a=document.createElement("audio"),f=new Array;if(a.canPlayType("audio/ogg")!="")f.push(".ogg");if(a.canPlayType("audio/mpeg")!="")f.push(".mp3");if(a.canPlayType("audio/wav")!=
"")f.push(".wav");if(a.canPlayType("audio/mp4")!="")f.push(".mp4");return f.join("|")};function Device(){var devices=["Android","BlackBerry","iPhone","iPad","iPod","IEMobile"],i;for(i in devices){deviceName=devices[i];this["is"+deviceName]=navigator.userAgent.indexOf(deviceName)!=-1;if(!this.name&&this["is"+deviceName])this.name=deviceName}if(this.name)this.isMobile=true;else{this.isMobile=false;this.name="PC"}}function Match(){this._isPlaying=false;this._gameLayers=[];this._gameObjects=[];this.cache=
null;this.offScreenCanvas=document.createElement("canvas");this.offScreenContext=this.offScreenCanvas.getContext("2d");this.onLoopProperties={offScreenContext:this.offScreenContext,offScreenCanvas:this.offScreenCanvas,debug:false,time:0};this.browser=new Browser;this.device=new Device;this.onBeforeLoop=new EventListener;this.onAfterLoop=new EventListener;this.onGameObjectPushed=new EventListener;this.onGameObjectRemoved=new EventListener;this.setDoubleBuffer(false);this.plugins={html:{}};var self=
this;document.addEventListener("DOMContentLoaded",function(){self.setUpGameLoop()})}Match.prototype.registerClass=function(){var namespace=arguments[0].split("."),clousure=arguments[arguments.length-1],current=window,l=namespace.length-1,dependencies=[],name;for(var i=0;i<l;i++){name=namespace[i];if(!current[name])current[name]=new Object;current=current[name]}if(!current[namespace[l]]){for(var i=1;i<arguments.length-1;i++)dependencies.push(arguments[i]);current[namespace[l]]=clousure.apply(clousure,
dependencies);current[namespace[l]].namespace=arguments[0]}};Match.prototype.registerGameObject=function(){console.warn("registerGameObject implementation is not final and may change");arguments[0]="game."+arguments[0];this.registerClass.apply(this,arguments)};Match.prototype.registerPlugin=function(){arguments[0]="M.plugins."+arguments[0];this.registerClass.apply(this,arguments)};Match.prototype.registerPluginTemplate=function(id,html){this.plugins.html[id]=html};Match.prototype.getGameObject=function(className){console.warn("getGameObject implementation is not final and may change");
return game[className]};Match.prototype._getClassInstance=function(className,setAttributes){var path=className.split("."),clazz=window,instance,i,keyValuePair;for(var i=0;i<path.length;i++)clazz=clazz[path[i]];instance=new clazz;for(i in setAttributes){keyValuePair=setAttributes[i];if(instance[keyValuePair.key])if(typeof instance[keyValuePair.key]=="function")instance[keyValuePair.key](keyValuePair.value);else instance[keyValuePair.key]=keyValuePair.value}return instance};Match.prototype.getPluginTemplate=
function(id){var div=document.createElement("div");div.setAttribute("id",id);div.innerHTML=this.plugins.html[id];return div};Match.prototype.setUpGameLoop=function(){this.gameLoopAlreadySetup=true;gameLoop();if(typeof window.main=="function")window.main()};Match.prototype.setKeyboard=function(keyboard){this.keyboard=keyboard;this.onLoopProperties.keyboard=keyboard;this._buildInputMapping()};Match.prototype.setMouse=function(mouse){this.mouse=mouse;this.onLoopProperties.mouse=mouse;this._buildInputMapping()};
Match.prototype.setTouch=function(touch){this.touch=touch;this.onLoopProperties.touch=touch;this._buildInputMapping()};Match.prototype.setAccelerometer=function(accelerometer){this.accelerometer=accelerometer;this.onLoopProperties.accelerometer=accelerometer;this._buildInputMapping()};Match.prototype.setOrientation=function(orientation){this.orientation=orientation;this.onLoopProperties.orientation=orientation;this._buildInputMapping()};Match.prototype.renderSingleBuffer=function(list,frontCanvas,
p){var l=list.length,i=0,f=this.frontBuffer;f.clearRect(0,0,frontCanvas.width,frontCanvas.height);for(;i<l;i++)f.drawImage(list[i].onLoop(p),0,0)};Match.prototype.renderDoubleBuffer=function(list,frontCanvas,p){var l=list.length,i=0,currentLayer,backBuffer=this.backBuffer;backBuffer.clearRect(0,0,frontCanvas.width,frontCanvas.height);for(;i<l;i++){currentLayer=list[i];var result=currentLayer.onLoop(p);backBuffer.save();if(currentLayer.composite)backBuffer.globalCompositeOperation=currentLayer.composite;
if(currentLayer._alpha!=null&&currentLayer._alpha>=0&&currentLayer._alpha<=1)backBuffer.globalAlpha=currentLayer._alpha;backBuffer.translate(backBuffer.halfWidth,backBuffer.halfHeight);if(currentLayer.rotation)backBuffer.rotate(currentLayer.rotation);if(currentLayer.scale)backBuffer.scale(currentLayer.scale.x,currentLayer.scale.y);backBuffer.drawImage(result,-backBuffer.halfWidth,-backBuffer.halfHeight);backBuffer.restore()}this.frontBuffer.clearRect(0,0,frontCanvas.width,frontCanvas.height);this.frontBuffer.drawImage(backBuffer.canvas,
0,0)};Match.prototype.updateGameObjects=function(nodes,p){for(var i=0;i<nodes.length;i++){var node=nodes[i];if(this._applyInput)this._applyInput(p,node);if(node.onLoop)node.onLoop(p);if(node.children)this.updateGameObjects(node.children,p)}};Match.prototype._buildInputMapping=function(){var p=this.onLoopProperties,applyInput="",updateInput="";if(p.keyboard){applyInput+="p.keyboard.applyToObject(node);";updateInput+="p.keyboard.update();"}if(p.mouse){applyInput+="p.mouse.applyToObject(node);";updateInput+=
"p.mouse.update();"}if(p.touch){applyInput+="p.touch.applyToObject(node);";updateInput+="p.touch.update();"}if(p.accelerometer){applyInput+="p.accelerometer.applyToObject(node);";updateInput+="p.accelerometer.update();"}if(p.orientation){applyInput+="p.orientation.applyToObject(node);";updateInput+="p.orientation.update();"}this._applyInput=new Function("p","node",applyInput);this._updateInput=new Function("p",updateInput)};Match.prototype.gameLoop=function(){if(!this._isPlaying)return;this.onBeforeLoop.raise();
var p=this.onLoopProperties;p.time=this.FpsCounter.timeInMillis;this.updateGameObjects(this._gameObjects,p);this._updateInput(p);this.render(this._gameLayers,this.frontBuffer.canvas,p);this.FpsCounter.count();this.onAfterLoop.raise();if(this.mouse)this.mouse.clear()};Match.prototype.getAsBase64Image=function(){return this.frontBuffer.canvas.toDataURL()};Match.prototype.getAsImage=function(){var img=new Image;img.src=this.getAsBase64Image();return img};Match.prototype.getFirst=function(){return this.getIndex(0)};
Match.prototype.getIndex=function(index){try{return this._gameObjects[index]}catch(e){return null}};Match.prototype.get=function(key){if(this.cache&&this.cache.key==key)return this.cache;var i=this._gameObjects.length,current;while(i--){current=this._gameObjects[i];if(key==current.key){this.cache=current;return current}}return null};Match.prototype.getLast=function(){return this.getIndex(this._gameObjects.length-1)};Match.prototype.isInOnLoopList=function(object){return this._gameObjects.indexOf(object)!=
-1};Match.prototype.push=function(obj){if(obj instanceof this.Layer)this.pushLayer(obj);else this.pushObject(obj)};Match.prototype.pushGameObject=function(gameObject){if(!gameObject.onLoop)throw new Error("Cannot add object "+gameObject.constructor.name+", it doesn't have an onLoop method");this._gameObjects.push(gameObject);this.onGameObjectPushed.raise()};Match.prototype.pushObject=Match.prototype.pushGameObject;Match.prototype.removeGameObject=function(object){if(object!=undefined)if(typeof object==
"string")this.removeGameObject(this.get(object));else if(isNaN(object)){var index=this._gameObjects.indexOf(object);if(index!=-1){this._gameObjects.splice(index,1);this.onGameObjectRemoved.raise()}}else{this._gameObjects.splice(object,1);this.onGameObjectRemoved.raise()}};Match.prototype.removeAllGameObjects=function(){this._gameObjects=new Array};Match.prototype.createNewContext=function(){return window.document.createElement("canvas").getContext("2d")};Match.prototype.setDoubleBuffer=function(value){if(value){this.backBuffer=
this.createNewContext();this.updateBufferSize();this.render=this.renderDoubleBuffer}else this.render=this.renderSingleBuffer};Match.prototype.isDoubleBuffered=function(){return this.render==this.renderDoubleBuffer};Match.prototype.setCanvasSize=function(w,h){if(this.frontBuffer){this.frontBuffer.canvas.width=w;this.frontBuffer.canvas.height=h;this.updateBufferSize()}};Match.prototype.setCanvasStretch=function(value){if(value)this.setCanvasStretchTo(document.documentElement.clientWidth,document.documentElement.clientHeight);
else this.setCanvasStretchTo("auto","auto")};Match.prototype.setCanvasStretchTo=function(w,h){if(this.frontBuffer){if(w){if(typeof w=="number"||w!="auto"&&w.indexOf("px")=="-1"&&w.indexOf("%")=="-1")w=w+"px";this.frontBuffer.canvas.style.width=w}if(h){if(typeof h=="number"||h!="auto"&&h.indexOf("px")=="-1"&&h.indexOf("%")=="-1")h=h+"px";this.frontBuffer.canvas.style.height=h}}};Match.prototype.updateBufferSize=function(){if(this.frontBuffer){if(this.backBuffer&&this.frontBuffer){this.backBuffer.canvas.width=
this.frontBuffer.canvas.width;this.backBuffer.canvas.height=this.frontBuffer.canvas.height;this.backBuffer.halfWidth=this.backBuffer.canvas.width/2;this.backBuffer.halfHeight=this.backBuffer.canvas.height/2}this.offScreenCanvas.width=this.frontBuffer.canvas.width;this.offScreenCanvas.height=this.frontBuffer.canvas.height;if(this.collisions.PixelPerfect){this.collisions.PixelPerfect.testContext.canvas.width=this.offScreenCanvas.width;this.collisions.PixelPerfect.testContext.canvas.height=this.offScreenCanvas.height}this.updateViewport()}};
Match.prototype.createGameLayer=function(name,zIndex){var gameLayer=new this.GameLayer(name,zIndex||M._gameLayers.length);if(this.frontBuffer)gameLayer.setBufferSize(this.frontBuffer.canvas);this.pushGameLayer(gameLayer);return gameLayer};Match.prototype.redrawAllLayers=function(){for(var i=0;i<this._gameLayers.length;i++)this._gameLayers[i].needsRedraw=true};Match.prototype.createLayer=Match.prototype.createGameLayer;Match.prototype.pushGameLayer=function(gameLayer){if(!gameLayer)throw new Error("Cannot add null game layer");
if(this.frontBuffer)gameLayer.setBufferSize(this.frontBuffer.canvas);this._gameLayers.push(gameLayer)};Match.prototype.pushLayer=Match.prototype.pushGameLayer;Match.prototype.setScene=function(scene,loadingLayer,transition){var m=this;this.removeAllGameLayers();if(loadingLayer)this.pushLayer(loadingLayer);this.sprites.onAllImagesLoaded.removeAllEventListeners();this.sprites.load(scene.resources.sprites,function(){for(var i in scene.layers){var layer=new m.Layer,layerData=scene.layers[i];for(var j in layerData){var object=
layerData[j],instance=m._getClassInstance(object.className,object.setAttributes);if(object.beforePush)object.beforePush(instance);layer.push(instance)}m.pushLayer(layer)}for(var i in scene.objects){var object=scene.objects[i],instance=m._getClassInstance(object.className,object.setAttributes);if(object.beforePush)object.beforePush(instance);m.pushGameObject(instance)}if(loadingLayer)m.removeLayer(loadingLayer)})};Match.prototype.removeScene=function(){var layers=this._gameLayers;this.removeAllGameLayers();
return layers};Match.prototype.pushScene=function(layers){var i=0,l=layers.length;for(;i<l;i++)this.pushGameLayer(layers[i])};Match.prototype.swapScenes=function(layers){var layers=this.removeScene();this.pushScene(layers);return layers};Match.prototype.removeGameLayer=function(gameLayer){if(!gameLayer&&gameLayer!==0)gameLayer=this._gameLayers[0];this.removeElementFromArray(gameLayer,this._gameLayers);for(var i in gameLayer.onRenderList)this.removeGameObject(gameLayer.onRenderList[i])};Match.prototype.removeLayer=
Match.prototype.removeGameLayer;Match.prototype.removeAllGameLayers=function(){for(var i=0;i<this._gameLayers.length;i++){var gameLayer=this._gameLayers[i];for(var j in gameLayer.onRenderList)this.removeGameObject(gameLayer.onRenderList[j])}this._gameLayers=new Array};Match.prototype.getSpeed=function(pixelsPerSecond){return pixelsPerSecond/this.getAverageFps()};Match.prototype.getSpeedFixedAt=function(pixelsPerSecond,fps){var avgFps=this.getAverageFps();return pixelsPerSecond/avgFps*(fps/avgFps)};
Match.prototype.getFps=function(){return this.FpsCounter.fps};Match.prototype.getAverageFps=function(){return this.FpsCounter.getAverageFps()};Match.prototype.getGameTime=function(){return this.FpsCounter.gameTime};Match.prototype.getTime=function(){return this.FpsCounter.timeInMillis};Match.prototype.clearFrontBuffer=function(){if(this.frontBuffer)this.frontBuffer.clearRect(0,0,this.frontBuffer.canvas.width,this.frontBuffer.canvas.height)};Match.prototype.sortLayers=function(){this._gameLayers.sort(function(a,
b){return a._zIndex-b._zIndex})};Match.prototype.pause=function(){if(this._isPlaying){if(this.onPause)this.onPause()}else if(this.onUnPause)this.onUnPause();this._isPlaying=!this._isPlaying};Match.prototype.start=function(canvas,doubleBuffer){if(!canvas)canvas=M.dom("canvas");if(!(canvas instanceof HTMLCanvasElement))throw new Error("start is expecting an HTMLCanvasElement as argument");canvas.onselectstart=function(){return false};canvas.requestFullScreen=canvas.requestFullScreen||canvas.webkitRequestFullScreen||
canvas.mozRequestFullScreen||canvas.msRequestFullScreen;this.frontBuffer=canvas.getContext("2d");this.updateBufferSize();this.updateViewport();var i=0,l=this._gameLayers.length;for(;i<l;i++)this._gameLayers[i].setBufferSize(canvas);this._isPlaying=true;if(!this.gameLoopAlreadySetup)this.setUpGameLoop()};Match.prototype.updateViewport=function(){this.camera.setViewport(this.frontBuffer.canvas.width,this.frontBuffer.canvas.height)};Match.prototype.getViewportSize=function(){return{width:this.camera.viewportWidth,
height:this.camera.viewportHeight}};Match.prototype.removeIndexFromArray=function(index,array){array.splice(index,1)};Match.prototype.removeElementFromArray=function(element,array){var index=array.indexOf(element);if(index!=-1)this.removeIndexFromArray(index,array)};Match.prototype.dom=function(selector){return document.querySelector(selector)};Match.prototype.applyProperties=function(object,properties,mandatoryList){if(!object)return;if(!properties)return;if(mandatoryList){if(!properties)throw new Error("Cannot apply null properties to "+
object.constructor.name);var i=mandatoryList.length;while(i--)if(!properties[mandatoryList[i]])throw new Error("Unable to apply properties to ["+object.constructor.name+"] You must specify ["+mandatoryList[i]+"]");}var setter="";for(var i in properties){setter="set"+i.charAt(0).toUpperCase()+i.substr(1);if(object[setter])object[setter](properties[i]);else object[i]=properties[i]}return object};Match.prototype.apply=function(){var child=arguments[0];for(var i=1;i<arguments.length;i++){var parent=arguments[i];
if(parent)if(parent instanceof Function){var p=new parent;for(var j in p)if(!parent.prototype[j]&&!child[j])child[j]=p[j]}else for(var j in parent)if(!child[j])child[j]=parent[j]}};Match.prototype.put=function(into,from){for(var i in from)into[i]=from[i]};Match.prototype.clone=function(object){var clonedObject={};for(var i in object)c[i]=object[i];return clonedObject};Match.prototype.each=function(array,func,context){var i=array.length;if(context)while(i--)func.call(context,array[i]);else while(i--)func.call(array[i])};
Match.prototype.extend=function(descendant,parent){for(var m in parent.prototype)if(!descendant.prototype[m])descendant.prototype[m]=parent.prototype[m]};Match.prototype.round=function(number,decimals){var a="1";while(decimals--)a+="0";decimals=parseInt(a);return Math.round(number*decimals)/decimals};Match.prototype.fastRound=function(number){return number>>0};Match.prototype.getPercentage=function(part,of){return part*of/100};Match.prototype.elapsedTimeFrom=function(from,milliseconds){return M.getTime()-
from>=milliseconds};Match.prototype.isPaused=function(){return!this._isPlaying};Match.prototype.getStyleBySelector=function(selector){var sheetList=document.styleSheets,ruleList,i,j;for(i=sheetList.length-1;i>=0;i--){ruleList=sheetList[i].cssRules;for(j=0;j<ruleList.length;j++)if(ruleList[j].type==CSSRule.STYLE_RULE&&ruleList[j].selectorText==selector)return ruleList[j].style}return null};Match.prototype.setFullScreen=function(){if(this.frontBuffer&&this.frontBuffer.canvas.requestFullScreen)this.frontBuffer.canvas.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT)};
Match.prototype.getSceneCenter=function(){if(this.frontBuffer)return this.frontBuffer.canvas.getCenter();else return{x:0,y:0}};Match.prototype.setLoadingScene=function(scene){this.prevLayers=M.removeScene();this.pushScene(scene.getLayers())};Match.prototype.getObjectName=function(object){if(!object||!object.constructor)return object;var name=object.constructor.name;if(!name)name=object.constructor.toString().match(/function ([a-zA-Z_$][a-zA-Z_$0-9]*)/)[1];return name};if(window.console){if(window.console.log)window.console.debug=
window.console.log;if(!window.console.warn)window.console.warn=window.console.debug}else{window.console={};window.console.log=window.console.debug=window.console.error=window.console.warning=function(){}}HTMLElement.prototype.remove=function(){this.parentNode.removeChild(this)};HTMLElement.prototype.setClass=function(cssClass){this.setAttribute("class",cssClass)};HTMLCanvasElement.prototype.getCenter=function(){return{x:this.width/2,y:this.height/2}};HTMLCanvasElement.prototype.setSize=function(width,
height){this.width=width;this.height=height};HTMLCanvasElement.prototype.adjustTo=function(width,height){this.style.setProperty("width",width+"px",null);this.style.setProperty("height",height+"px",null)};HTMLCanvasElement.prototype.adjustToAvailSize=function(){this.adjustTo(window.screen.availWidth+"px",window.screen.availHeight+"px")};HTMLCanvasElement.prototype.resizeKeepingAspect=function(times){this.adjustTo(this.width*times,this.height*times)};HTMLCanvasElement.prototype.getRight=function(){return this.offsetLeft+
this.offsetWidth};HTMLCanvasElement.prototype.getBottom=function(){return this.offsetTop+this.offsetHeight};HTMLCanvasElement.prototype.getAvailWidth=function(){if(this.getRight()<window.screen.availWidth)return this.offsetWidth;else return window.screen.availWidth-this.offsetLeft};HTMLCanvasElement.prototype.getAvailHeight=function(){if(this.getBottom()<window.screen.availHeight)return this.offsetHeight;else return window.screen.availHeight-this.offsetTop};HTMLCanvasElement.prototype.getViewport=
function(){var viewport={};if(this.offsetLeft<0)viewport.left=-this.offsetLeft;else viewport.left=0;if(this.offsetTop<0)viewport.top=-this.offsetTop;else viewport.top=0;if(this.offsetLeft+this.offsetWidth>window.screen.availWidth)viewport.right=window.screen.availWidth-this.offsetLeft;else viewport.right=this.offsetWidth;if(this.offsetTop+this.offsetHeight>window.screen.availHeight)viewport.bottom=window.screen.availHeight-this.offsetTop;else viewport.bottom=this.offsetHeight;return viewport};HTMLCanvasElement.prototype.getAspect=
function(){var aspect={x:1,y:1};if(this.style.width&&this.width!=parseInt(this.style.width))aspect.x=this.width/parseInt(this.style.width);if(this.style.height&&this.height!=parseInt(this.style.height))aspect.y=this.height/parseInt(this.style.height);return aspect};CanvasRenderingContext2D.prototype.resetOperation=function(){if(this.operationChanged&&this.globalCompositeOperation!="source-over"){this.globalCompositeOperation="source-over";this.operationChanged=false}};CanvasRenderingContext2D.prototype.resetAlpha=
function(){if(this.alphaChanged&&this.globalAlpha!=1){this.globalAlpha=1;this.alphaChanged=false}};CanvasRenderingContext2D.prototype.resetShadow=function(){if(this.shadowChanged){if(this.shadowBlur!=0)this.shadowBlur=0;if(this.shadowOffsetX!=0)this.shadowOffsetX=0;if(this.shadowOffsetY!=0)this.shadowOffsetY=0;this.shadowChanged=false}};if(!window.requestAnimationFrame)window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(callback){setTimeout(callback,1E3/60)};namespace.M=namespace.Match=new Match;function gameLoop(){requestAnimationFrame(gameLoop);M.gameLoop()}})(window);(function(M){function Ajax(){}Ajax.prototype._request=function(method,url,callback,owner){var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200)if(owner)callback.call(owner,this.responseText);else callback(this.responseText)};xmlhttp.open(method,url,true);xmlhttp.send()};Ajax.prototype.post=function(url,callback){this._request("POST",url,callback)};Ajax.prototype.get=function(url,callback){this._request("GET",url,callback)};M.Ajax=new Ajax})(window.Match);(function(namespace){function ArrayList(){this._list=new Array(10);this.size=0}ArrayList.prototype.push=function(item){if(this.size==this._list.length)this._list.length+=10;this._list[this.size]=item;return this.size++};ArrayList.prototype.clear=function(i){this.removeAll();this._list=new Array(10)};ArrayList.prototype.removeAll=function(i){this.size=0};ArrayList.prototype.get=function(i){return this._list[i]};ArrayList.prototype.quickRemove=function(i){this._list[i]=null;this._swap(i,this.size-1);
this.size--};ArrayList.prototype.remove=function(i){this._list.splice(i,1);this.size--};ArrayList.prototype.each=function(fnc){var l=this._list,s=this.size;for(var i=0;i<s;i++)fnc(l[i],i,this)};ArrayList.prototype._swap=function(from,to){var f=this._list[from],t=this._list[to];this._list[from]=t;this._list[to]=f};namespace.ArrayList=ArrayList})(M);(function(M){function FpsCounter(){this.lastTime=(new Date).getTime();this._currentFps=0;this.fps="";this.gameTime=1;this.timeInMillis=0;this.totalFps=0}FpsCounter.prototype.reset=function(){this.fps="";this.totalFps=0;this._currentFps=0;this.timeInMillis=0;this.gameTime=1};FpsCounter.prototype.count=function(){this.timeInMillis=(new Date).getTime();if(this.timeInMillis-this.lastTime>=1E3){this.lastTime=this.timeInMillis;this.fps=this._currentFps;this.gameTime++;this.totalFps+=this.fps;this._currentFps=
0}else this._currentFps++};FpsCounter.prototype.getAverageFps=function(){if(this.totalFps==0)return 60;return Math.floor(this.totalFps/this.gameTime)};M.FpsCounter=new FpsCounter})(window.Match);(function(M){function GameObject(){this.hasFocus=false;this.children=[]}GameObject.prototype.pushChild=function(child){child.ownerLayer=this.ownerLayer;return this.children.push(child)};GameObject.prototype.removeChild=function(child){M.removeElementFromArray(child,this.children)};GameObject.prototype.onLoop=function(){throw new Error("Method GameObject.onLoop is abstract and must be overriden");};M.GameObject=GameObject})(window.M);(function(namespace){function Math2d(){this.math=Math}Math2d.prototype.valueInBetween=function(value,a,b){return a<=value&&value<=b};Math2d.prototype.getXFromCircle=function(x0,r,t){return x0+r*this.math.cos(t)};Math2d.prototype.getYFromCircle=function(y0,r,t){return y0+r*this.math.sin(t)};Math2d.prototype.getPointFromCircle=function(x0,y0,r,t){return this.getPointFromElipsis(x0,y0,r,r,t)};Math2d.prototype.getPointFromElipsis=function(x0,y0,xR,yR,t){return new Vector2d(this.getXFromCircle(x0,xR,t),
this.getYFromCircle(y0,yR,t))};Math2d.prototype.getVector2d=function(vector1,vector2){return new Vector2d(vector2.x-vector1.x,vector2.y-vector1.y)};Math2d.prototype.getVector=function(vector1,vector2){return this.getVector2d(vector1,vector2)};Math2d.prototype.getRotatedVertex=function(vertex,rotation){return new Vector2d(vertex.x*this.math.cos(rotation)-vertex.y*this.math.sin(rotation),vertex.y*this.math.cos(rotation)+vertex.x*this.math.sin(rotation))};Math2d.prototype.getMagnitude=function(vector){return this.math.sqrt(vector.x*
vector.x+vector.y*vector.y)};Math2d.prototype.getSquareDistance=function(vector1,vector2){var x=vector1.x-vector2.x;var y=vector1.y-vector2.y;return x*x+y*y};Math2d.prototype.getAngleBetweenVectors=function(vector1,vector2){var m=this.getMagnitude(vector1)*this.getMagnitude(vector2);return this.math.acos((vector1.x*vector2.x+vector1.y*vector2.y)/m)};Math2d.prototype.getCosBetweenVectors=function(vector1,vector2){var m=this.getMagnitude(vector1)*this.getMagnitude(vector2);return(vector1.x*vector2.x+
vector1.y*vector2.y)/m};Math2d.prototype.getDistance=function(vector1,vector2){return this.math.sqrt(this.getSquareDistance(vector1,vector2))};Math2d.prototype.haveTheSameDirection=function(vector1,vector2){if(vector1.x>0&&vector2.x<0)return false;if(vector1.x<0&&vector2.x>0)return false;if(vector1.y>0&&vector2.y<0)return false;if(vector1.y<0&&vector2.y>0)return false;return true};Math2d.prototype.areParallelVectors=function(vector1,vector2){vector1=this.getNormalized(vector1);vector2=this.getNormalized(vector2);
var x=vector1.x/vector2.x,y=vector1.y/vector2.y;return x>=y-0.1&&x<=y+0.1};Math2d.prototype.getNormalized=function(vector){var magnitude=this.getMagnitude(vector);return new Vector2d(vector.x/magnitude,vector.y/magnitude)};Math2d.prototype.substract=function(vector1,vector2){return new Vector2d(vector1.x-vector2.x,vector1.y-vector2.y)};Math2d.prototype.add=function(vector1,vector2){return new Vector2d(vector1.x+vector2.x,vector1.y+vector2.y)};Math2d.prototype.scalarProduct=function(vector,scalar){return new Vector2d(vector.x*
scalar,vector.y*scalar)};Math2d.prototype.rotateIfNeeded=function(vector1,vector2,rotation){if(!(this.areParallelVectors(vector1,vector2)&&this.haveTheSameDirection(vector1,vector2))){var distance=this.getSquareDistance(vector1,vector2),rotated1=this.getRotatedVertex(vector1,rotation),distanceAfterRotation=this.getSquareDistance(rotated1,vector2);if(distanceAfterRotation<distance){vector1.x=rotated1.x;vector1.y=rotated1.y;return rotation}else{var rotated2=this.getRotatedVertex(vector1,-rotation);
vector1.x=rotated2.x;vector1.y=rotated2.y;return-rotation}}return 0};function Vector2d(x,y){this.x=x;this.y=y}namespace.math2d=namespace.Math2d=new Math2d;namespace.math2d.Vector2d=Vector2d})(window.Match);(function(M,namespace){function AllvsAllCollisionHandler(mode){this.objects=[];this.mode=null;this.setMode(mode||"Polygon")}AllvsAllCollisionHandler.prototype={reset:function(){this.objects=[]},onLoop:function(){var i=0,j=1;while(i<this.objects.length){while(j<this.objects.length){this.checkCollisions(this.objects[i],this.objects[j]);j++}i++;j=i+1}i=this.objects.length;while(i--)if(!this.objects[i]._visible)M.removeIndexFromArray(i,this.objects)},canCollide:function(collider,collidable){if(collider.cantCollideType){var i=
collider.cantCollideType.length;while(i--)if(collidable instanceof collider.cantCollideType[i])return false}if(collider.cantCollide){var i=collider.cantCollide.length;while(i--)if(collider.cantCollide[i]==collidable)return false}return true},checkCollisions:function(collider,collidable){if(!this.canCollide(collider,collidable))return;if(!this.canCollide(collidable,collider))return;if(this.mode.haveCollided(collider,collidable)){if(collider.onCollision)collider.onCollision(collidable);if(collidable.onCollision)collidable.onCollision(collider)}},
setMode:function(mode,properties){if(typeof mode==="string")this.mode=M.collisions[mode];else this.mode=mode},push:function(object){this.objects.push(object)},removeType:function(type){var i=this.objects.length;while(i--)if(this.objects[i]instanceof type)this.remove(this.objects[i])}};namespace.AllvsAllCollisionHandler=AllvsAllCollisionHandler})(window.Match,window.Match.collisions||(window.Match.collisions={}));(function(M,namespace){function CollisionHandler(mode){this.colliders=[];this.collidables=[];this.setMode(mode||"Polygon");this.colliderCallback="onCollision";this.collidableCallback="onCollision"}CollisionHandler.prototype={onLoop:function(){var i=this.colliders.length;while(i--)this.checkCollisions(this.colliders[i],this.collidables)},checkCollisions:function(collider,list){if(!collider)return;var i=list.length,collidable=null;while(i--){collidable=list[i];if(!collidable)return;if(collidable instanceof
Array)this.checkCollisions(collider,collidable);else if(this.mode.haveCollided(collider,collidable)){if(collider[this.colliderCallback])collider[this.colliderCallback](collidable);if(collidable[this.collidableCallback])collidable[this.collidableCallback](collider)}}},setMode:function(mode){if(typeof mode==="string")this.mode=M.collisions[mode];else this.mode=mode}};namespace.CollisionHandler=CollisionHandler})(window.Match,window.Match.collisions||(window.Match.collisions={}));(function(namespace,math2d){function Polygon(){this.math2d=math2d}Polygon.prototype={getCollisionArea:function(renderizable){var vertices=[],halfWidth=renderizable.getWidth()/2,halfHeight=renderizable.getHeight()/2;vertices.push({x:-halfWidth,y:-halfHeight});vertices.push({x:halfWidth,y:-halfHeight});vertices.push({x:halfWidth,y:halfHeight});vertices.push({x:-halfWidth,y:halfHeight});this.rotate(vertices,renderizable._rotation);this.translate(vertices,renderizable._x,renderizable._y);return vertices},
translate:function(vertices,x,y){for(var i=0;i<vertices.length;i++){vertices[i].x+=x;vertices[i].y+=y}},rotate:function(vertices,angle){if(!angle)return;for(var i=0;i<vertices.length;i++)vertices[i]=this.math2d.getRotatedVertex(vertices[i],angle)},haveCollided:function(collider,collidable){var collidableVertices=this.getCollisionArea(collidable),colliderVertices=this.getCollisionArea(collider),i=0;for(;i<colliderVertices.length;i++){if(this.pointInPolygon(colliderVertices[i].x,colliderVertices[i].y,
collidableVertices))return true;if(this.pointInPolygon(collidableVertices[i].x,collidableVertices[i].y,colliderVertices))return true}return false},pointInPolygon:function(x,y,vertices){var i,j,c=false,nvert=vertices.length,vi,vj;for(i=0,j=nvert-1;i<nvert;j=i++){vi=vertices[i];vj=vertices[j];if(vi.y>y!=vj.y>y&&x<(vj.x-vi.x)*(y-vi.y)/(vj.y-vi.y)+vi.x)c=!c}return c}};namespace.Polygon=new Polygon})(window.Match.collisions||(window.Match.collisions={}),window.Match.math2d);(function(namespace){function Square(){}Square.prototype={haveCollided:function(collider,collidable){var sizeThis=0,sizeObj=0;if(collider._halfWidth>collider._halfHeight)sizeThis=collider._halfWidth;else sizeThis=collider._halfHeight;if(collidable._halfWidth>collidable._halfHeight)sizeObj=collidable._halfWidth;else sizeObj=collidable._halfHeight;if(collider._y+sizeThis<collidable._y-sizeObj)return false;if(collider._y-sizeThis>collidable._y+sizeObj)return false;if(collider._x+sizeThis<collidable._x-
sizeObj)return false;if(collider._x-sizeThis>collidable._x+sizeObj)return false;return true}};namespace.Square=new Square})(window.Match.collisions||(window.Match.collisions={}));(function(namespace,math2d){function Radial(radius){this.math2d=math2d}Radial.prototype={haveCollided:function(collider,collidable){var colliderradius=collider.getWidth()*collider.getHeight()/2,collidableradius=collidable.getWidth()*collidable.getHeight()/2,radius=colliderradius<collidableradius?colliderradius:collidableradius;return this.math2d.getSquareDistance(collider.getLocation(),collidable.getLocation())<=radius*radius}};namespace.Radial=new Radial})(window.Match.collisions||(window.Match.collisions=
{}),window.Match.math2d);(function(namespace){function Simple(){}Simple.prototype={haveCollided:function(collider,collidable){if(collider.getBottom()<collidable.getTop())return false;if(collider.getTop()>collidable.getBottom())return false;if(collider.getRight()<collidable.getLeft())return false;if(collider.getLeft()>collidable.getRight())return false;return true}};namespace.Simple=new Simple})(window.Match.collisions||(window.Match.collisions={}));(function(M,namespace){function PixelPerfect(){this.testContext=document.createElement("canvas").getContext("2d")}PixelPerfect.prototype.haveCollided=function(collider,collidable){var frontCanvas=M.frontBuffer.canvas,math=window.Math,minX=math.min(collider.getLeft(),collidable.getLeft()),minY=math.min(collider.getTop(),collidable.getTop()),width=math.max(collider.getRight(),collidable.getRight())-minX,height=math.max(collider.getBottom(),collidable.getBottom())-minY,context=this.testContext,column=
0,row=0,imageData;context.clearRect(minX,minY,width,height);context.save();collider.onRender(context,context.canvas,0,0);context.globalCompositeOperation="source-in";collidable.onRender(context,context.canvas,0,0);context.restore();imageData=context.getImageData(minX,minY,width,height);while(column<imageData.width){while(row<imageData.height){var offset=(row*imageData.width+column)*4;if(imageData.data[offset+3]!=0)return true;row++}column++;row=0}return false};namespace.PixelPerfect=new PixelPerfect})(window.Match,
window.Match.collisions||(window.Match.collisions={}));(function(M){function Camera(){this._x=0;this._y=0;this.viewportWidth=0;this.viewportHeight=0;this._halfViewportHeight=0;this._halfViewportWidth=0}Camera.prototype.setViewport=function(width,height){this.viewportWidth=width;this.viewportHeight=height;this._halfViewportWidth=width/2;this._halfViewportHeight=height/2};Camera.prototype.centerAtRenderizable=function(renderizable){this.x=renderizable._x-this._halfViewportWidth;this.y=renderizable._y-this._halfViewportHeight};Camera.prototype.centerAt=
function(x,y){this.x=x-this._halfViewportWidth;this.y=y-this._halfViewportHeight;M.redrawAllLayers()};Camera.prototype.setX=function(value){this._x=value;M.redrawAllLayers()};Camera.prototype.setY=function(value){this._y=value;M.redrawAllLayers()};Camera.prototype.getX=function(){return this._x};Camera.prototype.getY=function(){return this._y};Camera.prototype.offsetX=function(value){this.setX(this._x+value)};Camera.prototype.offsetY=function(value){this.setY(this._y+value)};Camera.prototype.getLeftFromLayer=
function(layer){return this.x*layer.parrallaxFactor.x};Camera.prototype.getTopFromLayer=function(layer){return this.y*layer.parrallaxFactor.y};Camera.prototype.getBottomFromLayer=function(layer){return this.getTopFromLayer(layer)+this.viewportHeight};Camera.prototype.getRightFromLayer=function(layer){return this.getLeftFromLayer(layer)+this.viewportWidth};M.onLoopProperties.camera=M.camera=new Camera})(window.Match);(function(M){var instance;function mouseDownHelper(e){instance.mousedown(e)}function mouseUpHelper(e){instance.mouseup(e)}function mouseClickHelper(e){instance.click(e)}function mouseMoveHelper(e){instance.mousemove(e)}function mouseWheelHelper(e){instance.mousewheel(e)}function mouseWheelHelperFireFox(e){instance.DOMMouseScroll(e)}function contextMenuHelper(e){e.preventDefault()}function Mouse(){this.events={0:{},1:{},2:{}};this.x=null;this.y=null;this.isDragging=false}Mouse.prototype.LEFT=0;Mouse.prototype.MIDDLE=
1;Mouse.prototype.RIGHT=2;Mouse.prototype.select=function(object){if(!this.isDragging)this.selectedObject=object};Mouse.prototype.preventContexMenu=function(value){if(value)document.addEventListener("contextmenu",contextMenuHelper,false);else document.removeEventListener("contextmenu",contextMenuHelper,false)};Mouse.prototype.fireEventOnLastSelectedObject=function(){var s=this.selectedObject,ps=this.prevSelectedObject;if(s){if(s.onMouseIn&&!s._mouseInRaised){s._mouseInRaised=true;s.onMouseIn(this)}if(ps&&
ps!=s){ps._mouseInRaised=false;if(ps.onMouseOut)ps.onMouseOut(this)}if(s.onMouseUp&&this.up())s.onMouseUp(this);if(s.onClick&&this.clicked())s.onClick(this);if(this.down()){if(s.onMouseDown)s.onMouseDown(this);this.isDragging=true;if(s.onDrag)s.onDrag(this)}if(s.onMouseOver)s.onMouseOver(this);if(s.onMouseMove&&this.moved())s.onMouseMove(this);if(s.onMouseWheel&&this.wheel())s.onMouseWheel(this)}else if(ps&&ps.onMouseOut){ps._mouseInRaised=false;ps.onMouseOut(this)}this.prevSelectedObject=s;if(!this.isDragging)this.selectedObject=
null};Mouse.prototype.clicked=function(button){if(button!=null)return this.events[button].click;return this.events[0].click};Mouse.prototype.down=function(button){if(button!=null)return this.events[button].down;return this.events[0].down||this.events[1].down||this.events[2].down};Mouse.prototype.up=function(button){if(button!=null)return this.events[button].up;return this.events[0].up||this.events[1].up||this.events[2].up};Mouse.prototype.moved=function(){return this.eventMouseMove};Mouse.prototype.wheel=
function(){this.wheelDeltaY=0;if(this.eventMouseWheel)this.wheelDeltaY=this.eventMouseWheel.wheelDeltaY;return this.wheelDeltaY};Mouse.prototype.clear=function(){for(var i=0;i<3;i++){this.events[i].up=null;this.events[i].click=null}this.eventMouseWheel=null;this.eventMouseMove=null};Mouse.prototype.click=function(e){this.events[e.button].click=e;this.x=e.offsetX;this.y=e.offsetY};Mouse.prototype.mousedown=function(e){this.events[e.button].down=e};Mouse.prototype.mouseup=function(e){this.events[e.button].down=
null;this.events[e.button].up=e;this.isDragging=false};Mouse.prototype.mousewheel=function(e){this.eventMouseWheel=e};Mouse.prototype.DOMMouseScroll=function(e){this.mousewheel({wheelDeltaY:e.detail*-40})};Mouse.prototype.isOverPixelPerfect=function(renderizable){if(!renderizable.onRender)return;if(!renderizable._visible)return;var ctx=M.offScreenContext,cnv=M.offScreenCanvas,camera=M.camera;ctx.save();ctx.clearRect(0,0,cnv.width,cnv.height);renderizable.onRender(ctx,cnv,camera._x,camera._y);var imgData=
ctx.getImageData(this.x,this.y,1,1);if(!imgData.data[3])return false;if(imgData.data[0])return true;if(imgData.data[1])return true;if(imgData.data[2])return true;return false};Mouse.prototype.isOverPolygon=function(renderizable){var camera=M.camera,x=this.x+camera._x,y=this.y+camera._y;if(renderizable._rotation){this._x=x;this._y=y;return M.collisions.Polygon.haveCollided(renderizable,this)}else{if(renderizable.getBottom()<y)return false;if(renderizable.getTop()>y)return false;if(renderizable.getRight()<
x)return false;if(renderizable.getLeft()>x)return false;return true}};Mouse.prototype.getHeight=function(){return 2};Mouse.prototype.getWidth=function(){return 2};Mouse.prototype.update=function(){this.fireEventOnLastSelectedObject();this.clear()};Mouse.prototype.applyToObject=function(renderizable){if(renderizable.onMouseOver||renderizable.onMouseIn||renderizable.onMouseOut||renderizable.onMouseWheel||renderizable.onMouseDown&&this.down()||renderizable.onMouseUp&&this.up()||renderizable.onClick&&
this.clicked())if(this.isOverPolygon(renderizable)&&this.isOverPixelPerfect(renderizable))this.select(renderizable)};if(M.browser.isFirefox){Mouse.prototype.mousemove=function(e){this.eventMouseMove=e;this.prevX=this.x;this.prevY=this.y;this.x=e.layerX-e.target.offsetLeft;this.y=e.layerY-e.target.offsetTop};Mouse.prototype.click=function(e){this.events[e.button].click=e;this.prevX=this.x;this.prevY=this.y;this.x=e.layerX-e.target.offsetLeft;this.y=e.layerY-e.target.offsetTop}}else Mouse.prototype.mousemove=
function(e){this.eventMouseMove=e;this.prevX=this.x;this.prevY=this.y;this.x=e.offsetX;this.y=e.offsetY};Mouse.prototype.bind=function(){if(M.browser.isFirefox)document.addEventListener("DOMMouseScroll",mouseWheelHelperFireFox,false);else if(M.browser.name=="MSIE 9.0")document.addEventListener("onwheel",mouseWheelHelper,false);else document.addEventListener("mousewheel",mouseWheelHelper,false);document.addEventListener("mousedown",mouseDownHelper,false);document.addEventListener("mouseup",mouseUpHelper,
false);document.addEventListener("mousemove",mouseMoveHelper,false);document.addEventListener("click",mouseClickHelper,false);M.setMouse(this)};Mouse.prototype.unbind=function(){if(M.browser.isFirefox)document.removeEventListener("DOMMouseScroll",mouseWheelHelperFireFox);else if(M.browser.name=="MSIE 9.0")document.removeEventListener("onwheel",mouseWheelHelper);else document.removeEventListener("mousewheel",mouseWheelHelper);document.removeEventListener("mousedown",mouseDownHelper);document.removeEventListener("mouseup",
mouseUpHelper);document.removeEventListener("mousemove",mouseMoveHelper);document.removeEventListener("click",mouseClickHelper);M.setMouse(null)};instance=new Mouse;instance.bind()})(window.Match);(function(M){var instance;function devicemotion(e){instance.accelerate(e)}function Accelerometer(){}Accelerometer.prototype.accelerate=function(event){this._hasEvent=true;this.accelerationIncludingGravity=event.accelerationIncludingGravity;this.acceleration=event.acceleration;this.rotationRate=event.rotationRate};Accelerometer.prototype.update=function(){this._hasEvent=false};Accelerometer.prototype.right=function(){return this._hasEvent&&(this.acceleration.x>0||this.accelerationIncludingGravity.x>
0)};Accelerometer.prototype.left=function(){return this._hasEvent&&(this.acceleration.x<0||this.accelerationIncludingGravity.y<0)};Accelerometer.prototype.up=function(){return this._hasEvent&&this.acceleration.y>0};Accelerometer.prototype.down=function(){return this._hasEvent&&this.acceleration.y<0};Accelerometer.prototype.applyToObject=function(node){if(this._hasEvent){if(node.onDeviceAccelerationIncludingGravity)node.onDeviceAccelerationIncludingGravity(this.accelerationIncludingGravity.x,this.accelerationIncludingGravity.y,
this.accelerationIncludingGravity.z,this.rotationRate);if(node.onDeviceAcceleration)node.onDeviceAcceleration(this.acceleration.x,this.acceleration.y,this.acceleration.z,this.rotationRate);if(node.onDeviceRotation)node.onDeviceRotation(this.rotationRate.alpha,this.rotationRate.beta,this.rotationRate.gamma)}};Accelerometer.prototype.bind=function(){window.addEventListener("devicemotion",devicemotion,false);M.setAccelerometer(this)};Accelerometer.prototype.unbind=function(){window.removeEventListener("devicemotion",
devicemotion);M.setAccelerometer(null)};instance=new Accelerometer;instance.bind()})(window.Match);(function(M){var instance;function onkeydown(e){instance.fireDown(e)}function onkeyup(e){instance.fireUp(e)}function Keyboard(){this.keysDown={length:0};this.keysUp=null;this.keysPressed={}}Keyboard.prototype.bind=function(){document.addEventListener("keydown",onkeydown,false);document.addEventListener("keyup",onkeyup,false);M.setKeyboard(this)};Keyboard.prototype.unbind=function(){document.removeEventListener("keydown",onkeydown);document.removeEventListener("keyup",onkeyup);M.setKeyboard(null)};
Keyboard.prototype[8]="backspace";Keyboard.prototype[9]="tab";Keyboard.prototype[13]="enter";Keyboard.prototype[16]="shift";Keyboard.prototype[17]="ctrl";Keyboard.prototype[18]="alt";Keyboard.prototype[19]="pause";Keyboard.prototype[20]="capslock";Keyboard.prototype[27]="escape";Keyboard.prototype[32]="space";Keyboard.prototype[33]="pageup";Keyboard.prototype[34]="pagedown";Keyboard.prototype[35]="end";Keyboard.prototype[36]="home";Keyboard.prototype[37]="left";Keyboard.prototype[38]="up";Keyboard.prototype[39]=
"right";Keyboard.prototype[40]="down";Keyboard.prototype[45]="insert";Keyboard.prototype[46]="delete";Keyboard.prototype[112]="f1";Keyboard.prototype[113]="f2";Keyboard.prototype[114]="f3";Keyboard.prototype[115]="f4";Keyboard.prototype[116]="f5";Keyboard.prototype[117]="f6";Keyboard.prototype[118]="f7";Keyboard.prototype[119]="f8";Keyboard.prototype[120]="f9";Keyboard.prototype[121]="f10";Keyboard.prototype[122]="f11";Keyboard.prototype[123]="f12";Keyboard.prototype[145]="numlock";Keyboard.prototype[220]=
"pipe";Keyboard.prototype.fireDown=function(event){var key=this[event.which]||String.fromCharCode(event.which).toLowerCase();this.keysDown[key]=true;if(this.keysPressed[key]==undefined)this.keysPressed[key]=true;this.keysDown.length++};Keyboard.prototype.fireUp=function(event){var key=this[event.which]||String.fromCharCode(event.which).toLowerCase();if(!this.keysUp)this.keysUp={};this.keysDown[key]=false;this.keysPressed[key]=undefined;this.keysUp[key]=true;if(this.keysDown.length>0)this.keysDown.length--};
Keyboard.prototype.update=function(){this.keysUp=null;for(var i in this.keysPressed)if(this.keysPressed[i])this.keysPressed[i]=false};Keyboard.prototype.applyToObject=function(object){if(!object.hasFocus)return;if(object.onKeyDown)object.onKeyDown(this.keysDown);if(object.onKeyUp)object.onKeyUp(this.keysUp);if(object.keyDownMappings&&this.keysDown.length>0)for(var i in object.keyDownMappings)if(this.keysDown[i])object[object.keyDownMappings[i]]();if(object.keyUpMappings&&this.keysUp)for(var i in object.keyUpMappings)if(this.keysUp[i])object[object.keyUpMappings[i]]()};
Keyboard.prototype.getKeyCode=function(key){return key.charCodeAt(0)};var instance=new Keyboard;instance.bind()})(window.Match);(function(M){var instance;function touchStartHelper(event){instance.start(event)}function touchEndHelper(event){instance.end(event)}function touchCancelHelper(event){instance.cancel(event)}function touchLeaveHelper(event){instance.leave(event)}function touchMoveHelper(event){instance.move(event)}function Touch(){this.x=0;this.y=0;this.isDragging=false;this.events={start:null,end:null,move:null}}Touch.prototype.clear=function(){if(this.events.end){this.events.start=null;this.x=0;this.y=0}this.events.end=
null;this.events.move=null;this.force=null;if(!this.isDragging)this.selectedObject=null};Touch.prototype.update=function(){this.fireEventOnLastSelectedObject(this);this.clear()};Touch.prototype.getHeight=function(){return 2};Touch.prototype.getWidth=function(){return 2};Touch.prototype.applyToObject=function(renderizable){if(!this.isDragging)if(renderizable.onTouch||renderizable.onTouchEnd||renderizable.onTouchMove||renderizable.onDrag)if(this.isOverPolygon(renderizable)&&this.isOverPixelPerfect(renderizable))this.selectedObject=
renderizable};Touch.prototype._setTouch=function(touch){this.x=touch.pageX-touch.target.offsetLeft;this.y=touch.pageY-touch.target.offsetTop;this.force=touch.force};Touch.prototype.start=function(event){var touches=event.changedTouches;if(touches.length){var touch=touches[0];this._setTouch(touch);this.events.start=touch}};Touch.prototype.end=function(event){var touches=event.changedTouches;if(touches.length){var touch=touches[0];this.events.end=touch;this.isDragging=false;this.selectedObject=null}};
Touch.prototype.move=function(event){var touches=event.changedTouches;if(touches.length){var touch=touches[0];this._setTouch(touch);this.events.move=touch}};Touch.prototype.started=function(){return this.events.start};Touch.prototype.moved=function(){return this.events.move};Touch.prototype.ended=function(){return this.events.end};Touch.prototype.any=function(){return this.started()||this.moved()||this.ended()};Touch.prototype.fireEventOnLastSelectedObject=function(){if(this.selectedObject){if(this.events.start){if(this.selectedObject.onTouch)this.selectedObject.onTouch(this);
if(this.selectedObject.onDrag)this.isDragging=true}if(this.events.end&&this.selectedObject.onTouchEnd)this.selectedObject.onTouchEnd(this);if(this.events.move){if(this.selectedObject.onTouchMove)this.selectedObject.onTouchMove(this);if(this.isDragging)this.selectedObject.onDrag(this)}}};Touch.prototype.isOverPixelPerfect=function(renderizable){if(!renderizable.onRender)return;if(!renderizable._visible)return;var ctx=M.offScreenContext,cnv=M.offScreenCanvas,camera=M.camera;ctx.save();ctx.clearRect(0,
0,cnv.width,cnv.height);renderizable.onRender(ctx,cnv,camera.x,camera.y);var imgData=ctx.getImageData(this.x,this.y,1,1);if(!imgData.data[3])return false;if(imgData.data[0])return true;if(imgData.data[1])return true;if(imgData.data[2])return true;return false},Touch.prototype.isOverPolygon=function(renderizable){var camera=M.camera,x=this.x+camera.x,y=this.y+camera.y;if(renderizable._rotation){this._x=x;this._y=y;return M.collisions.Polygon.haveCollided(renderizable,this)}else{if(renderizable.getBottom()<
y)return false;if(renderizable.getTop()>y)return false;if(renderizable.getRight()<x)return false;if(renderizable.getLeft()>x)return false;return true}};Touch.prototype.bind=function(){document.addEventListener("touchstart",touchStartHelper,false);document.addEventListener("touchend",touchEndHelper,false);document.addEventListener("touchmove",touchMoveHelper,false);M.setTouch(this)};Touch.prototype.unbind=function(){document.removeEventListener("touchstart",touchStartHelper);document.removeEventListener("touchend",
touchEndHelper);document.removeEventListener("touchmove",touchMoveHelper);M.setTouch(null)};instance=new Touch;instance.bind()})(window.Match);(function(namespace){function Color(){}Color.prototype.rgb=function(r,g,b){return"rgb("+[r,g,b].join(",")+")"};Color.prototype.rgba=function(r,g,b,a){return"rgba("+[r,g,b,a].join(",")+")"};Color.prototype.rgbToHex=function(r,g,b){return"#"+this.componentToHex(r)+this.componentToHex(g)+this.componentToHex(b)};Color.prototype.componentToHex=function(c){var hex=c.toString(16);return hex.length==1?"0"+hex:hex};Color.prototype.hexToRgb=function(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
return this.rgb(parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16))};Color.prototype.alpha=function(){return this.rgba(0,0,0,0)};Color.prototype.random=function(){var math=window.Math;return this.rgb(math.round(math.random()*255),math.round(math.random()*255),math.round(math.random()*255))};Color.prototype.rgbStringToObject=function(rgbString){var obj=new Object;if(rgbString){var regexResult=rgbString.match(/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/);if(regexResult){obj.r=
parseInt(regexResult[1]);obj.g=parseInt(regexResult[2]);obj.b=parseInt(regexResult[3])}}return obj};namespace.color=new Color})(window.Match);(function(M){function Random(){this.math=window.Math}Random.prototype.integer=function(from,to){return this.math.floor(this.math.random()*(to-from+1))+from};Random.prototype.decimal=function(from,to){return this.math.random()*(to-from)+from};Random.prototype.bool=function(){return this.math.random()<0.5};Random.prototype.sign=function(){return this.bool()?1:-1};Random.prototype.booleanFromChance=function(trueChancePercentage){return this.integer(0,100)<=trueChancePercentage};Random.prototype.color=
function(){return M.color.random()};Random.prototype.area=function(minX,minY,maxX,maxY){return{x:M.random.integer(minX,maxX),y:M.random.integer(minY,maxY)}};M.random=new Random})(window.Match);(function(namespace){if(!namespace.postProcess)namespace.postProcess={};function NoPostProcess(){}NoPostProcess.prototype.run=function(context){return context.canvas};namespace.postProcess.NoPostProcess=NoPostProcess})(window.M);
(function(namespace){if(!namespace.postProcess)namespace.postProcess={};function GrayScale(){}GrayScale.prototype.run=function(context){var imageData=context.getImageData(0,0,context.canvas.width,context.canvas.height),d=imageData.data,l=d.length,i,r,g,b,v;for(i=0;i<l;i+=4){r=d[i];g=d[i+1];b=d[i+2];v=0.2126*r+0.7152*g+0.0722*b;d[i]=d[i+1]=d[i+2]=v}context.putImageData(imageData,0,0);return context.canvas};namespace.postProcess.GrayScale=GrayScale})(window.M);
(function(namespace){if(!namespace.postProcess)namespace.postProcess={};function Brightness(value){if(value==undefined)throw new Error("Brightness has no constructor that takes no arguments. You must specify the brightness value");this.value=value}Brightness.prototype.run=function(context){var imageData=context.getImageData(0,0,context.canvas.width,context.canvas.height),d=imageData.data;for(var i=0;i<d.length;i+=4){d[i]+=this.value;d[i+1]+=this.value;d[i+2]+=this.value}context.putImageData(imageData,
0,0);return context.canvas};namespace.postProcess.Brightness=Brightness})(window.M);
(function(namespace){if(!namespace.postProcess)namespace.postProcess={};function Convolute(matrix,opaque){this.matrix=matrix;this.opaque=opaque}Convolute.prototype.setSharpen=function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]};Convolute.prototype.setBlur=function(){this.matrix=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]};Convolute.prototype.setContour=function(){this.matrix=[1,1,1,1,0.7,-1,-1,-1,-1]};Convolute.prototype.run=function(context){if(!this.matrix)return;var side=Math.round(Math.sqrt(this.matrix.length));
var halfSide=Math.floor(side/2);var imgData=context.getImageData(0,0,context.canvas.width,context.canvas.height);var src=imgData.data;var sw=imgData.width;var sh=imgData.height;var w=sw;var h=sh;var imageData=document.createElement("canvas").getContext("2d");imageData.canvas.width=imgData.width;imageData.canvas.height=imgData.height;var data=imageData.getImageData(0,0,imgData.width,imgData.height);var dst=data.data;var alphaFac=this.opaque?1:0;for(var y=0;y<h;y++)for(var x=0;x<w;x++){var sy=y;var sx=
x;var dstOff=(y*w+x)*4;var r=0,g=0,b=0,a=0;for(var cy=0;cy<side;cy++)for(var cx=0;cx<side;cx++){var scy=sy+cy-halfSide;var scx=sx+cx-halfSide;if(scy>=0&&scy<sh&&scx>=0&&scx<sw){var srcOff=(scy*sw+scx)*4;var wt=this.matrix[cy*side+cx];r+=src[srcOff]*wt;g+=src[srcOff+1]*wt;b+=src[srcOff+2]*wt;a+=src[srcOff+3]*wt}}dst[dstOff]=r;dst[dstOff+1]=g;dst[dstOff+2]=b;dst[dstOff+3]=a+alphaFac*(255-a)}context.putImageData(data,0,0);return context.canvas};namespace.postProcess.Convolute=Convolute})(window.M);(function(M){function GameLayer(name,zIndex){this.postProcessing=new M.postProcess.NoPostProcess;this.buffer=document.createElement("canvas").getContext("2d");this.onRenderList=[];this.needsRedraw=true;this.needsSorting=false;this.rotation=null;this.scale=null;this.operation=null;this._alpha;this.parrallaxFactor={x:1,y:1};this._onLoopAnimations=[];this.name=name||"layer"+M._gameLayers.length;this._zIndex=zIndex||0;this.result=this.buffer.canvas;if(M.frontBuffer)this.setSize(M.frontBuffer.canvas.width,
M.frontBuffer.canvas.height)}GameLayer.prototype._loopThroughAnimations=function(){var i=0,l=this._onLoopAnimations.length;for(;i<l;i++)if(!this._onLoopAnimations[i].onLoop())this._onLoopAnimations.splice(i,1)};GameLayer.prototype.setAlpha=function(value){this._alpha=value};GameLayer.prototype.getAlpha=function(){return this._alpha};GameLayer.prototype.fadeIn=function(seconds,onFinished){this._onLoopAnimations.push(new M.effects.visual.FadeIn(this,seconds,onFinished));return this};GameLayer.prototype.fadeOut=
function(seconds,onFinished){this._onLoopAnimations.push(new M.effects.visual.FadeOut(this,seconds,onFinished));return this};GameLayer.prototype.continousFade=function(seconds,fadeOutFirst,min,max){this._onLoopAnimations.push(new M.effects.visual.ContinousFade(this,seconds,fadeOutFirst,min,max));return this};GameLayer.prototype.setBufferSize=function(canvas){if(!(canvas instanceof HTMLCanvasElement))throw new Error("setBufferSize is expecting an HTMLCanvasElement as argument");this.buffer.canvas.width=
arguments[0].width;this.buffer.canvas.height=arguments[0].height};GameLayer.prototype.setAntialiasing=function(value){this.buffer.mozImageSmoothingEnabled=value;this.buffer.webkitImageSmoothingEnabled=value;this.buffer.mozImageSmoothingEnabled=value;this.buffer.webkitImageSmoothingEnabled=value};GameLayer.prototype.getWidth=function(){return this.buffer.canvas.width};GameLayer.prototype.getHeight=function(){return this.buffer.canvas.height};GameLayer.prototype.setWidth=function(value){this.buffer.canvas.width=
value};GameLayer.prototype.setHeight=function(value){this.buffer.canvas.height=value};GameLayer.prototype.setSize=function(width,height){this.setWidth(width);this.setHeight(height)};GameLayer.prototype.getCenter=function(){return new M.math2d.Vector2d(this.buffer.canvas.width/2,this.buffer.canvas.height/2)};GameLayer.prototype.clearUsingDefault=function(buffer,canvas){buffer.clearRect(0,0,canvas.width,canvas.height)};GameLayer.prototype.clearUsingFillColor=function(buffer,canvas){buffer.fillStyle=
this.clearColor;buffer.fillRect(0,0,canvas.width,canvas.height)};GameLayer.prototype.clearUsingImage=function(buffer,canvas){buffer.drawImage(this.clearImage,0,0)};GameLayer.prototype.clear=GameLayer.prototype.clearUsingDefault;GameLayer.prototype.onLoop=function(p){if(this.needsRedraw){var cameraX0=p.camera._x*this.parrallaxFactor.x,cameraY0=p.camera._y*this.parrallaxFactor.y,cameraX1=cameraX0+p.camera.viewportWidth,cameraY1=cameraY0+p.camera.viewportHeight,buffer=this.buffer,canvas=buffer.canvas,
time;this.clear(buffer,canvas);this.renderGameObjects(this.onRenderList,buffer,canvas,cameraX0,cameraY0,cameraX1,cameraY1);this.needsRedraw=false;this.result=this.postProcessing.run(buffer)}if(this.needsSorting){this.sort();this.needsSorting=false}this._loopThroughAnimations();return this.result};GameLayer.prototype.renderGameObjects=function(nodes,buffer,canvas,cameraX0,cameraY0,cameraX1,cameraY1){for(var i=0;i<nodes.length;i++){var node=nodes[i];if(node.isVisible(cameraX0,cameraY0,cameraX1,cameraY1)){node.onRender(buffer,
canvas,cameraX0,cameraY0,cameraX1,cameraY1);if(node.children)this.renderGameObjects(node.children,buffer,canvas,cameraX0,cameraY0,cameraX1,cameraY1)}}};GameLayer.prototype.addToGame=function(){M.pushGameLayer(this)};GameLayer.prototype.renderizableChanged=function(){this.needsRedraw=true};GameLayer.prototype.zIndexChanged=function(){this.needsSorting=true};GameLayer.prototype.setZIndex=function(value){this._zIndex=value;M.sortLayers()};GameLayer.prototype.getZIndex=function(){return this._zIndex};
GameLayer.prototype.push=function(object,key,zIndex){if(!object)throw new Error("Cannot push null Object to game layer");if(!object.onRender)throw new Error(M.getObjectName(object)+" must implement onRender method");if(!object.isVisible){console.warn(M.getObjectName(object)+" does not implement isVisible method. A default method will be appended. Rendering objects outside of game area is inefficient and innecessary, please implement isVisible for better performance");object.isVisible=function(){return true}}if(!object.setZIndex)console.warn(M.getObjectName(object)+
" does not implement setZIndex method");if(!object.getZIndex)console.warn(M.getObjectName(object)+" does not implement getZIndex method");if(!object._zIndex)object._zIndex=this.onRenderList.length;if(!object.notifyChange){console.warn(M.getObjectName(object)+" does not implement notifyChange method. This method must inform the onwerLayer of any change in a value that would require a redraw action. ie: function() { this.ownerLayer.renderizableChanged(); } ownerLayer is added when the object is pushed into a layer by default");
object.notifyChange=function(){if(this.ownerLayer)this.ownerLayer.renderizableChanged()}}if(!object.notifyZIndexChange){console.warn(M.getObjectName(object)+" does not implement notifyZIndexChange method. This method must inform the onwerLayer of any change in the zIndex so that the layer reorders its children. ie: function() { this.ownerLayer.zIndexChanged(); } ownerLayer is added when the object is pushed into a layer by default");object.notifyZIndexChange=function(){if(this.ownerLayer)this.ownerLayer.zIndexChange()}}object.ownerLayer=
this;if(object.onLoad)object.onLoad();this.needsSorting=true;this.onRenderList.push(object);if(object.onLoop)M.pushGameObject(object);var camera=M.camera,cameraX0=camera.x*this.parrallaxFactor.x,cameraY0=camera.y*this.parrallaxFactor.y,cameraX1=cameraX0+camera.viewportWidth,cameraY1=cameraY0+camera.viewportHeight;if(!this.needsRedraw)this.needsRedraw=object.isVisible(cameraX0,cameraY0,cameraX1,cameraY1)};GameLayer.prototype.sort=function(){this.onRenderList.sort(this._sortFunction)};GameLayer.prototype._sortFunction=
function(a,b){return a._zIndex-b._zIndex};GameLayer.prototype.getFirst=function(){return this.getIndex(0)};GameLayer.prototype.getIndex=function(index){try{return this.onRenderList[index]}catch(e){return null}};GameLayer.prototype.getAsBase64Image=function(){return this.buffer.canvas.toDataURL()};GameLayer.prototype.getAsImage=function(){var img=new Image;img.src=this.getAsBase64Image();return img};GameLayer.prototype.get=function(key){if(this.cache&&this.cache.key==key)return this.cache;var i=this.onRenderList.length,
current;while(i--){current=this.onRenderList[i];if(key==current.key){this.cache=current;return current}}return null};GameLayer.prototype.getLast=function(){return this.getIndex(this.onRenderList.length-1)};GameLayer.prototype.isOnRenderList=function(object){return this.onRenderList.indexOf(object)!=-1};GameLayer.prototype.remove=function(object){if(!object)return;if(typeof object=="string")this.remove(this.get(object));else{var i=this.onRenderList.indexOf(object);if(i>-1)this.onRenderList.splice(i,
1)}if(object.onLoop)M.removeGameObject(object);object.ownerLayer=null;this.needsRedraw=true};GameLayer.prototype.removeAll=function(){this.onRenderList=[]};GameLayer.prototype.setBackground=function(background){if(!background==""&&typeof background=="string")if(M.sprites[background]){this.clearImage=M.sprites[background]._image;this.clear=this.clearUsingImage}else{this.clearColor=background;this.clear=this.clearUsingFillColor}else this.clear=this.clearUsingDefault};GameLayer.prototype.getBackground=
function(){return this.buffer.canvas.getPropertyValue("background")};M.GameLayer=M.Layer=GameLayer})(window.Match);(function(namespace,M){function Particle(origin,destination,width,height,fillStyle){this.angle=0;this._rotationSpeed=0.1;this.speed=0.05;this.vanishRate=0.0050;this.alpha=1;this.setPath(origin,destination);this.setWidth(width);this.setHeight(height)}Particle.prototype.setWidth=function(width){this._halfWidth=width/2};Particle.prototype.setHeight=function(height){this._halfHeight=height/2};Particle.prototype.setPath=function(origin,destination){this._x=origin.x;this._y=origin.y;this.direction=M.math2d.getVector2d(origin,
destination)};Particle.prototype.onLoop=function(){this.alpha-=this.vanishRate;this.angle+=this._rotationSpeed;this._x+=this.speed*this.direction.x;this._y+=this.speed*this.direction.y};Particle.prototype.onRender=function(context,canvas,cameraX,cameraY){if(this.alpha>=0){context.save();context.globalAlpha=this.alpha;context.translate(this._x-cameraX,this._y-cameraY);context.rotate(this.angle);context.fillStyle=this.fillStyle;context.fillRect(-this._halfWidth,-this._halfHeight,this._halfWidth,this._halfHeight);
context.restore()}};Particle.prototype.setZIndex=function(value){this._zIndex=value};Particle.prototype.isVisible=function(cameraX0,cameraY0,cameraX1,cameraY1){if(this.alpha<=0)return false;var camera=M.camera;if(this._y+this._halfHeight<cameraY0)return false;if(this._y-this._halfHeight>cameraY1)return false;if(this._x+this._halfWidth<cameraX0)return false;if(this._x-this._halfWidth>cameraX1)return false;return true};function createLinearParticles(amount,origin,direction,minWidth,minHeight,maxWidth,
maxHeight,minSpeed,maxSpeed,color,vanishRate,maxVanishRate){var lib=M.Math2d;var particles=[];for(var i=0;i<amount;i++){var particle=new Particle(origin,{x:origin.x+direction.x*5,y:origin.y+direction.y*5});particle.setWidth(lib.randomInt(minWidth,maxWidth));particle.setHeight(lib.randomInt(minHeight,maxHeight));if(!color)switch(lib.randomInt(0,2)){case 0:particle.color="rgb(255, 128, 0)";break;case 1:particle.color="rgb(255, 180, 0)";break;case 2:particle.color="rgb(255, 80, 0)"}else particle.color=
color[lib.randomInt(0,color.length-1)];if(maxVanishRate)particle.vanishRate=lib.randomFloat(vanishRate,maxVanishRate);else if(vanishRate)particle.vanishRate=vanishRate;particle.speed=lib.randomFloat(minSpeed,maxSpeed);particles.push(particle)}return particles}function RadialParticleEmitter(amount,color,minWidth,minHeight,maxWidth,maxHeight,minSpeed,maxSpeed,vanishRate){if(!this.minAngle)this.minAngle=0;if(!this.maxAngle)this.maxAngle=6.28;this.amount=amount;this.color=color;this.minWidth=minWidth||
1;this.minHeight=minHeight||1;this.maxWidth=maxWidth||3;this.maxHeight=maxHeight||3;this.minSpeed=minSpeed||0.01;this.maxSpeed=maxSpeed||0.1;this.vanishRate=vanishRate}RadialParticleEmitter.prototype.onLoop=function(){if(!this.children)return;var i=0,l=this.children.length,notVisible=0,currentParticle;for(;i<l;i++){currentParticle=this.children[i];if(currentParticle.alpha<=0)notVisible++;else currentParticle.onLoop()}if(notVisible==l)this.children=null;else;};RadialParticleEmitter.prototype.onRender=
function(){};RadialParticleEmitter.prototype.isVisible=function(){return true};RadialParticleEmitter.prototype.setZIndex=function(value){this._zIndex=value};RadialParticleEmitter.prototype.create=function(x,y){var rnd=M.random;this.children=new Array;for(var i=0;i<this.amount;i++){var t=rnd.decimal(this.minAngle,this.maxAngle),r=50,origin=new Object,destination=new Object,particle;origin.x=x;origin.y=y;destination.x=x+r*Math.cos(t);destination.y=y+r*Math.sin(t);particle=new Particle(origin,destination);
particle.setWidth(rnd.integer(this.minWidth,this.maxWidth));particle.setHeight(rnd.integer(this.minHeight,this.maxHeight));if(!this.color)switch(rnd.integer(0,2)){case 0:particle.fillStyle="rgb(255, 128, 0)";break;case 1:particle.fillStyle="rgb(255, 180, 0)";break;default:particle.fillStyle="rgb(255, 80, 0)"}else particle.fillStyle=this.color[rnd.integer(0,color.length-1)];if(this.vanishRate)particle.vanishRate=this.vanishRate;particle.speed=rnd.decimal(this.minSpeed,this.maxSpeed);this.children.push(particle)}};
function LinearParticleEmitter(amount,color,minWidth,minHeight,maxWidth,maxHeight,minSpeed,maxSpeed,vanishRate){this.origin=origin;this.direction=direction;this.particles=createLinearParticles(particleAmount,origin,direction,minWidth||4,minHeight||4,maxWidth||8,maxHeight||8,minSpeed||0.01,maxSpeed||0.4,color,vanishRate||M.Math2d.randomFloat(0.01,0.03));this.visibleParticles=this.particles.length}LinearParticleEmitter.prototype.create=function(from,to){};LinearParticleEmitter.prototype.onLoop=function(p){if(this.visible){var currentParticle;
for(var i=0;i<this.particles.length;i++){currentParticle=this.particles[i];currentParticle.onLoop(p);if(!currentParticle.isVisible())if(this.loop){currentParticle.setPath(this.origin,{x:this.origin.x+this.direction.x*5,y:this.origin.y+this.direction.y*5});currentParticle.rotation=0;currentParticle.alpha=1;currentParticle.angle=0;currentParticle.vanishRate=M.Math2d.randomFloat(0.05,0.2);currentParticle.speed=M.Math2d.randomFloat(0.0050,0.5)}else this.visibleParticles--}if(this.visibleParticles<1)M.remove(this)}};
function Tint(properties){this.operation="source-atop";this.startTime=0;M.applyProperties(this,properties,["fillStyle"])}Tint.prototype.render=function(context,width,height){if(this.isVisible()){context.globalCompositeOperation=this.operation;context.fillStyle=this.fillStyle;context.fillRect(0,0,width,height)}};Tint.prototype.show=function(){this.startTime=M.getTimeInMillis()};Tint.prototype.isVisible=function(){return this.showAlways||M.getTimeInMillis()-this.startTime<this.duration};function FadeIn(object,
seconds,onFinished){if(seconds==undefined)seconds=1;this.rate=1/(seconds*M.getAverageFps());this.object=object;this.onFinished=onFinished}FadeIn.prototype.initialize=function(){this.object.setAlpha(0);this.onLoop=this.run;return true};FadeIn.prototype.run=function(){var newAlpha=this.object.getAlpha()+this.rate;if(newAlpha<1)this.object.setAlpha(newAlpha);else{this.object.setAlpha(1);if(this.onFinished)this.onFinished.apply(this.object);return false}return true};FadeIn.prototype.onLoop=FadeIn.prototype.initialize;
function FadeOut(object,seconds,onFinished){if(seconds==undefined)seconds=1;this.rate=1/(seconds*M.getAverageFps());this.object=object;this.onFinished=onFinished}FadeOut.prototype.initialize=function(){this.object.setAlpha(1);this.onLoop=this.run;return true};FadeOut.prototype.run=function(){var newAlpha=this.object.getAlpha()-this.rate;if(newAlpha>0)this.object.setAlpha(newAlpha);else{this.object.setAlpha(0);if(this.onFinished)this.onFinished.apply(this.object);return false}return true};FadeOut.prototype.onLoop=
FadeOut.prototype.initialize;function Wait(object,seconds,onFinished){if(seconds==undefined)seconds=1;this.seconds=seconds;this.object=object;this.timer=0;this.onFinished=onFinished}Wait.prototype.initialize=function(p){this.timer=new M.TimeCounter(this.seconds*1E3);this.onLoop=this.run};Wait.prototype.run=function(){if(this.timer.elapsed()){if(this.onFinished)this.onFinished.apply(this.object);return false}return true};Wait.prototype.onLoop=Wait.prototype.initialize;function ContinousFade(object,
seconds,fadeOut,min,max){if(seconds==undefined)seconds=1;this.rate=1/(seconds*M.getAverageFps());this.object=object;this.min=min||0;this.max=max||1;object.setAlpha(1);this.onFinished=this.changeFade;if(fadeOut)this.onLoop=this.fadeOut;else this.onLoop=this.fadeIn}ContinousFade.prototype.fadeIn=function(p){var newAlpha=this.object._alpha+this.rate;if(newAlpha<this.max)this.object.setAlpha(newAlpha);else{this.object.setAlpha(this.max);this.onLoop=this.fadeOut}return true};ContinousFade.prototype.fadeOut=
function(){var newAlpha=this.object._alpha-this.rate;if(newAlpha>this.min)this.object.setAlpha(newAlpha);else{this.object.setAlpha(this.min);this.onLoop=this.fadeIn}return true};function Move(object,x,y,seconds,onFinished){this.object=object;this._x=x;this._y=y;if(seconds==undefined)seconds=1;this.onFinished=onFinished;var lib=M.Math2d,frames=seconds*M.getAverageFps(),coorsFrom=new lib.Vector2d(object._x,object._y),coordsTo=new lib.Vector2d(x,y);this.speed=lib.getDistance(coorsFrom,coordsTo)/frames;
this.direction=M.Math2d.getNormalized(M.Math2d.getVector2d(coorsFrom,coordsTo))}Move.prototype.onLoop=function(p){var moveX=Math.abs(this._x-this.object._x)>this.speed,moveY=Math.abs(this._y-this.object._y)>this.speed;if(moveX)this.object.offsetX(this.direction.x*this.speed);if(moveY)this.object.offsetY(this.direction.y*this.speed);if(!moveX&&!moveY){this.object.setLocation(this._x,this._y);if(this.onFinished)this.onFinished.apply(this.object);return false}return true};function ScaleUp(object,x,y,
seconds,onFinished){var frames=seconds*M.getAverageFps();if(!object._scale)object._scale={x:1,y:1};this.speedX=Math.abs(object._scale.x-x)/frames;this.speedY=Math.abs(object._scale.y-y)/frames;this.object=object;this._x=x;this._y=y;this.onFinished=onFinished}ScaleUp.prototype.onLoop=function(p){if(this.object._scale.x<this._x)this.object._scale.x+=this.speedX;if(this.object._scale.y<this._y)this.object._scale.y+=this.speedY;if(this.object._scale.x>=this._x&&this.object._scale.y>=this._y){if(this.onFinished)this.onFinished.apply(this.object);
return false}return true};function ScaleDown(object,x,y,seconds,onFinished){var frames=seconds*M.getAverageFps();if(!object._scale)object._scale={x:1,y:1};this.speedX=Math.abs(object._scale.x-x)/frames;this.speedY=Math.abs(object._scale.y-y)/frames;this.object=object;this._x=x;this._y=y;this.onFinished=onFinished}ScaleDown.prototype.onLoop=function(p){if(this.object._scale.x>this._x)this.object._scale.x-=this.speedX;if(this.object._scale.y>this._y)this.object._scale.y-=this.speedY;if(this.object._scale.x<=
this._x&&this.object._scale.y<=this._y){if(this.onFinished)this.onFinished.apply(this.object);return false}return true};function Twinkle(object,times,duration,onFinished){this.object=object;if(times==undefined)this.times=6;else this.times=times*2;if(duration==undefined)this.duration=250;else this.duration=duration;this.lastTime=0;this.onFinished=onFinished}Twinkle.prototype.onLoop=function(p){if(M.getTimeInMillis()-this.lastTime>=this.duration){if(this.times--)if(this.object._alpha==1)this.object.setAlpha(0);
else this.object.setAlpha(1);else{this.object.setAlpha(undefined);if(this.onFinished)this.onFinished.apply(this.object);return false}this.lastTime=M.getTimeInMillis()}return true};function Rotate(object,angle,seconds,onFinished){if(!seconds)seconds=1;this.frames=seconds*M.getAverageFps();if(!object._rotation)object._rotation=0;this.object=object;this.angle=angle;this.onFinished=onFinished;this._rotation=(this.angle-object._rotation)/this.frames}Rotate.prototype.onLoop=function(p){if(this.frames--)this.object.offsetRotation(this._rotation);
else{if(this.onFinished)this.onFinished.apply(this.object);return false}return true};function fadeIn(object,seconds,onFinished){return(new Animation(new FadeIn(object,seconds,onFinished))).play()}function fadeOut(object,seconds,onFinished){return(new Animation(new FadeOut(object,seconds,onFinished))).play()}function continousFade(object,seconds,fadeOutFirst){return(new Animation(new ContinousFade(object,seconds,fadeOutFirst))).play()}function move(object,x,y,seconds,onFinished){return(new Animation(new Move(object,
x,y,seconds,onFinished))).play()}function scaleUp(object,x,y,seconds,onFinished){return(new Animation(new ScaleUp(object,x,y,seconds,onFinished))).play()}function scaleDown(object,x,y,seconds,onFinished){return(new Animation(new ScaleDown(object,x,y,seconds,onFinished))).play()}function twinkle(object,times,duration,onFinished){return(new Animation(new Twinkle(object,times,duration,onFinished))).play()}function rotate(object,angle,seconds,onFinished){return(new Animation(new Rotate(object,angle,seconds,
onFinished))).play()}function shakeCanvas(duration){if(!M.canvas.shaking){M.canvas.shaking=true;M.canvas.style.position="relative";M.push({startTime:M.getGameTime(),duration:duration||1,onLoop:function(p){if(M.getGameTime()-this.startTime<this.duration){p.canvas.style.left=p.M.randomSign()+"px";p.canvas.style.top=p.M.randomSign()+"px"}else{p.canvas.style.left="0px";p.canvas.style.top="0px";p.M.remove(this);p.canvas.shaking=false}}},"shake")}}namespace.visual={Particle:Particle,LinearParticleEmitter:LinearParticleEmitter,
RadialParticleEmitter:RadialParticleEmitter,Tint:Tint,Move:Move,FadeIn:FadeIn,FadeOut:FadeOut,ContinousFade:ContinousFade,ScaleUp:ScaleUp,ScaleDown:ScaleDown,Rotate:Rotate,Twinkle:Twinkle,Wait:Wait}})(M.effects||(M.effects={}),M);(function(M){function Timer(interval,callback,owner){this.interval=interval;this._lastTime=M.getTime();if(owner){this.owner=owner;this.callback=callback}else this.tick=callback;this.enabled=true}Timer.prototype.onLoop=function(p){if(this.enabled&&M.elapsedTimeFrom(this._lastTime,this.interval)){this.tick();this._lastTime=M.getTime()}};Timer.prototype.tick=function(){this.callback.call(this.owner)};M.Timer=Timer})(window.Match);(function(M){function TimeCounter(time){this._lastTime=0;this.time=time}TimeCounter.prototype.initialize=function(){this._lastTime=M.getTime();this.elapsed=this._run;return false};TimeCounter.prototype.setInterval=function(value){this.elapsed=this.initialize;this.time=value;return false};TimeCounter.prototype._run=function(){var currentTime=M.getTime();if(currentTime-this.time>=this._lastTime){this._lastTime=currentTime;return true}return false};TimeCounter.prototype.reset=function(){this.elapsed=
this.initialize};TimeCounter.prototype.elapsed=TimeCounter.prototype.initialize;M.TimeCounter=TimeCounter})(window.Match);(function(M,EventListener){function SpriteManager(){this.path="";this.toLoad=0;this.total=0;this.onImageLoaded=new EventListener;this.onAllImagesLoaded=new EventListener;this.onImageError=new EventListener;this.assets={}}function onError(){M.sprites._imageError(this)}function onLoad(){M.sprites._imageLoaded(this)}SpriteManager.prototype._imageLoaded=function(image){this.toLoad--;if(!image.frames)image.frames=[{x:0,y:0,width:image.width,height:image.height,halfWidth:image.width/2,halfHeight:image.height/
2}];else if(image.frames instanceof Array)for(var i in image.frames){image.frames[i].halfWidth=image.frames[i].width/2;image.frames[i].halfHeight=image.frames[i].height/2}else{var frames=new Array,width=image.frames.width,height=image.frames.height,padding=image.frames.padding||0,columns=Math.floor(image.width/(width+padding)),lines=Math.floor(image.height/(height+padding)),column,line;for(line=0;line<lines;line++)for(column=0;column<columns;column++){var x=(padding+width)*column+padding,y=(padding+
height)*line+padding;frames.push({x:x,y:y,width:width,height:height,halfWidth:width/2,halfHeight:height/2})}image.frames=frames}this.onImageLoaded.raise({image:image,name:image.getAttribute("data-name"),remaining:this.toLoad,total:this.total});if(this.toLoad<=0)this.onAllImagesLoaded.raise()};SpriteManager.prototype._imageError=function(image){this.toLoad--;this.onImageError.raise(image);console.error("Could not load",image.src)};SpriteManager.prototype.load=function(map,onFinished,onProgress){var current,
img,i;if(onFinished)this.onAllImagesLoaded.addEventListener(onFinished);if(onProgress)this.onImageLoaded.addEventListener(onProgress);if(map instanceof Array){var jsonMap={},loaded=0,self=this,onJsonReceived=function(response){var json=JSON.parse(response);jsonMap[json.name]=json;loaded++;if(loaded>=map.length)self.load(jsonMap)};for(i=0;i<map.length;i++)M.Ajax.post(map[i],onJsonReceived)}else{var alreadyLoaded=0,count=0;for(i in map){count++;if(!this.assets[i]){current=map[i],img=new Image;img.setAttribute("data-name",
i);img.onload=onLoad;img.onerror=onError;this.total=++this.toLoad;if(typeof current=="string")img.src=this.path+current;else{img.src=this.path+current.source;img.frames=current.frames;img.animations=current.animations}this.assets[i]=img}else alreadyLoaded++}if(alreadyLoaded==count)this.onAllImagesLoaded.raise()}};SpriteManager.prototype.remove=function(id){if(this.assets[id]){delete this.assets[id];if(this.total-1>=0)this.total--;if(this.toLoad-1>=0)this.toLoad--}};SpriteManager.prototype.removeAll=
function(){this.assets={};this.total=0;this.toLoad=0};SpriteManager.prototype.removeAllEventListeners=function(){this.onImageLoaded=new EventListener;this.onAllImagesLoaded=new EventListener;this.onImageError=new EventListener};M.SpriteManager=new SpriteManager;M.sprites=M.SpriteManager})(M,EventListener);(function(M,EventListener){function Sound(name,url){this.audioBuffer=[];this.src=url;this.name=name;this.increaseBuffer()}Sound.prototype.MAX_BUFFER=3;Sound.prototype.setReady=function(){this.canPlay=this.checkOk;if(this.audioBuffer.length==1)M.sounds.onSoundLoaded.raise({sound:this,remaining:M.sounds.toLoad,total:M.sounds.total})};Sound.prototype.setNotReady=function(){this.canPlay=this.checkOk;M.sounds.onSoundError.raise({sound:this,remaining:M.sounds.toLoad,total:M.sounds.total})};Sound.prototype.play=
function(loop){if(!this.canPlay())return;var i=0,current;while(i<this.audioBuffer.length){current=this.audioBuffer[i];if(current.ended||current.currentTime==0){current.loop=loop;current.play();return}i++}current=this.audioBuffer[0];current.pause();current.currentTime=0;current.loop=loop;current.play();if(this.audioBuffer.length<this.MAX_BUFFER)this.increaseBuffer()};Sound.prototype.stop=function(){if(!this.canPlay())return;this.each(function(obj){if(obj.duration>0){obj.pause();obj.currentTime=0}})};
Sound.prototype.pause=function(){if(!this.canPlay())return;if(this.onNextPauseResume){this.play();this.onNextPauseResume=false}else{this.onNextPauseResume=this.isPlaying();this.each(function(obj){obj.pause()})}};Sound.prototype.checkFail=function(){return false};Sound.prototype.checkOk=function(){return true};Sound.prototype.canPlay=function(){this.increaseBuffer();return false};Sound.prototype.setPlaybackRate=function(rate){this.each(function(obj){obj.playbackRate=rate})};Sound.prototype.resetPlaybackRate=
function(){this.each(function(obj){obj.playbackRate=1})};Sound.prototype.getPlaybackRate=function(){return this.audioBuffer[0].playbackRate};Sound.prototype.isPaused=function(){var i=0;l=this.audioBuffer.length;for(;i<l;i++)if(this.audioBuffer[i].paused)return true;return false};Sound.prototype.setVolume=function(volume){this.each(function(obj){obj.volume=volume})};Sound.prototype.isPlaying=function(){var i=0;l=this.audioBuffer.length;for(;i<l;i++)if(!this.audioBuffer[i].paused)return true;return false};
Sound.prototype.each=function(func){var i=this.audioBuffer.length;while(i--)func(this.audioBuffer[i])};Sound.prototype.increaseBuffer=function(){var sound=new Audio(this.src),first=this.audioBuffer[0];sound.addEventListener("loadeddata",onloadeddata);sound.addEventListener("error",onerror);sound.name=this.name;if(first){sound.muted=first.muted;sound.volume=first.volume}this.audioBuffer.push(sound)};Sound.prototype.isMuted=function(){if(this.audioBuffer.length>0)return this.audioBuffer[0].muted;return false};
Sound.prototype.toggle=function(){if(this.isMuted())this.unmute();else this.mute()};Sound.prototype.mute=function(){this.each(function(obj){obj.muted=true})};Sound.prototype.unmute=function(){this.each(function(obj){obj.muted=false})};Sound.prototype.setLoop=function(value){this.audioBuffer[0].loop=value};var fakeFunc=function(){};fakeSound={name:""};for(var i in Sound.prototype)if(typeof Sound.prototype[i]=="function")fakeSound[i]=fakeFunc;function onloadeddata(){M.sounds.assets[this.name].setReady();
M.sounds.toLoad--;if(M.sounds.toLoad<=0)M.sounds.onAllSoundsLoaded.raise()}function onerror(){console.warn("Unable to load "+this.src);M.sounds.error=true;M.sounds.assets[this.name].setNotReady();M.sounds.toLoad--;if(M.sounds.toLoad<=0)M.sounds.onAllSoundsLoaded.raise()}function SoundManager(){this.path="";this.toLoad=0;this.total=0;this.onSoundLoaded=new EventListener;this.onAllSoundsLoaded=new EventListener;this.onSoundError=new EventListener;this.error=false;this.assets={}}SoundManager.prototype.load=
function(map,onFinished,onProgress){if(onProgress)this.onSoundLoaded.addEventListener(onProgress);if(onFinished)this.onAllSoundsLoaded.addEventListener(onFinished);if(map instanceof Array){var jsonMap={},loaded=0,self=this,onJsonReceived=function(response){loaded++;var json=JSON.parse(response);jsonMap[json.name]=json.source;if(loaded>=map.length)self.load(jsonMap)};for(var i=0;i<map.length;i++)M.Ajax.post(map[i],onJsonReceived)}else for(var i in map)this.loadOne(i,map[i])};SoundManager.prototype.loadOne=
function(name,url){this.total=++this.toLoad;if(M.browser.supportedAudioFormat==undefined){this.assets[name]=fakeSound;fakeSound.name=name;this.onSoundLoaded.raise({sound:fakeSound,remaining:M.sounds.toLoad--,total:M.sounds.total});if(this.toLoad<=0)this.onAllSoundsLoaded.raise()}else if(url.substr(0,4)=="data")this.assets[name]=new Sound(name,url);else{if(url.lastIndexOf(".")==-1)url=url+M.browser.supportedAudioFormat;this.assets[name]=new Sound(name,this.path+url)}this.assets[name].name=name};SoundManager.prototype.pause=
function(){for(var i in this.assets)this.assets[i].pause()};SoundManager.prototype.setVolume=function(value){for(var i in this.assets)this.assets[i].setVolume(value)};SoundManager.prototype.mute=function(){for(var i in this.assets)this.assets[i].mute()};SoundManager.prototype.unmute=function(){for(var i in this.assets)this.assets[i].unmute()};SoundManager.prototype.toggle=function(){for(var i in this.assets)this.assets[i].toggle()};SoundManager.prototype.stop=function(){for(var i in this.assets)this.assets[i].stop()};
SoundManager.prototype.remove=function(id){if(this.assets[id]){delete this.assets[id];if(this.total-1>=0)this.total--;if(this.toLoad-1>=0)this.toLoad--}};SoundManager.prototype.removeAll=function(){this.assets={};this.toLoad=0;this.total=0};M.SoundManager=M.sounds=new SoundManager})(Match,EventListener);(function(M,visual){function Renderizable(properties){this._x=0;this._y=0;this._width=0;this._height=0;this._halfWidth=0;this._halfHeight=0;this._rotation=null;this._scale=null;this._visible=true;this.operation=null;this.behaviours=new M.ArrayList;this.chainedBehaviours=new M.ArrayList;this._currentChainedBehaviour=0;this._onLoopTimers=new M.ArrayList;this._alpha=null;this.onwerLayer=null;this._raisedNotVisible=false;this.set(properties)}Renderizable.prototype.notifyChange=function(){this.ownerLayer&&
this.ownerLayer.renderizableChanged()};Renderizable.prototype.notifyZIndexChange=function(){this.ownerLayer&&this.ownerLayer.zIndexChanged()};Renderizable.prototype._zIndex=0;Renderizable.prototype.onLoop=function(p){this._loopThroughAnimations();this._loopThroughTimers();if(this.onUpdate)this.onUpdate(p)};Renderizable.prototype.set=function(properties){if(!properties)return;var setter="";for(var i in properties){setter="set"+i.charAt(0).toUpperCase()+i.substr(1);if(this[setter])this[setter](properties[i]);
else this[i]=properties[i]}};Renderizable.prototype.setAlpha=function(value){if(value>=0&&value<=1){this._alpha=value;this.notifyChange()}else this._alpha=null};Renderizable.prototype.getAlpha=function(){return this._alpha};Renderizable.prototype._loopThroughAnimations=function(){function doLoop(item,index,list){if(item&&!item.onLoop())list.quickRemove(index)}this.behaviours.each(doLoop);if(this.chainedBehaviours.size){if(!this.chainedBehaviours._list[this._currentChainedBehaviour].onLoop())this._currentChainedBehaviour++;
if(this._currentChainedBehaviour==this.chainedBehaviours.size){this.chainedBehaviours.removeAll();this._currentChainedBehaviour=0}}};Renderizable.prototype.clearAnimations=function(){this.behaviours=new Array};Renderizable.prototype.fadeIn=function(seconds,onFinished){this.behaviours.push(new visual.FadeIn(this,seconds,onFinished));return this};Renderizable.prototype.fadeOut=function(seconds,onFinished){this.behaviours.push(new visual.FadeOut(this,seconds,onFinished));return this};Renderizable.prototype.continousFade=
function(seconds,fadeOutFirst,min,max){this.behaviours.push(new visual.ContinousFade(this,seconds,fadeOutFirst,min,max));return this};Renderizable.prototype.move=function(x,y,seconds,easingX,easingY,loop,onFinished){this.behaviours.push(new visual.Easing(this,x,y,seconds,easingX,easingY,loop,onFinished));return this};Renderizable.prototype.scaleUp=function(x,y,seconds,onFinished){this.behaviours.push(new visual.ScaleUp(this,x,y,seconds,onFinished));return this};Renderizable.prototype.scaleDown=function(x,
y,seconds,onFinished){this.behaviours.push(new visual.ScaleDown(this,x,y,seconds,onFinished));return this};Renderizable.prototype.twinkle=function(timesToTwinkle,durationInMilliseconds,onFinished){this.behaviours.push(new visual.Twinkle(this,timesToTwinkle,durationInMilliseconds,onFinished));return this};Renderizable.prototype.rotate=function(angle,seconds,onFinished){this.behaviours.push(new visual.Rotate(this,angle,seconds,onFinished));return this};Renderizable.prototype.chainWait=function(seconds,
onFinished){this.chainedBehaviours.push(new visual.Wait(this,seconds,onFinished));return this};Renderizable.prototype.chainFadeIn=function(seconds,onFinished){this.chainedBehaviours.push(new visual.FadeIn(this,seconds,onFinished));return this};Renderizable.prototype.chainFadeOut=function(seconds,onFinished){this.chainedBehaviours.push(new visual.FadeOut(this,seconds,onFinished));return this};Renderizable.prototype.chainContinousFade=function(seconds,fadeOutFirst,min,max){this.chainedBehaviours.push(new visual.ContinousFade(this,
seconds,fadeOutFirst,min,max));return this};Renderizable.prototype.chainMove=function(x,y,seconds,easingX,easingY){this.chainedBehaviours.push(new visual.Easing(this,x,y,seconds,easingX,easingY));return this};Renderizable.prototype.chainScaleUp=function(x,y,seconds,onFinished){this.chainedBehaviours.push(new visual.ScaleUp(this,x,y,seconds,onFinished));return this};Renderizable.prototype.chainScaleDown=function(x,y,seconds,onFinished){this.chainedBehaviours.push(new visual.ScaleDown(this,x,y,seconds,
onFinished));return this};Renderizable.prototype.chainTwinkle=function(timesToTwinkle,durationInMilliseconds,onFinished){this.chainedBehaviours.push(new visual.Twinkle(this,timesToTwinkle,durationInMilliseconds,onFinished));return this};Renderizable.prototype.chainRotate=function(angle,seconds,onFinished){this.chainedBehaviours.push(new visual.Rotate(this,angle,seconds,onFinished));return this};Renderizable.prototype._loopThroughTimers=function(){var i=0,l=this._onLoopTimers.length;for(;i<l;i++)this._onLoopTimers[i].onLoop()};
Renderizable.prototype.addTimer=function(timeInMillis,callback){var timer=new M.Timer(timeInMillis,callback,this);this._onLoopTimers.push(timer);return timer};Renderizable.prototype.removeTimer=function(callback){this._onLoopTimers.splice(this._onLoopTimers.indexOf(this._getTimer(callback)),1);return this};Renderizable.prototype._getTimer=function(callback){var i=0,l=this._onLoopTimers.length;for(;i<l;i++)if(this._onLoopTimers[i].callback==callback)return this._onLoopTimers[i]};Renderizable.prototype.setZIndex=
function(value){this._zIndex=value;this.notifyChange();this.notifyZIndexChange()};Renderizable.prototype.getZIndex=function(){return this._zIndex};Renderizable.prototype.setVisible=function(value){this._visible=value;this.notifyChange()};Renderizable.prototype.setWidth=function(value){this._width=value;this._halfWidth=value/2;this.notifyChange()};Renderizable.prototype.setHeight=function(value){this._height=value;this._halfHeight=value/2;this.notifyChange()};Renderizable.prototype.getWidth=function(){if(this._scale)return this._width*
this._scale.x;else return this._width};Renderizable.prototype.getHeight=function(){if(this._scale)return this._height*this._scale.y;else return this._height};Renderizable.prototype.setSize=function(width,height){this.setWidth(width);this.setHeight(height)};Renderizable.prototype.getSize=function(){return{width:this.getWidth(),height:this.getHeight()}};Renderizable.prototype.setScale=function(x,y){if(!x&&!y)return;if(!x)x=1;if(!y)y=1;this._scale={x:x,y:y};this.notifyChange()};Renderizable.prototype.setScaleX=
function(x){if(!this._scale){this._scale=new Object;this._scale.y=1}this._scale.x=x;this.notifyChange()};Renderizable.prototype.setScaleY=function(y){if(!this._scale){this._scale=new Object;this._scale.x=1}this._scale.y=y;this.notifyChange()};Renderizable.prototype.mirror=function(){this.invertX()};Renderizable.prototype.invertX=function(){if(!this._scale){this._scale=new Object;this._scale.x=1;this._scale.y=1}this._scale.x*=-1;this.notifyChange()};Renderizable.prototype.invertY=function(){if(!this._scale){this._scale=
new Object;this._scale.x=1;this._scale.y=1}this._scale.y=-1;this.notifyChange()};Renderizable.prototype.getLeft=function(){if(this._scale)if(this.pivotX!=undefined)return this._x+this.pivotX-this._width*this._scale.x;else return this._x-this._halfWidth*this._scale.x;else if(this.pivotX!=undefined)return this._x+this.pivotX-this._width;else return this._x-this._halfWidth};Renderizable.prototype.getRight=function(){if(this._scale)if(this.pivotX!=undefined)return this._x+this.pivotX+this._width*this._scale.x;
else return this._x+this._halfWidth*this._scale.x;else if(this.pivotX!=undefined)return this._x+this.pivotX+this._width;else return this._x+this._halfWidth};Renderizable.prototype.getTop=function(){if(this._scale)if(this.pivotY!=undefined)return this._y+this.pivotY-this._height*this._scale.y;else return this._y-this._halfHeight*this._scale.y;else if(this.pivotY!=undefined)return this._y+this.pivotY-this._height;else return this._y-this._halfHeight};Renderizable.prototype.getBottom=function(){if(this._scale)if(this.pivotY!=
undefined)return this._y+this.pivotY+this._height*this._scale.y;else return this._y+this._halfHeight*this._scale.y;else if(this.pivotY!=undefined)return this._y+this.pivotY+this._height;else return this._y+this._halfHeight};Renderizable.prototype.setLeft=function(value){this._prevX=this._x;if(this._scale)this._x=value+this._halfWidth*this._scale.x;else this._x=value+this._halfWidth;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.setRight=function(value){this._prevX=this._x;
if(this._scale)this._x=value-this._halfWidth*this._scale.x;else this._x=value-this._halfWidth;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.setTop=function(value){this._prevY=this._y;if(this._scale)this._y=value+this._halfHeight*this._scale.y;else this._y=value+this._halfHeight;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.setBottom=function(value){this._prevY=this._y;if(this._scale)this._y=value-this._halfHeight*this._scale.y;else this._y=value-
this._halfHeight;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.getLocation=function(){return{x:this._x,y:this._y}};Renderizable.prototype.setLocation=function(x,y){this.prevX=this._x;this.prevY=this._y;this._x=x;this._y=y;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.movedInX=function(){return this.prevX!=this._x};Renderizable.prototype.movedInY=function(){return this.prevY!=this._y};Renderizable.prototype._applyOperation=function(context){if(this.operation){context.globalCompositeOperation=
this.operation;context.operationChanged=false}else if(context.operationChanged)context.resetOperation()};Renderizable.prototype._applyAlpha=function(context){if(this._alpha!=null&&this._alpha>=0&&this._alpha<=1){context.globalAlpha=this._alpha;context.alphaChanged=true}else if(context.alphaChanged)context.resetAlpha()};Renderizable.prototype._applyShadow=function(context){if(this._shadow){context.shadowOffsetX=this._shadow.x;context.shadowOffsetY=this._shadow.y;context.shadowColor=this._shadow.color;
context.shadowBlur=this._shadow.blur;context.shadowChanged=false}else if(context.shadowChanged)context.resetShadow()};Renderizable.prototype._applyTranslation=function(context,cameraX,cameraY){context.translate(this._x-cameraX,this._y-cameraY)};Renderizable.prototype._applyRotation=function(context){if(this._rotation)context.rotate(this._rotation)};Renderizable.prototype._applyScale=function(context){if(this._scale)context.scale(this._scale.x,this._scale.y)};Renderizable.prototype.offsetAlpha=function(offset){this._alpha+=
offset;this.notifyChange()};Renderizable.prototype.offsetRotation=function(offset){this._rotation+=offset;this.notifyChange()};Renderizable.prototype.isVisible=function(cameraX0,cameraY0,cameraX1,cameraY1){if(this._alpha==0||!this._visible)return false;var insideViewport=this.isIn(cameraX0,cameraY0,cameraX1,cameraY1);if(this.onOutsideViewport)if(!(this._raisedNotVisible&&insideViewport)){this.onOutsideViewport();this._raisedNotVisible=true}else this._raisedNotVisible=false;return insideViewport};
Renderizable.prototype.isIn=function(x0,y0,x1,y1){if(this._rotation)return M.collisions.Polygon.haveCollided(this,new Rectangle(x0,y0,x1,y1));else{if(this.getBottom()<y0)return false;if(this.getTop()>y1)return false;if(this.getRight()<x0)return false;if(this.getLeft()>x1)return false;return true}};Renderizable.prototype.setRotation=function(rotation){this._rotation=rotation;this.notifyChange()};Renderizable.prototype.getRotation=function(){return this._rotation};Renderizable.prototype.setX=function(x){this.prevX=
this._x;this._x=x;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.setY=function(y){this.prevY=this._y;this._y=y;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.updateChildrenPosition=function(){if(this.children)for(var i in this.children)this.children[i].offset(this.prevX-this._x,this.prevY-this._y)};Renderizable.prototype.remove=function(){this.ownerLayer.remove(this)};Renderizable.prototype.offset=function(x,y){this.prevX=this._x;this.prevY=this._y;
this._x+=x;this._y+=y;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.offsetX=function(x){this.prevX=this._x;this._x+=x;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.offsetY=function(y){this.prevY=this._y;this._y+=y;this.updateChildrenPosition();this.notifyChange()};Renderizable.prototype.centerAt=function(vector2d){this.setLocation(vector2d.x,vector2d.y)};Renderizable.prototype.getX=function(){return this._x};Renderizable.prototype.getY=function(){return this._y};
Renderizable.prototype.onRender=function(){throw new Error("Method onRender must be overriden");};Renderizable.prototype.getMaxSize=function(){return Math.max(this.getWidth(),this.getHeight())};Renderizable.prototype.toString=function(){return this.constructor.name};M.renderers=M.renderers||{};M.renderers.Renderizable=Renderizable;function Rectangle(x0,y0,x1,y1){this.width=x1-x0;this.height=y1-y0;this._x=x0+this.width/2;this._y=y0+this.height/2}Rectangle.prototype.getWidth=function(){return this.width};
Rectangle.prototype.getHeight=function(){return this.height}})(M,M.effects.visual);(function(namespace,M,Renderizable,spriteAssets){function Sprite(img,x,y){Renderizable.apply(this);this.animationName=null;this._animation=null;this.frameIndex=0;this.isPlaying=false;if(img)this.setImage(img);this.setLocation(x,y)}Sprite.prototype.setImage=function(img,frameIndex){if(!img)throw new Error("Image cannot be null");if(img instanceof Image){if(!img.frames)img.frames=[{x:0,y:0,width:img.width,height:img.height,halfWidth:img.width/2,halfHeight:img.height/2}];this._image=img}else{var sprt=
spriteAssets[img];if(sprt)this._image=sprt;else throw new Error("Image by id "+img+" not loaded");}this.setFrameIndex(frameIndex);this.animationName=null;this._animation=null;this.isPlaying=false};Sprite.prototype.play=function(animationName,loop){if(this._animation&&this.animationName==animationName&&this.isPlaying)return;if(!animationName&&this._animation)this.isPlaying=true;else{if(!this._image)throw new Error("No image selected");if(!this._image.animations)throw new Error("Image has no animations");
if(!this._image.animations[animationName])throw new Error("Image has no animation by name "+animationName);this._animation=this._image.animations[animationName];this.animationName=animationName;this._frameIndex=0;this.isPlaying=true}this.loop=loop||this._animation.loop;this.notifyChange()};Sprite.prototype.stop=function(){this.isPlaying=false};Sprite.prototype._animate=function(){if(this.isPlaying){var timeInMillis=M.getTime();if(!this.currentFrameStartInMillis)this.currentFrameStartInMillis=timeInMillis;
if(timeInMillis-this.currentFrameStartInMillis>this._animation.duration){this.currentFrame=this._image.frames[this._animation.frames[this._frameIndex]];if(this._frameIndex<this._animation.frames.length-1)this._frameIndex++;else if(this.loop)if(this._frameIndex==0)this._frameIndex=1;else this._frameIndex=0;else if(this._animation.next)this.play(this._animation.next);else this.isPlaying=false;this.currentFrameStartInMillis=timeInMillis;this.notifyChange()}}};Sprite.prototype.isLastAnimationFrame=function(){if(this._animation)return this._frameIndex==
this._animation.frames.length-1;return false};Sprite.prototype.isFirstAnimationFrame=function(){if(this._animation)return this._frameIndex==1;return false};Sprite.prototype.onLoop=function(p){this._loopThroughAnimations();this._loopThroughTimers();if(this.onUpdate)this.onUpdate(p);this._animate()};Sprite.prototype.onRender=function(context,canvas,cameraX,cameraY){if(!this._image)return;this._applyOperation(context);this._applyAlpha(context);var x,y;if(this.pivotX)x=this.pivotX;else x=-this.oHW||-this.currentFrame.halfWidth;
if(this.pivotY)y=this.pivotY;else y=-this.oHH||-this.currentFrame.halfHeight;if(this._rotation||this._scale){context.save();this._applyTranslation(context,cameraX,cameraY);this._applyRotation(context);this._applyScale(context);context.drawImage(this._image,this.currentFrame.x,this.currentFrame.y,this.currentFrame.width,this.currentFrame.height,x,y,this.oW||this.currentFrame.width,this.oH||this.currentFrame.height);context.restore()}else{context.drawImage(this._image,this.currentFrame.x,this.currentFrame.y,
this.currentFrame.width,this.currentFrame.height,this._x+x,this._y+y,this.oW||this.currentFrame.width,this.oH||this.currentFrame.height);if(this._alpha)context.resetAlpha()}this._applyShadow(context)};Sprite.prototype.setSize=function(width,height){this.oW=width;this.oH=height;this.oHW=width/2;this.oHH=height/2;this.notifyChange()};Sprite.prototype.setFrameIndex=function(index){index=index||0;this._frameIndex=index;this.currentFrame=this._image.frames[index]};Sprite.prototype.getTop=function(){if(this._scale)return this._y-
this.currentFrame.halfHeight*this._scale.y;else return this._y-this.currentFrame.halfHeight};Sprite.prototype.getBottom=function(){if(this._scale)return this._y+this.currentFrame.halfHeight*this._scale.y;else return this._y+this.currentFrame.halfHeight};Sprite.prototype.getLeft=function(){if(this._scale)return this._x-this.currentFrame.halfWidth*this._scale.x;else return this._x-this.currentFrame.halfWidth};Sprite.prototype.getRight=function(){if(this._scale)return this._x+this.currentFrame.halfWidth*
this._scale.x;else return this._x+this.currentFrame.halfWidth};Sprite.prototype.getWidth=function(){if(this._scale)return this.currentFrame.width*this._scale.x;else return this.currentFrame.width};Sprite.prototype.getHeight=function(){if(this._scale)return this.currentFrame.height*this._scale.y;else return this.currentFrame.height};Sprite.prototype.setLeft=function(value){if(this._scale)this._x=value+this.currentFrame.halfWidth*this._scale.x;else this._x=value+this.currentFrame.halfWidth;this.notifyChange()};
Sprite.prototype.setRight=function(value){if(this._scale)this._x=value-this.currentFrame.halfWidth*this._scale.x;else this._x=value-this.currentFrame.halfWidth;this.notifyChange()};Sprite.prototype.setTop=function(value){if(this._scale)this._y=value+this.currentFrame.halfHeight*this._scale.y;else this._y=value+this.currentFrame.halfHeight;this.notifyChange()};Sprite.prototype.setBottom=function(value){if(this._scale)this._y=value-this.currentFrame.halfHeight*this._scale.y;else this._y=value-this.currentFrame.halfHeight;
this.notifyChange()};Sprite.prototype.toString=function(){return"Sprite"};M.extend(Sprite,Renderizable);namespace.Sprite=Sprite})(Match.renderers,Match,Match.renderers.Renderizable,Match.sprites.assets);(function(namespace,M,Renderizable){function Rectangle(properties){Renderizable.apply(this,arguments);this._fillStyle="black";this._strokeStyle=null;this._lineWidth=null;this.set(properties)}Rectangle.prototype.css=function(selector){var style=M.getStyleBySelector(selector);if(style.color!="")this.setFillStyle(style.color);if(style.backgroundColor!="")this.setFillStyle(style.backgroundColor);if(style.borderColor!="")this.setStrokeStyle(style.borderColor);if(style.borderWidth!="")this.setLineWidth(style.borderWidth);
if(style.width!="")this.setWidth(style.width);if(style.height!="")this.setHeight(style.height);if(style.left!="")this.setLeft(style.left);if(style.right!="")this.setRight(style.right);if(style.top!="")this.setTop(style.top);if(style.bottom!="")this.setBottom(style.bottom);if(style.boxShadow!=""){var color,shadow,x,y,blur;if(style.boxShadow.indexOf("rgb")>-1)color=style.boxShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0];else if(style.boxShadow.indexOf("px")>style.boxShadow.indexOf(" "))color=
style.boxShadow.substr(0,style.boxShadow.indexOf(" "));shadow=style.boxShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/);if(shadow){x=parseInt(shadow[1]);y=parseInt(shadow[2]);blur=parseInt(shadow[3])}this.setShadow(x,y,color,blur)}};Rectangle.prototype.setFillStyle=function(value){this._fillStyle=value;this.notifyChange()};Rectangle.prototype.setStrokeStyle=function(value){this._strokeStyle=value;this.notifyChange()};Rectangle.prototype.setStrokeWidth=function(value){this._lineWidth=value;this.notifyChange()};
Rectangle.prototype.setShadow=function(x,y,color,blur){this._shadow={x:x,y:y,color:color||"black",blur:blur||1};this.notifyChange()};Rectangle.prototype.getFillStyle=function(){return this._fillStyle};Rectangle.prototype.getStrokeStyle=function(){return this._strokeStyle};Rectangle.prototype.getStrokeWidth=function(){return this._lineWidth};Rectangle.prototype.getShadow=function(){return this._shadow};Rectangle.prototype.onRender=function(context,canvas,cameraX,cameraY){this._applyOperation(context);
this._applyAlpha(context);if(this._rotation||this._scale){context.save();this._applyTranslation(context,cameraX,cameraY);this._applyRotation(context);this._applyScale(context);if(this._fillStyle)context.fillStyle=this._fillStyle;context.fillRect(-this._halfWidth,-this._halfHeight,this._width,this._height);if(this._lineWidth)context.lineWidth=this._lineWidth;if(this._strokeStyle){context.strokeStyle=this._strokeStyle;context.strokeRect(-this._halfWidth,-this._halfHeight,this._width,this._height)}context.restore()}else{if(this._fillStyle)context.fillStyle=
this._fillStyle;context.fillRect(this._x-this._halfWidth,this._y-this._halfHeight,this._width,this._height);if(this._lineWidth)context.lineWidth=this._lineWidth;if(this._strokeStyle){context.strokeStyle=this._strokeStyle;context.strokeRect(this._x-this._halfWidth,this._y-this._halfHeight,this._width,this._height)}}this._applyShadow(context)};Rectangle.prototype.toString=function(){return"Rectangle"};M.extend(Rectangle,Renderizable);namespace.Rectangle=Rectangle})(window.Match.renderers,window.Match,
window.Match.renderers.Renderizable);(function(namespace,M,Renderizable){function Circle(properties){Renderizable.apply(this,arguments);this._fillStyle="rgb(0,0,0)";this._strokeStyle=null;this._lineWidth=null;this._radius=1;this._startAngle=0;this._endAngle=6.28;this.set(properties)}Circle.prototype.css=function(selector){var style=M.getStyleBySelector(selector);if(style.color!="")this.setFillStyle(style.color);if(style.backgroundColor!="")this.setFillStyle(style.backgroundColor);if(style.borderColor!="")this.setStrokeStyle(style.borderColor);
if(style.borderWidth!="")this.setLineWidth(style.borderWidth);if(style.width!="")this.setRadius(style.width);if(style.height!="")this.setRadius(style.height);if(style.left!="")this.setLeft(style.left);if(style.right!="")this.setRight(style.right);if(style.top!="")this.setTop(style.top);if(style.bottom!="")this.setBottom(style.bottom);if(style.boxShadow!=""){var color,shadow,x,y,blur;if(style.boxShadow.indexOf("rgb")>-1)color=style.boxShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0];else if(style.boxShadow.indexOf("px")>
style.boxShadow.indexOf(" "))color=style.boxShadow.substr(0,style.boxShadow.indexOf(" "));shadow=style.boxShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/);if(shadow){x=parseInt(shadow[1]);y=parseInt(shadow[2]);blur=parseInt(shadow[3])}this.setShadow(x,y,color,blur)}};Circle.prototype.setStrokeStyle=function(value){this._strokeStyle=value;this.notifyChange()};Circle.prototype.getStrokeStyle=function(){return this._strokeStyle};Circle.prototype.setFillStyle=function(value){this._fillStyle=value;this.notifyChange()};
Circle.prototype.getFillStyle=function(){return this._fillStyle};Circle.prototype.setStrokeWidth=function(value){this._lineWidth=value;this.notifyChange()};Circle.prototype.getStrokeWidth=function(){return this._lineWidth};Circle.prototype.setRadius=function(radius){this._radius=radius;this.notifyChange()};Circle.prototype.setShadow=function(x,y,color,blur){this._shadow={x:x,y:y,color:color||"black",blur:blur||1};this.notifyChange()};Circle.prototype.getShadow=function(){return this._shadow};Circle.prototype.getRadius=
function(){return this._radius};Circle.prototype.isMouseOver=function(p){if(!p)p=M.onLoopProperties;return M.Math2d.getDistance({x:this._x,y:this._y},p.mouse)<=this._radius};Circle.prototype.getWidth=function(){if(this._scale)return this._radius*this._scale.x;else return this._radius};Circle.prototype.getHeight=function(){if(this._scale)return this._radius*this._scale.y;else return this._radius};Circle.prototype.getLeft=function(){if(this._scale)return this._x-this._radius*this._scale.x;else return this._x-
this._radius};Circle.prototype.getRight=function(){if(this._scale)return this._x+this._radius*this._scale.x;else return this._x+this._radius};Circle.prototype.getTop=function(){if(this._scale)return this._y-this._radius*this._scale.y;else return this._y-this._radius};Circle.prototype.getBottom=function(){if(this._scale)return this._y+this._radius*this._scale.y;else return this._y+this._radius};Circle.prototype.setLeft=function(value){if(this._scale)this._x=value+this._radius*this._scale.x;else this._x=
value+this._radius;this.notifyChange()};Circle.prototype.setRight=function(value){if(this._scale)this._x=value-this._radius*this._scale.x;else this._x=value-this._radius;this.notifyChange()};Circle.prototype.setTop=function(value){if(this._scale)this._y=value+this._radius*this._scale.y;else this._y=value+this._radius;this.notifyChange()};Circle.prototype.setBottom=function(value){if(this._scale)this._y=value-this._radius*this._scale.y;else this._y=value-this._radius;this.notifyChange()};Circle.prototype.onRender=
function(context,canvas,cameraX,cameraY){this._applyOperation(context);this._applyAlpha(context);if(this._scale){context.save();this._applyTranslation(context,cameraX,cameraY);this._applyScale(context);context.beginPath();context.arc(0,0,this._radius,this._startAngle,this._endAngle,false);context.closePath();if(this._fillStyle){context.fillStyle=this._fillStyle;context.fill()}context.restore()}else{context.beginPath();context.arc(this._x-this._radius/2,this._y-this._radius/2,this._radius,this._startAngle,
this._endAngle,false);context.closePath();if(this._fillStyle){context.fillStyle=this._fillStyle;context.fill()}}this._applyShadow(context);if(this._lineWidth)context.lineWidth=this._lineWidth;if(this._strokeStyle){context.strokeStyle=this._strokeStyle;context.stroke(-this._halfWidth,-this._halfHeight,this._width,this._height)}};Circle.prototype.toString=function(){return"Circle"};M.extend(Circle,Renderizable);namespace.Circle=Circle})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(namespace,M,Renderizable){function Text(properties){Renderizable.apply(this,arguments);this._style="";this._variant="";this._weight="";this._size="14px";this._family="Calibri, Verdana, Arial, Monospace";this._textAlign="center";this._textBaseline="middle";this._text="";this.set(properties)}Text.prototype.fillText=function(context,x,y){if(this.multiLine)for(var i=0;i<this.multiLine.length;i++)context.fillText(this.multiLine[i],x,y+i*this.getHeight());else context.fillText(this._text,x,y);
if(this._strokeStyle){context.strokeStyle=this._strokeStyle;context.lineWidth=this._lineWidth||1;context.strokeText(this._text,x,y)}};Text.prototype.onRender=function(context,canvas,cameraX,cameraY){this._applyOperation(context);this._applyAlpha(context);context.font=this._style+this._variant+this._weight+this._size+this._family;context.textAlign=this._textAlign;context.textBaseline=this._textBaseline;context.fillStyle=this._fillStyle;this._applyShadow(context);if(this._rotation||this._scale){context.save();
this._applyTranslation(context,cameraX,cameraY);this._applyRotation(context);this._applyScale(context);this.fillText(context,0,0);context.restore()}else this.fillText(context,this._x,this._y)};Text.prototype.getRight=function(){return this._x+this.getWidth()};Text.prototype.getBottom=function(){return this._y+this.getHeight()};Text.prototype.getHeight=function(){if(this._text==this._cachedText2)return this._height;var d=document.createElement("span"),height;d.font=this._style+this._variant+this._weight+
this._size+this._family;d.textContent=this._text;document.body.appendChild(d);height=d.offsetHeight;document.body.removeChild(d);this._height=height;this._cachedText2=this._text;return height};Text.prototype.setAlignment=function(horizontal,vertical){this.setHorizontalAlign(horizontal);this.setVerticalAlign(vertical)};Text.prototype.setHorizontalAlign=function(value){this._textAlign=value;this.notifyChange()};Text.prototype.setVerticalAlign=function(value){this._textBaseline=value;this.notifyChange()};
Text.prototype.getWidth=function(){if(this._text==this._cachedText)return this._width;var width,context=M.offScreenContext;context.save();context.font=this._style+this._variant+this._weight+this._size+this._family;context.fillStyle=this._fillStyle;width=context.measureText(this._text).width;context.restore();this._width=width;this._cachedText=this._text;return width};Text.prototype.setFamily=function(value){this._family=value;this.notifyChange()};Text.prototype.setSize=function(value){this._size=
parseInt(value)+"px ";this.notifyChange()};Text.prototype.setWeight=function(value){this._weight=value+" ";this.notifyChange()};Text.prototype.setBold=function(value){if(value)this.setWeight("bold");else this.setWeight("")};Text.prototype.setVariant=function(value){this._variant=value+" ";this.notifyChange()};Text.prototype.setStyle=function(value){this._style=value+" ";this.notifyChange()};Text.prototype.setFillStyle=function(value){this._fillStyle=value;this.notifyChange()};Text.prototype.css=function(selector){var style=
M.getStyleBySelector(selector);if(style.color!="")this.setFillStyle(style.color);if(style.fontFamily!="")this.setFamily(style.fontFamily);if(style.fontSize!="")this.setSize(style.fontSize);if(style.fontStyle!="")this.setStyle(style.fontStyle);if(style.fontVariant!="")this.setVariant(style.fontVariant);if(style.fontWeight!="")this.setWeight(style.fontWeight);if(style.left!="")this.setLeft(style.left);if(style.right!="")this.setRight(style.right);if(style.top!="")this.setTop(style.top);if(style.bottom!=
"")this.setBottom(style.bottom);if(style.textShadow!=""){var color,shadow,x,y,blur;if(style.textShadow.indexOf("rgb")>-1)color=style.textShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0];else if(style.textShadow.indexOf("px")>style.textShadow.indexOf(" "))color=style.textShadow.substr(0,style.textShadow.indexOf(" "));shadow=style.textShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/);if(shadow){x=parseInt(shadow[1]);y=parseInt(shadow[2]);blur=parseInt(shadow[3])}this.setShadow(x,y,color,blur)}};
Text.prototype.getSize=function(value){return this._size};Text.prototype.getWeight=function(value){return this._weight};Text.prototype.getVariant=function(value){return this._variant};Text.prototype.getStyle=function(value){return this._style};Text.prototype.setStrokeStyle=function(value){this._strokeStyle=value;this.notifyChange()};Text.prototype.setStrokeWidth=function(value){this._lineWidth=value;this._changed=true};Text.prototype.getStrokeWidth=function(){return this._lineWidth};Text.prototype.setText=
function(value,multiLine){if(multiLine)this.multiLine=value.split("\n");this._text=value;this.notifyChange()};Text.prototype.getFamily=function(value){return this._family};Text.prototype.getFillStyle=function(value){return this._fillStyle};Text.prototype.getStrokeStyle=function(value){return this._strokeStyle};Text.prototype.getText=function(){return this._text};Text.prototype.setShadow=function(x,y,color,blur){this._shadow={x:x,y:y,color:color||"black",blur:blur||1};this.notifyChange()};Text.prototype.getShadow=
function(){return this._shadow};Text.prototype.toString=function(){return"Text"};M.extend(Text,Renderizable);namespace.Text=Text})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(namespace){function CollisionMap(rows,columns){if(rows&&columns)this.createMap(columns,rows);this.renderingOptions={tileSize:114,colors:["white","black"]};this.rowCount=rows;this.columnCount=columns}CollisionMap.prototype.createMap=function(rows,columns){this.map=new Array;this.rowCount=rows;this.columnCount=columns;for(var column=0;column<columns;column++){var mapColumn=new Array;for(var row=0;row<rows;row++)mapColumn.push(0);this.map.push(mapColumn)}};CollisionMap.prototype.fillCell=function(row,
column){if(this.isValidCell(row,column)){if(this.map[row][column]==1)return false;this.map[row][column]=1}return true};CollisionMap.prototype.isValidCell=function(row,column){return row>=0&&column>=0&&row<this.rowCount&&column<this.columnCount};CollisionMap.prototype.clearCell=function(row,column){if(this.isValidCell(row,column))this.map[row][column]=0};CollisionMap.prototype.clear=function(){this.createMap(this.getRowCount(),this.getColumnCount())};CollisionMap.prototype.onRender=function(context){var tileSize=
this.renderingOptions.tileSize,map=this.map;for(var i=0,iM=map.length;i<iM;i++)for(var j=0,jM=map[i].length;j<jM;j++)if(map[i][j]){context.fillStyle=this.renderingOptions.colors[map[i][j]];context.fillRect(j*tileSize,i*tileSize,tileSize,tileSize)}};CollisionMap.prototype.isEmpty=function(row,column){return this.isValidCell(row,column)&&this.map[row][column]==0};CollisionMap.prototype.isVisible=function(){return true};namespace.CollisionMap=CollisionMap})(window.Match.collisions||(window.Match.collisions=
{}));
